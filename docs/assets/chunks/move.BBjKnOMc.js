import{a4 as m,a6 as g,ab as C,ad as E,ax as u,a8 as T,ai as A,am as p,aK as y,d as b}from"./index.p3HzktB-.js";const f={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class _ extends p{constructor(t,e,a,s,d){super(t),this.features=e,this.coordinate=a,this.startCoordinate=s,this.mapBrowserEvent=d}}class w extends m{constructor(t){t=t||{},super(t),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=t.features!==void 0?t.features:null;let e;if(t.layers&&!this.features_)if(typeof t.layers=="function")e=t.layers;else{const a=t.layers;e=function(s){return a.includes(s)}}else e=g;this.layerFilter_=e,this.filter_=t.filter&&!this.features_?t.filter:g,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.condition_=t.condition?t.condition:C,this.lastFeature_=null,this.addChangeListener(E.ACTIVE,this.handleActiveChanged_)}handleDownEvent(t){if(!t.originalEvent||!this.condition_(t))return!1;if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);const e=this.features_||new u([this.lastFeature_]);return this.dispatchEvent(new _(f.TRANSLATESTART,e,t.coordinate,this.startCoordinate_,t)),!0}return!1}handleUpEvent(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);const e=this.features_||new u([this.lastFeature_]);return this.dispatchEvent(new _(f.TRANSLATEEND,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1}handleDragEvent(t){if(this.lastCoordinate_){const e=t.coordinate;t.map.getView().getProjection();const a=T(e),s=T(this.lastCoordinate_),d=a[0]-s[0],i=a[1]-s[1],l=this.features_||new u([this.lastFeature_]);l.forEach(function(o){const r=o.getGeometry();r.translate(d,i),o.setGeometry(r)}),this.lastCoordinate_=e,this.dispatchEvent(new _(f.TRANSLATING,l,e,this.startCoordinate_,t))}}handleMoveEvent(t){const e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(t,e){return e.forEachFeatureAtPixel(t,(a,s)=>{if(!(!(a instanceof A)||!this.filter_(a,s))&&!(this.features_&&!this.features_.getArray().includes(a)))return a},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(t){this.hitTolerance_=t}setMap(t){const e=this.getMap();super.setMap(t),this.updateState_(e)}handleActiveChanged_(){this.updateState_(null)}updateState_(t){let e=this.getMap();const a=this.getActive();(!e||!a)&&(e=e||t,e&&e.getViewport().classList.remove("ol-grab","ol-grabbing"))}}function F(n,t=!0){let e=n.getInteractiveByType("move");if(e)return e;const a=n.getOlMap(),s=n.getEmitter(),d=n.getContainer();let i=[];const l=new u([]),o=new w({features:l});return o.on("translateend",r=>{const h=r.features.getArray()??[];t&&h.forEach(c=>{y(c,d)}),s.emit("move",i)}),e={id:b(),type:"move",enabled:!1,add(r){i.findIndex(c=>c.id===r.id)===-1&&(i.push(r),l.push(r.getOlFeature()))},remove(r){const h=i.findIndex(c=>c.id===r.id);h!==-1&&(i.splice(h,1),l.remove(r.getOlFeature()))},clean(){i=[],l.clear()},enable(){e.enabled||(a.addInteraction(o),e.enabled=!0)},close(){e.enabled&&(a.removeInteraction(o),e.enabled=!1)},destroy(){e.clean(),e.close(),o.dispose()}},n.add(e),e}export{F as c};
