import{D as x}from"./Draw.DLF4MqmK.js";import{B as F,C as k,r as R,u as A,l as B,M as K,o as D,e as V,f as G,V as H,b as _,d as $,h as I,S as z,i as X,j as M,F as L,k as Y,m as j}from"./index.p3HzktB-.js";const r={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class b extends F{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+k,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(r.ELEMENT,this.handleElementChanged),this.addChangeListener(r.MAP,this.handleMapChanged),this.addChangeListener(r.OFFSET,this.handleOffsetChanged),this.addChangeListener(r.POSITION,this.handlePositionChanged),this.addChangeListener(r.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(r.ELEMENT)}getId(){return this.id}getMap(){return this.get(r.MAP)||null}getOffset(){return this.get(r.OFFSET)}getPosition(){return this.get(r.POSITION)}getPositioning(){return this.get(r.POSITIONING)}handleElementChanged(){R(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),A(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=B(e,K.POSTRENDER,this.render,this),this.updatePixelPosition();const n=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?n.insertBefore(this.element,n.childNodes[0]||null):n.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(r.ELEMENT,e)}setMap(e){this.set(r.MAP,e)}setOffset(e){this.set(r.OFFSET,e)}setPosition(e){this.set(r.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(r.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),a=this.getElement(),i=this.getRect(a,[D(a),V(a)]);e=e||{};const f=e.margin===void 0?20:e.margin;if(!G(n,i)){const u=i[0]-n[0],o=n[2]-i[2],d=i[1]-n[1],l=n[3]-i[3],h=[0,0];if(u<0?h[0]=u-f:o<0&&(h[0]=Math.abs(o)+f),d<0?h[1]=d-f:l<0&&(h[1]=Math.abs(l)+f),h[0]!==0||h[1]!==0){const y=t.getView().getCenterInternal(),c=t.getPixelFromCoordinateInternal(y);if(!c)return;const P=[c[0]+h[0],c[1]+h[1]],p=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(P),duration:p.duration,easing:p.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),a=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[a,i,a+t[0],i+t[1]]}setPositioning(e){this.set(r.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),a=e.getSize();this.updateRenderedPosition(n,a)}updateRenderedPosition(e,t){const n=this.element.style,a=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const f=Math.round(e[0]+a[0])+"px",u=Math.round(e[1]+a[1])+"px";let o="0%",d="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?o="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(o="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?d="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(d="-50%");const l=`translate(${o}, ${d}) translate(${f}, ${u})`;this.rendered.transform_!=l&&(this.rendered.transform_=l,n.transform=l)}getOptions(){return this.options}}function W(s){const e=Y(s);let t;return e>100?t=Math.round(e/1e3*100)/100+" km":t=Math.round(e*100)/100+" m",{output:t,data:e}}function q(s){const e=j(s);let t;return e>1e4?t=Math.round(e/1e6*100)/100+" km<sup>2</sup>":t=Math.round(e*100)/100+" m<sup>2</sup>",{output:t,data:e}}function w(s,e){var t;s.removeOverlay(e.olOverlay),(t=e.el)==null||t.remove()}function J(s,e){w(s,e.tooltip)}let S=0;function Q(s,e){S++;const t={message:"",el:null,olOverlay:null};t.el=document.createElement("div"),t.el.className="ol-tooltip ol-tooltip-measure";const n=new b({element:t.el,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1});return t.olOverlay=n,s.addOverlay(n),{id:S,type:e,data:void 0,tooltip:t}}function T(s){const e={message:"",el:null,olOverlay:null};e.el=document.createElement("div"),e.el.className="ol-tooltip hidden";const t=new b({element:e.el,offset:[15,0],positioning:"center-left"});return e.olOverlay=t,s.addOverlay(t),e}const U="Click to continue drawing the polygon",Z="Click to continue drawing the line";var N=(s=>(s.distance="LineString",s.area="Polygon",s))(N||{});function ee(){return new z({fill:new L({color:"rgba(255, 255, 255, 0.2)"}),stroke:new M({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new X({radius:5,stroke:new M({color:"rgba(0, 0, 0, 0.7)"}),fill:new L({color:"rgba(255, 255, 255, 0.2)"})})})}function ie(s,e){let t=s.getInteractiveByType("measure");if(t)return t;const n=s.getOlMap(),a=s.getEmitter(),i=new H,f=new _({source:i,style:{"fill-color":"rgba(255, 255, 255, 0.2)","stroke-color":"#ffcc33","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}});let u="distance",o,d,l={el:null,olOverlay:null};const h=function(g){var O;if(g.dragging)return;let m="Click to start drawing";d&&(u==="distance"?m=Z:m=U),l.el.innerHTML=m,l.olOverlay.setPosition(g.coordinate),(O=l.el)==null||O.classList.remove("hidden")};function y(){o=new x({source:i,type:N[u],style:ee()}),o.on("drawstart",function(g){d=g.feature;let m=g.target.coordinate;c=Q(n,u),p=d.getGeometry().on("change",function(O){const E=O.target;let v,C;u==="distance"?({output:v,data:C}=W(E),m=E.getLastCoordinate()):({output:v,data:C}=q(E),m=E.getInteriorPoint().getCoordinates()),c.data=C,c.tooltip.el.innerHTML=v,c.tooltip.olOverlay.setPosition(m)})}),o.on("drawend",function(){c.tooltip.el.className="ol-tooltip ol-tooltip-static",c.tooltip.olOverlay.setOffset([0,-7]),P.push(c),d=null,I(p),a.emit("measure",c)})}y();let c=null,P=[],p;return t={id:$(),type:"measure",enabled:!1,enable(){t.enabled||(l=T(n),n.addLayer(f),n.addInteraction(o),n.on("pointermove",h),t.enabled=!0)},use(g){t.clean(),l=T(n),u=g,d=null,n.removeInteraction(o),o.dispose(),I(p),y(),t.enabled&&n.addInteraction(o)},clean(){i.clear(),w(n,l);for(const g of P)J(n,g);P=[]},close(){t.enabled&&(t.clean(),n.removeLayer(f),n.removeInteraction(o),n.un("pointermove",h),t.enabled=!1)},destroy(){t.clean(),t.close(),o.dispose()}},s.add(t),t}export{ie as c};
