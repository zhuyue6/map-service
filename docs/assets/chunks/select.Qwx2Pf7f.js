import{aL as A,av as E,ak as m,ac as C,a6 as F,ax as b,aB as u,az as y,b as T,aM as x,ai as S,al as O,v,am as k,aN as p,aO as L,aP as I,aQ as M,d as P}from"./index.p3HzktB-.js";const R={SELECT:"select"};class D extends k{constructor(e,t,n,s){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=s}}const f={};class _ extends A{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:E,this.addCondition_=e.addCondition?e.addCondition:m,this.removeCondition_=e.removeCondition?e.removeCondition:m,this.toggleCondition_=e.toggleCondition?e.toggleCondition:C,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:F,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:G(),this.features_=e.features||new b;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(s){return n.includes(s)}}else t=F;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[u(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[u(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(y.ADD,this.boundAddFeature_),this.features_.addEventListener(y.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(y.ADD,this.boundAddFeature_),this.features_.removeEventListener(y.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.getMap().getAllLayers().find(function(s){if(s instanceof T&&s.getSource()&&s.getSource().hasFeature(t))return s});n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=u(e);t in f||(f[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const a=t[s];if(a!==this&&a instanceof _&&a.getStyle()&&a.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(a.getStyle());return}}const n=u(e);e.setStyle(f[n]),delete f[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[u(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),s=this.toggleCondition_(e),a=!t&&!n&&!s,d=e.map,l=this.getFeatures(),c=[],o=[];if(a){x(this.featureLayerAssociation_),d.forEachFeatureAtPixel(e.pixel,(i,h)=>{if(!(!(i instanceof S)||!this.filter_(i,h)))return this.addFeatureLayerAssociation_(i,h),o.push(i),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let i=l.getLength()-1;i>=0;--i){const h=l.item(i),g=o.indexOf(h);g>-1?o.splice(g,1):(l.remove(h),c.push(h))}o.length!==0&&l.extend(o)}else{d.forEachFeatureAtPixel(e.pixel,(i,h)=>{if(!(!(i instanceof S)||!this.filter_(i,h)))return(t||s)&&!l.getArray().includes(i)?(this.addFeatureLayerAssociation_(i,h),o.push(i)):(n||s)&&l.getArray().includes(i)&&(c.push(i),this.removeFeatureLayerAssociation_(i)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let i=c.length-1;i>=0;--i)l.remove(c[i]);l.extend(o)}return(o.length>0||c.length>0)&&this.dispatchEvent(new D(R.SELECT,o,c,e)),!0}}function G(){const r=O();return v(r.Polygon,r.LineString),v(r.GeometryCollection,r.LineString),function(e){return e.getGeometry()?r[e.getGeometry().getType()]:null}}const V="rgba(0, 0, 255, 0.7)",H=2;function j(r){let e=r.getInteractiveByType("move");if(e)return e;const t=r.getOlMap(),n=r.getEmitter(),s=r.getContainer(),a=new _({condition:p,style(d){const l=L(d,s);return[...I(l),M({stroke:{color:V,width:H}})]}});return a.on("select",function(d){const l=d.target.getFeatures().getArray()??[],c=[];l.forEach(o=>{const i=L(o,s);i&&c.push(i)}),n.emit("select",c)}),e={id:P(),type:"select",enabled:!1,enable(){e.enabled||(t.addInteraction(a),e.enabled=!0)},close(){e.enabled&&(t.removeInteraction(a),e.enabled=!1)},destroy(){e.close(),a.dispose()}},r.add(e),e}export{j as c};
