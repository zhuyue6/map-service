var ml=Object.defineProperty,yl=(i,t,e)=>t in i?ml(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,xl=(i,t,e)=>yl(i,t+"",e);const _t={ADD:"add",REMOVE:"remove"},He={PROPERTYCHANGE:"propertychange"},N={CHANGE:"change",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class kn{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function vl(i,t,e){let s,n;e=e||Ae;let r=0,o=i.length,a=!1;for(;r<o;)s=r+(o-r>>1),n=+e(i[s],t),n<0?r=s+1:(o=s,a=!n);return a?r:~r}function Ae(i,t){return i>t?1:i<t?-1:0}function El(i,t){return i<t?1:i>t?-1:0}function Fn(i,t,e){if(i[0]<=t)return 0;const s=i.length;if(t<=i[s-1])return s-1;if(typeof e=="function"){for(let n=1;n<s;++n){const r=i[n];if(r===t)return n;if(r<t)return e(t,i[n-1],r)>0?n-1:n}return s-1}if(e>0){for(let n=1;n<s;++n)if(i[n]<t)return n-1;return s-1}if(e<0){for(let n=1;n<s;++n)if(i[n]<=t)return n;return s-1}for(let n=1;n<s;++n){if(i[n]==t)return n;if(i[n]<t)return i[n-1]-t<t-i[n]?n-1:n}return s-1}function Sl(i,t,e){for(;t<e;){const s=i[t];i[t]=i[e],i[e]=s,++t,--e}}function Cs(i,t){const e=Array.isArray(t)?t:[t],s=e.length;for(let n=0;n<s;n++)i[i.length]=e[n]}function me(i,t){const e=i.length;if(e!==t.length)return!1;for(let s=0;s<e;s++)if(i[s]!==t[s])return!1;return!0}function Mi(){return!0}function ws(){return!1}function Ti(){}function zo(i){let t,e,s;return function(){const n=Array.prototype.slice.call(arguments);return(!e||this!==s||!me(n,e))&&(s=this,e=n,t=i.apply(this,arguments)),t}}function Xo(i){function t(){let e;try{e=i()}catch(s){return Promise.reject(s)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function zi(i){for(const t in i)delete i[t]}function qe(i){let t;for(t in i)return!1;return!t}class ie{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Rs extends kn{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const s=this.listeners_||(this.listeners_={}),n=s[t]||(s[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e=typeof t=="string",s=e?t:t.type,n=this.listeners_&&this.listeners_[s];if(!n)return;const r=e?new ie(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});s in o||(o[s]=0,a[s]=0),++o[s];let l;for(let h=0,c=n.length;h<c;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(r):l=n[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[s]===0){let h=a[s];for(delete a[s];h--;)this.removeEventListener(s,Ti);delete o[s]}return l}disposeInternal(){this.listeners_&&zi(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const s=this.listeners_[t];if(!s)return;const n=s.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(s[n]=Ti,++this.pendingRemovals_[t]):(s.splice(n,1),s.length===0&&delete this.listeners_[t]))}}function X(i,t,e,s,n){if(n){const o=e;e=function(a){return i.removeEventListener(t,e),o.call(s??this,a)}}else s&&s!==i&&(e=e.bind(s));const r={target:i,type:t,listener:e};return i.addEventListener(t,e),r}function br(i,t,e,s){return X(i,t,e,s,!0)}function tt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),zi(i))}class Yo extends Rs{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(N.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const s=t.length,n=new Array(s);for(let r=0;r<s;++r)n[r]=X(this,t[r],e);return n}return X(this,t,e)}onceInternal(t,e){let s;if(Array.isArray(t)){const n=t.length;s=new Array(n);for(let r=0;r<n;++r)s[r]=br(this,t[r],e)}else s=br(this,t,e);return e.ol_key=s,s}unInternal(t,e){const s=e.ol_key;if(s)Cl(s);else if(Array.isArray(t))for(let n=0,r=t.length;n<r;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}function Cl(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)tt(i[t]);else tt(i)}function K(){throw new Error("Unimplemented abstract method.")}let wl=0;function et(i){return i.ol_uid||(i.ol_uid=String(++wl))}class Or extends ie{constructor(t,e,s){super(t),this.key=e,this.oldValue=s}}class zt extends Yo{constructor(t){super(),this.on,this.once,this.un,et(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let s;s=`change:${t}`,this.hasListener(s)&&this.dispatchEvent(new Or(s,t,e)),s=He.PROPERTYCHANGE,this.hasListener(s)&&this.dispatchEvent(new Or(s,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,s){const n=this.values_||(this.values_={});if(s)n[t]=e;else{const r=n[t];n[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const s in t)this.set(s,t[s],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const s=this.values_[t];delete this.values_[t],qe(this.values_)&&(this.values_=null),e||this.notify(t,s)}}}const Dr={LENGTH:"length"};class ts extends ie{constructor(t,e,s){super(t),this.element=e,this.index=s}}class Wt extends zt{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let s=0,n=this.array_.length;s<n;++s)this.assertUnique_(this.array_[s],s);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,s=t.length;e<s;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let s=0,n=e.length;s<n;++s)t(e[s],s,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Dr.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new ts(_t.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let s=0,n=e.length;s<n;++s)if(e[s]===t)return this.removeAt(s)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new ts(_t.REMOVE,e,t)),e}setAt(t,e){const s=this.getLength();if(t>=s){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new ts(_t.REMOVE,n,t)),this.dispatchEvent(new ts(_t.ADD,e,t))}updateLength_(){this.set(Dr.LENGTH,this.array_.length)}assertUnique_(t,e){for(let s=0,n=this.array_.length;s<n;++s)if(this.array_[s]===t&&s!==e)throw new Error("Duplicate item added to a unique collection")}}class Be extends ie{constructor(t,e,s){super(t),this.map=e,this.frameState=s!==void 0?s:null}}let he=class extends Be{constructor(i,t,e,s,n,r){super(i,t,n),this.originalEvent=e,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=r}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(i){this.pixel_=i}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(i){this.coordinate_=i}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}};const J={SINGLECLICK:"singleclick",CLICK:N.CLICK,DBLCLICK:N.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Le=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Rl=Le.includes("safari")&&!Le.includes("chrom");Rl&&(Le.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Le));const Il=Le.includes("webkit")&&!Le.includes("edge"),Vo=Le.includes("macintosh"),Ml=typeof devicePixelRatio<"u"?devicePixelRatio:1,Ko=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Zo=typeof Image<"u"&&Image.prototype.decode,jo=typeof createImageBitmap=="function",Uo=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}(),xn={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class Tl extends Rs{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const s=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=s,this.pointerdownListenerKey_=X(s,xn.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=X(s,xn.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(N.TOUCHMOVE,this.boundHandleTouchMove_,Uo?{passive:!1}:!1)}emulateClick_(t){let e=new he(J.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new he(J.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const s=new he(J.SINGLECLICK,this.map_,t);this.dispatchEvent(s)},250)}updateActivePointers_(t){const e=t,s=e.pointerId;if(e.type==J.POINTERUP||e.type==J.POINTERCANCEL){delete this.trackedTouches_[s];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else(e.type==J.POINTERDOWN||e.type==J.POINTERMOVE)&&(this.trackedTouches_[s]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new he(J.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(tt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new he(J.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const s=this.map_.getOwnerDocument();this.dragListenerKeys_.push(X(s,J.POINTERMOVE,this.handlePointerMove_,this),X(s,J.POINTERUP,this.handlePointerUp_,this),X(this.element_,J.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==s&&this.dragListenerKeys_.push(X(this.element_.getRootNode(),J.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new he(J.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new he(J.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(tt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(N.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(tt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(tt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ce={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ct={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},di={IDLE:0,LOADED:2,ERROR:3,EMPTY:4};function Q(i,t){if(!i)throw new Error(t)}const vn=1/0;class Al{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,zi(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,s=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(s);return delete this.queuedElements_[n],s}enqueue(t){Q(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=vn?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,s=this.priorities_,n=e.length,r=e[t],o=s[t],a=t;for(;t<n>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<n&&s[h]<s[l]?h:l;e[t]=e[c],s[t]=s[c],t=c}e[t]=r,s[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const s=this.elements_,n=this.priorities_,r=s[e],o=n[e];for(;e>t;){const a=this.getParentIndex_(e);if(n[a]>o)s[e]=s[a],n[e]=n[a],e=a;else break}s[e]=r,n[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,s=this.priorities_;let n=0;const r=e.length;let o,a,l;for(a=0;a<r;++a)o=e[a],l=t(o),l==vn?delete this.queuedElements_[this.keyFunction_(o)]:(s[n]=l,e[n++]=o);e.length=n,s.length=n,this.heapify_()}}class Ll extends Al{constructor(t,e){super(s=>t.apply(null,s),s=>s[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(N.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,s=e.getState();if(s===di.LOADED||s===di.ERROR||s===di.EMPTY){s!==di.ERROR&&e.removeEventListener(N.CHANGE,this.boundHandleTileChange_);const n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let s=0;for(;this.tilesLoading_<t&&s<e&&this.getCount()>0;){const n=this.dequeue()[0],r=n.getKey();n.getState()===di.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++s,n.load())}}}function bl(i,t,e,s,n){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return vn;const r=i.viewState.center,o=s[0]-r[0],a=s[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}const rt={ANIMATING:0,INTERACTING:1},At={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function it(i,t,e){return Math.min(Math.max(i,t),e)}function Ol(i,t,e,s,n,r){const o=n-e,a=r-s;if(o!==0||a!==0){const l=((i-e)*o+(t-s)*a)/(o*o+a*a);l>1?(e=n,s=r):l>0&&(e+=o*l,s+=a*l)}return Ze(i,t,e,s)}function Ze(i,t,e,s){const n=e-i,r=s-t;return n*n+r*r}function Dl(i){const t=i.length;for(let s=0;s<t;s++){let n=s,r=Math.abs(i[s][s]);for(let a=s+1;a<t;a++){const l=Math.abs(i[a][s]);l>r&&(r=l,n=a)}if(r===0)return null;const o=i[n];i[n]=i[s],i[s]=o;for(let a=s+1;a<t;a++){const l=-i[a][s]/i[s][s];for(let h=s;h<t+1;h++)s==h?i[a][h]=0:i[a][h]+=l*i[s][h]}}const e=new Array(t);for(let s=t-1;s>=0;s--){e[s]=i[s][t]/i[s][s];for(let n=s-1;n>=0;n--)i[n][t]-=i[n][s]*e[s]}return e}function Pr(i){return i*180/Math.PI}function fe(i){return i*Math.PI/180}function Ci(i,t){const e=i%t;return e*t<0?e+t:e}function xt(i,t,e){return i+e*(t-i)}function Nn(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function es(i,t){return Math.ceil(Nn(i,t))}function En(i,t,e){if(i>=t&&i<e)return i;const s=e-t;return((i-t)%s+s)%s+t}function kr(i,t,e){return function(s,n,r,o,a){if(!s)return;if(!n&&!t)return s;const l=t?0:r[0]*n,h=t?0:r[1]*n,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,p=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>p&&(f=(p+f)/2,p=f);let _=it(s[0],d,g),m=it(s[1],f,p);if(o&&e&&n){const y=30*n;_+=-y*Math.log(1+Math.max(0,d-s[0])/y)+y*Math.log(1+Math.max(0,s[0]-g)/y),m+=-y*Math.log(1+Math.max(0,f-s[1])/y)+y*Math.log(1+Math.max(0,s[1]-p)/y)}return[_,m]}}function Pl(i){return i}const nt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Fr(i){const t=Dt();for(let e=0,s=i.length;e<s;++e)wi(t,i[e]);return t}function Gn(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function Ho(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function Wn(i,t,e){let s,n;return t<i[0]?s=i[0]-t:i[2]<t?s=t-i[2]:s=0,e<i[1]?n=i[1]-e:i[3]<e?n=e-i[3]:n=0,s*s+n*n}function Ai(i,t){return qo(i,t[0],t[1])}function de(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function qo(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Sn(i,t){const e=i[0],s=i[1],n=i[2],r=i[3],o=t[0],a=t[1];let l=nt.UNKNOWN;return o<e?l=l|nt.LEFT:o>n&&(l=l|nt.RIGHT),a<s?l=l|nt.BELOW:a>r&&(l=l|nt.ABOVE),l===nt.UNKNOWN&&(l=nt.INTERSECTING),l}function Dt(){return[1/0,1/0,-1/0,-1/0]}function be(i,t,e,s,n){return n?(n[0]=i,n[1]=t,n[2]=e,n[3]=s,n):[i,t,e,s]}function Is(i){return be(1/0,1/0,-1/0,-1/0,i)}function $o(i,t){const e=i[0],s=i[1];return be(e,s,e,s,t)}function Bn(i,t,e,s,n){const r=Is(n);return Jo(r,i,t,e,s)}function Li(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function kl(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function wi(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function Jo(i,t,e,s,n){for(;e<s;e+=n)Fl(i,t[e],t[e+1]);return i}function Fl(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Qo(i,t){let e;return e=t(zn(i)),e||(e=t(Xn(i)),e)||(e=t(Vn(i)),e)||(e=t(Ms(i)),e)?e:!1}function Nl(i){let t=0;return ii(i)||(t=Z(i)*ot(i)),t}function zn(i){return[i[0],i[1]]}function Xn(i){return[i[2],i[1]]}function te(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function us(i,t,e,s,n){const[r,o,a,l,h,c,u,d]=Gl(i,t,e,s);return be(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),n)}function Gl(i,t,e,s){const n=t*s[0]/2,r=t*s[1]/2,o=Math.cos(e),a=Math.sin(e),l=n*o,h=n*a,c=r*o,u=r*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function ot(i){return i[3]-i[1]}function Yn(i,t,e){const s=e||Dt();return ut(i,t)?(i[0]>t[0]?s[0]=i[0]:s[0]=t[0],i[1]>t[1]?s[1]=i[1]:s[1]=t[1],i[2]<t[2]?s[2]=i[2]:s[2]=t[2],i[3]<t[3]?s[3]=i[3]:s[3]=t[3]):Is(s),s}function Ms(i){return[i[0],i[3]]}function Vn(i){return[i[2],i[3]]}function Z(i){return i[2]-i[0]}function ut(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function ii(i){return i[2]<i[0]||i[3]<i[1]}function Wl(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Bl(i,t,e){let s=!1;const n=Sn(i,t),r=Sn(i,e);if(n===nt.INTERSECTING||r===nt.INTERSECTING)s=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=t[0],u=t[1],d=e[0],g=e[1],f=(g-u)/(d-c);let p,_;r&nt.ABOVE&&!(n&nt.ABOVE)&&(p=d-(g-h)/f,s=p>=o&&p<=l),!s&&r&nt.RIGHT&&!(n&nt.RIGHT)&&(_=g-(d-l)*f,s=_>=a&&_<=h),!s&&r&nt.BELOW&&!(n&nt.BELOW)&&(p=d-(g-a)/f,s=p>=o&&p<=l),!s&&r&nt.LEFT&&!(n&nt.LEFT)&&(_=g-(d-o)*f,s=_>=a&&_<=h)}return s}function ta(i,t){const e=t.getExtent(),s=te(i);if(t.canWrapX()&&(s[0]<e[0]||s[0]>=e[2])){const n=Z(e),r=Math.floor((s[0]-e[0])/n)*n;i[0]-=r,i[2]-=r}return i}function zl(i,t,e){if(t.canWrapX()){const s=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[s[0],i[1],s[2],i[3]]];ta(i,t);const n=Z(s);if(Z(i)>n)return[[s[0],i[1],s[2],i[3]]];if(i[0]<s[0])return[[i[0]+n,i[1],s[2],i[3]],[s[0],i[1],i[2],i[3]]];if(i[2]>s[2])return[[i[0],i[1],s[2],i[3]],[s[0],i[1],i[2]-n,i[3]]]}return[i]}function Xl(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function ds(i,t){let e=!0;for(let s=i.length-1;s>=0;--s)if(i[s]!=t[s]){e=!1;break}return e}function Kn(i,t){const e=Math.cos(t),s=Math.sin(t),n=i[0]*e-i[1]*s,r=i[1]*e+i[0]*s;return i[0]=n,i[1]=r,i}function Yl(i,t){return i[0]*=t,i[1]*=t,i}function ea(i,t){if(t.canWrapX()){const e=Z(t.getExtent()),s=Vl(i,t,e);s&&(i[0]-=s*e)}return i}function Vl(i,t,e){const s=t.getExtent();let n=0;return t.canWrapX()&&(i[0]<s[0]||i[0]>s[2])&&(e=e||Z(s),n=Math.floor((i[0]-s[0])/e)),n}function Kl(i){return Math.pow(i,3)}function si(i){return 1-Kl(1-i)}function Zl(i){return 3*i*i-2*i*i*i}function jl(i){return i}const Ul=63710088e-1;function Nr(i,t,e){e=e||Ul;const s=fe(i[1]),n=fe(t[1]),r=(n-s)/2,o=fe(t[0]-i[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(s)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function ia(...i){console.warn(...i)}const sa={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class bi{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||sa[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Xi=6378137,Ve=Math.PI*Xi,Hl=[-Ve,-Ve,Ve,Ve],ql=[-180,-85,180,85],is=Xi*Math.log(Math.tan(Math.PI/2));class ke extends bi{constructor(t){super({code:t,units:"m",extent:Hl,global:!0,worldExtent:ql,getPointResolution:function(e,s){return e/Math.cosh(s[1]/Xi)}})}}const Gr=[new ke("EPSG:3857"),new ke("EPSG:102100"),new ke("EPSG:102113"),new ke("EPSG:900913"),new ke("http://www.opengis.net/def/crs/EPSG/0/3857"),new ke("http://www.opengis.net/gml/srs/epsg.xml#3857")];function $l(i,t,e,s){const n=i.length;e=e>1?e:2,s=s??e,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=s){t[r]=Ve*i[r]/180;let o=Xi*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));o>is?o=is:o<-is&&(o=-is),t[r+1]=o}return t}function Jl(i,t,e,s){const n=i.length;e=e>1?e:2,s=s??e,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=s)t[r]=180*i[r]/Ve,t[r+1]=360*Math.atan(Math.exp(i[r+1]/Xi))/Math.PI-90;return t}const Ql=6378137,Wr=[-180,-90,180,90],th=Math.PI*Ql/180;let ve=class extends bi{constructor(i,t){super({code:i,units:"degrees",extent:Wr,axisOrientation:t,global:!0,metersPerUnit:th,worldExtent:Wr})}};const Br=[new ve("CRS:84"),new ve("EPSG:4326","neu"),new ve("urn:ogc:def:crs:OGC:1.3:CRS84"),new ve("urn:ogc:def:crs:OGC:2:84"),new ve("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ve("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ve("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Cn={};function eh(i){return Cn[i]||Cn[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function ih(i,t){Cn[i]=t}let je={};function Oi(i,t,e){const s=i.getCode(),n=t.getCode();s in je||(je[s]={}),je[s][n]=e}function js(i,t){return i in je&&t in je[i]?je[i][t]:null}const gs=.9996,Mt=.00669438,Ts=Mt*Mt,As=Ts*Mt,Ce=Mt/(1-Mt),zr=Math.sqrt(1-Mt),$e=(1-zr)/(1+zr),na=$e*$e,Zn=na*$e,jn=Zn*$e,ra=jn*$e,oa=1-Mt/4-3*Ts/64-5*As/256,sh=3*Mt/8+3*Ts/32+45*As/1024,nh=15*Ts/256+45*As/1024,rh=35*As/3072,oh=3/2*$e-27/32*Zn+269/512*ra,ah=21/16*na-55/32*jn,lh=151/96*Zn-417/128*ra,hh=1097/512*jn,fs=6378137;function ch(i,t,e){const s=i-5e5,n=(e.north?t:t-1e7)/gs/(fs*oa),r=n+oh*Math.sin(2*n)+ah*Math.sin(4*n)+lh*Math.sin(6*n)+hh*Math.sin(8*n),o=Math.sin(r),a=o*o,l=Math.cos(r),h=o/l,c=h*h,u=c*c,d=1-Mt*a,g=Math.sqrt(1-Mt*a),f=fs/g,p=(1-Mt)/d,_=Ce*l**2,m=_*_,y=s/(f*gs),S=y*y,x=S*y,v=x*y,w=v*y,M=w*y,R=r-h/p*(S/2-v/24*(5+3*c+10*_-4*m-9*Ce))+M/720*(61+90*c+298*_+45*u-252*Ce-3*m);let C=(y-x/6*(1+2*c+_)+w/120*(5-2*_+28*c-3*m+8*Ce+24*u))/l;return C=En(C+fe(aa(e.number)),-Math.PI,Math.PI),[Pr(C),Pr(R)]}const Xr=-80,Yr=84,uh=-180,dh=180;function gh(i,t,e){i=En(i,uh,dh),t<Xr?t=Xr:t>Yr&&(t=Yr);const s=fe(t),n=Math.sin(s),r=Math.cos(s),o=n/r,a=o*o,l=a*a,h=fe(i),c=aa(e.number),u=fe(c),d=fs/Math.sqrt(1-Mt*n**2),g=Ce*r**2,f=r*En(h-u,-Math.PI,Math.PI),p=f*f,_=p*f,m=_*f,y=m*f,S=y*f,x=fs*(oa*s-sh*Math.sin(2*s)+nh*Math.sin(4*s)-rh*Math.sin(6*s)),v=gs*d*(f+_/6*(1-a+g)+y/120*(5-18*a+l+72*g-58*Ce))+5e5;let w=gs*(x+d*o*(p/2+m/24*(5-a+9*g+4*g**2)+S/720*(61-58*a+l+600*g-330*Ce)));return e.north||(w+=1e7),[v,w]}function aa(i){return(i-1)*6-180+3}const fh=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function la(i){let t=0;for(const n of fh){const r=i.match(n);if(r){t=parseInt(r[1]);break}}if(!t)return null;let e=0,s=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(s=!0,e=t-32600),e?{number:e,north:s}:null}function Vr(i,t){return function(e,s,n,r){const o=e.length;n=n>1?n:2,r=r??n,s||(n>2?s=e.slice():s=new Array(o));for(let a=0;a<o;a+=r){const l=e[a],h=e[a+1],c=i(l,h,t);s[a]=c[0],s[a+1]=c[1]}return s}}function _h(i){return la(i)?new bi({code:i,units:"m"}):null}function ph(i){const t=la(i.getCode());return t?{forward:Vr(gh,t),inverse:Vr(ch,t)}:null}const mh=[ph],yh=[_h];let wn=!0;function xh(i){wn=!1}function Un(i,t){if(t!==void 0){for(let e=0,s=i.length;e<s;++e)t[e]=i[e];t=t}else t=i.slice();return t}function Rn(i){ih(i.getCode(),i),Oi(i,i,Un)}function vh(i){i.forEach(Rn)}function Tt(i){if(typeof i!="string")return i;const t=eh(i);if(t)return t;for(const e of yh){const s=e(i);if(s)return s}return null}function Kr(i,t,e,s){i=Tt(i);let n;const r=i.getPointResolutionFunc();if(r)n=r(t,e);else{const o=i.getUnits();if(o=="degrees"||s=="degrees")n=t;else{const a=qn(i,Tt("EPSG:4326"));if(!a&&o!=="degrees")n=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=Nr(h.slice(0,2),h.slice(2,4)),u=Nr(h.slice(4,6),h.slice(6,8));n=(c+u)/2}const l=i.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Zr(i){vh(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Oi(t,e,Un)})})}function Eh(i,t,e,s){i.forEach(function(n){t.forEach(function(r){Oi(n,r,e),Oi(r,n,s)})})}function Hn(i,t){return i?typeof i=="string"?Tt(i):i:Tt(t)}function Sh(i){return function(t,e,s,n){const r=t.length;s=s!==void 0?s:2,n=n??s,e=e!==void 0?e:new Array(r);for(let o=0;o<r;o+=n){const a=i(t.slice(o,o+s)),l=a.length;for(let h=0,c=n;h<c;++h)e[o+h]=h>=l?t[o+h]:a[h]}return e}}function jr(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||qn(i,t)===Un)&&e}function qn(i,t){const e=i.getCode(),s=t.getCode();let n=js(e,s);if(n)return n;let r=null,o=null;for(const l of mh)r||(r=l(i)),o||(o=l(t));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)n=Us(r.inverse,o.forward);else{const l=js(e,a);l&&(n=Us(l,o.forward))}else{const l=js(a,s);l&&(n=Us(r.inverse,l))}return n&&(Rn(i),Rn(t),Oi(i,t,n)),n}function Us(i,t){return function(e,s,n,r){return s=i(e,s,n,r),t(s,s,n,r)}}function _s(i,t){const e=Tt(i),s=Tt(t);return qn(e,s)}function ha(i,t,e){const s=_s(t,e);if(!s){const n=Tt(t).getCode(),r=Tt(e).getCode();throw new Error(`No transform available between ${n} and ${r}`)}return s(i,void 0,i.length)}function In(i,t){return i}function Ht(i,t){return wn&&!ds(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(wn=!1,ia("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function ca(i,t){return i}function we(i,t){return i}function Ch(){Zr(Gr),Zr(Br),Eh(Br,Gr,$l,Jl)}Ch();new Array(6);function Ot(){return[1,0,0,1,0,0]}function wh(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function lt(i,t){const e=t[0],s=t[1];return t[0]=i[0]*e+i[2]*s+i[4],t[1]=i[1]*e+i[3]*s+i[5],t}function ee(i,t,e,s,n,r,o,a){const l=Math.sin(r),h=Math.cos(r);return i[0]=s*h,i[1]=n*l,i[2]=-s*l,i[3]=n*h,i[4]=o*s*h-a*s*l+t,i[5]=o*n*l+a*n*h+e,i}function ua(i,t){const e=Rh(t);Q(e!==0,"Transformation matrix cannot be inverted");const s=t[0],n=t[1],r=t[2],o=t[3],a=t[4],l=t[5];return i[0]=o/e,i[1]=-n/e,i[2]=-r/e,i[3]=s/e,i[4]=(r*l-o*a)/e,i[5]=-(s*l-n*a)/e,i}function Rh(i){return i[0]*i[3]-i[1]*i[2]}const Ih=[1e5,1e5,1e5,1e5,2,2];function Mh(i){return"matrix("+i.join(", ")+")"}function Ur(i){return i.substring(7,i.length-1).split(",").map(parseFloat)}function Th(i,t){const e=Ur(i),s=Ur(t);for(let n=0;n<6;++n)if(Math.round((e[n]-s[n])*Ih[n])!==0)return!1;return!0}function _e(i,t,e,s,n,r,o){r=r||[],o=o||2;let a=0;for(let l=t;l<e;l+=s){const h=i[l],c=i[l+1];r[a++]=n[0]*h+n[2]*c+n[4],r[a++]=n[1]*h+n[3]*c+n[5];for(let u=2;u<o;u++)r[a++]=i[l+u]}return r&&r.length!=a&&(r.length=a),r}function $n(i,t,e,s,n,r,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=r[0],c=r[1];let u=0;for(let d=t;d<e;d+=s){const g=i[d]-h,f=i[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let p=d+2;p<d+s;++p)o[u++]=i[p]}return o&&o.length!=u&&(o.length=u),o}function Ah(i,t,e,s,n,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=s){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+n*d,a[c++]=h+r*g;for(let f=u+2;f<u+s;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function Lh(i,t,e,s,n,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=s){o[a++]=i[l]+n,o[a++]=i[l+1]+r;for(let h=l+2;h<l+s;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Hr=Ot(),bh=[NaN,NaN];class Oh extends zt{constructor(){super(),this.extent_=Dt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=zo((t,e,s)=>{if(!s)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(s),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return K()}closestPointXY(t,e,s,n){return K()}containsXY(t,e){return this.closestPointXY(t,e,bh,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return K()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Is(e),this.extentRevision_=this.getRevision()}return Wl(this.extent_,t)}rotate(t,e){K()}scale(t,e,s){K()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return K()}getType(){return K()}applyTransform(t){K()}intersectsExtent(t){return K()}translate(t,e){K()}transform(t,e){const s=Tt(t),n=s.getUnits()=="tile-pixels"?function(r,o,a){const l=s.getExtent(),h=s.getWorldExtent(),c=ot(h)/ot(l);ee(Hr,h[0],h[3],c,-c,0,0,0);const u=_e(r,0,r.length,a,Hr,o),d=_s(s,e);return d?d(u,u,a):u}:_s(s,e);return this.applyTransform(n),this}}let Yi=class extends Oh{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(i){return Bn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i)}getCoordinates(){return K()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(i){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),i<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&i<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(i);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=i,this)}getSimplifiedGeometryInternal(i){return this}getStride(){return this.stride}setFlatCoordinates(i,t){this.stride=qr(i),this.layout=i,this.flatCoordinates=t}setCoordinates(i,t){K()}setLayout(i,t,e){let s;if(i)s=qr(i);else{for(let n=0;n<e;++n){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,i=Dh(s)}this.layout=i,this.stride=s}applyTransform(i){this.flatCoordinates&&(i(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(i,t){const e=this.getFlatCoordinates();if(e){const s=this.getStride();$n(e,0,e.length,s,i,t,e),this.changed()}}scale(i,t,e){t===void 0&&(t=i),e||(e=te(this.getExtent()));const s=this.getFlatCoordinates();if(s){const n=this.getStride();Ah(s,0,s.length,n,i,t,e,s),this.changed()}}translate(i,t){const e=this.getFlatCoordinates();if(e){const s=this.getStride();Lh(e,0,e.length,s,i,t,e),this.changed()}}};function Dh(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function qr(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Ph(i,t,e){const s=i.getFlatCoordinates();if(!s)return null;const n=i.getStride();return _e(s,0,s.length,n,t,e)}function da(i,t,e,s){let n=0;const r=i[e-s],o=i[e-s+1];let a=0,l=0;for(;t<e;t+=s){const h=i[t]-r,c=i[t+1]-o;n+=l*h-a*c,a=h,l=c}return n/2}function kh(i,t,e,s){let n=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];n+=da(i,t,a,s),t=a}return n}function $r(i,t,e,s,n,r,o){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((n-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let g=0;g<s;++g)o[g]=xt(i[t+g],i[e+g],d);o.length=s;return}else u=t}for(let d=0;d<s;++d)o[d]=i[u+d];o.length=s}function Jn(i,t,e,s,n){let r=i[t],o=i[t+1];for(t+=s;t<e;t+=s){const a=i[t],l=i[t+1],h=Ze(r,o,a,l);h>n&&(n=h),r=a,o=l}return n}function Fh(i,t,e,s,n){for(let r=0,o=e.length;r<o;++r){const a=e[r];n=Jn(i,t,a,s,n),t=a}return n}function Qn(i,t,e,s,n,r,o,a,l,h,c){if(t==e)return h;let u,d;if(n===0){if(d=Ze(o,a,i[t],i[t+1]),d<h){for(u=0;u<s;++u)l[u]=i[t+u];return l.length=s,d}return h}c=c||[NaN,NaN];let g=t+s;for(;g<e;)if($r(i,g-s,g,s,o,a,c),d=Ze(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<s;++u)l[u]=c[u];l.length=s,g+=s}else g+=s*Math.max((Math.sqrt(d)-Math.sqrt(h))/n|0,1);if(r&&($r(i,e-s,t,s,o,a,c),d=Ze(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<s;++u)l[u]=c[u];l.length=s}return h}function Nh(i,t,e,s,n,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=Qn(i,t,g,s,n,r,o,a,l,h,c),t=g}return h}function ga(i,t,e,s){for(let n=0,r=e.length;n<r;++n)i[t++]=e[n];return t}function tr(i,t,e,s){for(let n=0,r=e.length;n<r;++n){const o=e[n];for(let a=0;a<s;++a)i[t++]=o[a]}return t}function Gh(i,t,e,s,n){n=n||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=tr(i,t,e[o],s);n[r++]=l,t=l}return n.length=r,n}function Re(i,t,e,s,n){n=n!==void 0?n:[];let r=0;for(let o=t;o<e;o+=s)n[r++]=i.slice(o,o+s);return n.length=r,n}function ps(i,t,e,s,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[r++]=Re(i,t,l,s,n[r]),t=l}return n.length=r,n}function Jr(i,t,e,s,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[r++]=l.length===1&&l[0]===t?[]:ps(i,t,l,s,n[r]),t=l[l.length-1]}return n.length=r,n}function Ls(i,t,e,s,n,r,o){const a=(e-t)/s;if(a<3){for(;t<e;t+=s)r[o++]=i[t],r[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-s];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],p=i[d+1],_=i[u],m=i[u+1];for(let y=d+s;y<u;y+=s){const S=i[y],x=i[y+1],v=Ol(S,x,f,p,_,m);v>g&&(c=y,g=v)}g>n&&(l[(c-t)/s]=1,d+s<c&&h.push(d,c),c+s<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=i[t+u*s],r[o++]=i[t+u*s+1]);return o}function Wh(i,t,e,s,n,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Ls(i,t,c,s,n,r,o),a.push(o),t=c}return o}function Se(i,t){return t*Math.round(i/t)}function Bh(i,t,e,s,n,r,o){if(t==e)return o;let a=Se(i[t],n),l=Se(i[t+1],n);t+=s,r[o++]=a,r[o++]=l;let h,c;do if(h=Se(i[t],n),c=Se(i[t+1],n),t+=s,t==e)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=Se(i[t],n),d=Se(i[t+1],n);if(t+=s,u==h&&d==c)continue;const g=h-a,f=c-l,p=u-a,_=d-l;if(g*_==f*p&&(g<0&&p<g||g==p||g>0&&p>g)&&(f<0&&_<f||f==_||f>0&&_>f)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function fa(i,t,e,s,n,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Bh(i,t,c,s,n,r,o),a.push(o),t=c}return o}class Di extends Yi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Di(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,s,n){return n<Wn(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,s,n))}getArea(){return da(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Re(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ls(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Di(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tr(this.flatCoordinates,0,t,this.stride),this.changed()}}class Vi extends Yi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Vi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,n){const r=this.flatCoordinates,o=Ze(t,e,r[0],r[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)s[l]=r[l];return s.length=a,o}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return $o(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return qo(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ga(this.flatCoordinates,0,t,this.stride),this.changed()}}function zh(i,t,e,s,n){return!Qo(n,function(r){return!Ie(i,t,e,s,r[0],r[1])})}function Ie(i,t,e,s,n,r){let o=0,a=i[e-s],l=i[e-s+1];for(;t<e;t+=s){const h=i[t],c=i[t+1];l<=r?c>r&&(h-a)*(r-l)-(n-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(n-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function _a(i,t,e,s,n,r){if(e.length===0||!Ie(i,t,e[0],s,n,r))return!1;for(let o=1,a=e.length;o<a;++o)if(Ie(i,e[o-1],e[o],s,n,r))return!1;return!0}function er(i,t,e,s,n,r,o){let a,l,h,c,u,d,g;const f=n[r+1],p=[];for(let y=0,S=e.length;y<S;++y){const x=e[y];for(c=i[x-s],d=i[x-s+1],a=t;a<x;a+=s)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,p.push(h)),c=u,d=g}let _=NaN,m=-1/0;for(p.sort(Ae),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const y=Math.abs(u-c);y>m&&(h=(c+u)/2,_a(i,t,e,s,h,f)&&(_=h,m=y)),c=u}return isNaN(_)&&(_=n[r]),o?(o.push(_,f,m),o):[_,f,m]}function Xh(i,t,e,s,n){let r=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=er(i,t,l,s,n,2*o,r),t=l[l.length-1]}return r}function pa(i,t,e,s,n){let r;for(t+=s;t<e;t+=s)if(r=n(i.slice(t-s,t),i.slice(t,t+s)),r)return r;return!1}function ir(i,t,e,s,n,r){return r=r??Jo(Dt(),i,t,e,s),ut(n,r)?r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3]?!0:pa(i,t,e,s,function(o,a){return Bl(n,o,a)}):!1}function Yh(i,t,e,s,n){return!!(ir(i,t,e,s,n)||Ie(i,t,e,s,n[0],n[1])||Ie(i,t,e,s,n[0],n[3])||Ie(i,t,e,s,n[2],n[1])||Ie(i,t,e,s,n[2],n[3]))}function Vh(i,t,e,s,n){if(!Yh(i,t,e[0],s,n))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(zh(i,e[r-1],e[r],s,n)&&!ir(i,e[r-1],e[r],s,n))return!1;return!0}function Kh(i,t,e,s){for(;t<e-s;){for(let n=0;n<s;++n){const r=i[t+n];i[t+n]=i[e-s+n],i[e-s+n]=r}t+=s,e-=s}}function sr(i,t,e,s){let n=0,r=i[e-s],o=i[e-s+1];for(;t<e;t+=s){const a=i[t],l=i[t+1];n+=(a-r)*(l+o),r=a,o=l}return n===0?void 0:n>0}function Zh(i,t,e,s,n){n=n!==void 0?n:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=sr(i,t,a,s);if(r===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;t=a}return!0}function Qr(i,t,e,s,n){n=n!==void 0?n:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=sr(i,t,a,s);(r===0?n&&l||!n&&!l:n&&!l||!n&&l)&&Kh(i,t,a,s),t=a}return t}function jh(i,t){const e=[];let s=0,n=0,r;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=sr(i,s,l,2);if(r===void 0&&(r=h),h===r)e.push(t.slice(n,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[n])}n=o+1,s=l}return e}class Oe extends Yi{constructor(t,e,s){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&s?(this.setFlatCoordinates(e,t),this.ends_=s):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Cs(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Oe(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,s,n){return n<Wn(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,s,n))}containsXY(t,e){return _a(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return kh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Qr(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,ps(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=te(this.getExtent());this.flatInteriorPoint_=er(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Vi(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Di(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,s=this.ends_,n=[];let r=0;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=new Di(e.slice(r,l),t);n.push(h),r=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Zh(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Qr(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],s=[];return e.length=fa(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,s),new Oe(e,"XY",s)}getType(){return"Polygon"}intersectsExtent(t){return Vh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=Gh(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}}function to(i){if(ii(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],s=i[2],n=i[3],r=[t,e,t,n,s,n,s,e,t,e];return new Oe(r,"XY",[r.length])}function nr(i,t,e,s){const n=Z(t)/e[0],r=ot(t)/e[1];return s?Math.min(i,Math.max(n,r)):Math.min(i,Math.min(n,r))}function rr(i,t,e){let s=Math.min(i,t);const n=50;return s*=Math.log(1+n*Math.max(0,i/t-1))/n+1,e&&(s=Math.max(s,e),s/=Math.log(1+n*Math.max(0,e/i-1))/n+1),it(s,e/2,t*2)}function Uh(i,t,e,s){return t=t!==void 0?t:!0,function(n,r,o,a){if(n!==void 0){const l=i[0],h=i[i.length-1],c=e?nr(l,e,o,s):l;if(a)return t?rr(n,c,h):it(n,h,c);const u=Math.min(c,n),d=Math.floor(Fn(i,u,r));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function Hh(i,t,e,s,n,r){return s=s!==void 0?s:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=n?nr(t,n,l,r):t;if(h)return s?rr(o,c,e):it(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),p=Math.floor(Math.log(t/f)/Math.log(i)+g),_=Math.max(d,p),m=t/Math.pow(i,_);return it(m,e,c)}}}function eo(i,t,e,s,n){return e=e!==void 0?e:!0,function(r,o,a,l){if(r!==void 0){const h=s?nr(i,s,a,n):i;return!e||!l?it(r,t,h):rr(r,h,t)}}}function or(i){if(i!==void 0)return 0}function io(i){if(i!==void 0)return i}function qh(i){const t=2*Math.PI/i;return function(e,s){if(s)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function $h(i){const t=fe(5);return function(e,s){return s||e===void 0?e:Math.abs(e)<=t?0:e}}const Jh=256,Hs=0;class Nt extends zt{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Hn(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&xh(),t.center&&(t.center=Ht(t.center,this.projection_)),t.extent&&(t.extent=we(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in At)delete e[a];this.setProperties(e,!0);const s=tc(t);this.maxResolution_=s.maxResolution,this.minResolution_=s.minResolution,this.zoomFactor_=s.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=s.minZoom;const n=Qh(t),r=s.constraint,o=ec(t);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const s=this.getCenterInternal();if(s){const n=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),o=r/2*(n[3]-e[3]+e[1]-n[1]),a=r/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([s[0]+o,s[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let s=0;s<e.length;++s){let n=arguments[s];n.center&&(n=Object.assign({},n),n.center=Ht(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Ht(n.anchor,this.getProjection())),e[s]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,s;e>1&&typeof arguments[e-1]=="function"&&(s=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const c=arguments[n];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(n===e){s&&ss(s,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<e;++n){const c=arguments[n],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||Zl,callback:s};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Ci(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}ic(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(rt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[rt.ANIMATING]>0}getInteracting(){return this.hints_[rt.INTERACTING]>0}cancelAnimations(){this.setHint(rt.ANIMATING,-this.hints_[rt.ANIMATING]);let t;for(let e=0,s=this.animations_.length;e<s;++e){const n=this.animations_[e];if(n[0].callback&&ss(n[0].callback,!1),!t)for(let r=0,o=n.length;r<o;++r){const a=n[r];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let s=this.animations_.length-1;s>=0;--s){const n=this.animations_[s];let r=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;const _=d+u*(f-d),m=g+u*(p-g);this.targetCenter_=[_,m]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Ci(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(r){this.animations_[s]=null,this.setHint(rt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&ss(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let s;const n=this.getCenterInternal();return n!==void 0&&(s=[n[0]-e[0],n[1]-e[1]],Kn(s,t-this.getRotation()),Xl(s,e)),s}calculateCenterZoom(t,e){let s;const n=this.getCenterInternal(),r=this.getResolution();if(n!==void 0&&r!==void 0){const o=e[0]-t*(e[0]-n[0])/r,a=e[1]-t*(e[1]-n[1])/r;s=[o,a]}return s}getViewportSize_(t){const e=this.viewportSize_;if(t){const s=e[0],n=e[1];return[Math.abs(s*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(s*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&In(t,this.getProjection())}getCenterInternal(){return this.get(At.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return ca(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Q(e,"The view center is not defined");const s=this.getResolution();Q(s!==void 0,"The view resolution is not defined");const n=this.getRotation();return Q(n!==void 0,"The view rotation is not defined"),us(e,s,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(At.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(we(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const s=Z(t)/e[0],n=ot(t)/e[1];return Math.max(s,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,n=Math.log(e/s)/Math.log(t);return function(r){return e/Math.pow(t,r*n)}}getRotation(){return this.get(At.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),s=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(s/n)/e;return function(o){return Math.log(s/o)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const s=this.padding_;return s&&(e=[e[0]-s[1]-s[3],e[1]-s[0]-s[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),s=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=qs(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],e,s)}return{center:n.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:s,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,s,n;if(this.resolutions_){const r=Fn(this.resolutions_,t,1);e=r,s=this.resolutions_[r],r==this.resolutions_.length-1?n=2:n=s/this.resolutions_[r+1]}else s=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(s/t)/Math.log(n)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const s=it(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[s]/this.resolutions_[s+1];return this.resolutions_[s]/Math.pow(n,it(t-s,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let s;if(Q(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Q(!ii(t),"Cannot fit empty extent provided as `geometry`");const n=we(t,this.getProjection());s=to(n)}else if(t.getType()==="Circle"){const n=we(t.getExtent(),this.getProjection());s=to(n),s.rotate(this.getRotation(),te(n))}else s=t;this.fitInternal(s,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),s=Math.cos(e),n=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const g=r[u]*s-r[u+1]*n,f=r[u]*n+r[u+1]*s;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let s=e.size;s||(s=this.getViewportSizeMinusPadding_());const n=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[s[0]-n[1]-n[3],s[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=te(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,p=this.getConstrainedCenter([g,f],l),_=e.callback?e.callback:Ti;e.duration!==void 0?this.animateInternal({resolution:l,center:p,duration:e.duration,easing:e.easing},_):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),ss(_,!0))}centerOn(t,e,s){this.centerOnInternal(Ht(t,this.getProjection()),e,s)}centerOnInternal(t,e,s){this.setCenterInternal(qs(t,e,s,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,s,n){let r;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-s),l=qs(t,n,[a[0]/2+o[3],a[1]/2+o[0]],e,s);r=[t[0]-l[0],t[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=In(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Ht(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const s=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,n,s);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Ht(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const s=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,s);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Ht(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const s=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,s),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,s),a=this.constraints_.center(this.targetCenter_,o,r,s,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(At.ROTATION)!==n&&this.set(At.ROTATION,n),this.get(At.RESOLUTION)!==o&&(this.set(At.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(At.CENTER)||!ds(this.get(At.CENTER),a))&&this.set(At.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,s){t=t!==void 0?t:200;const n=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}s=s||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!ds(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:t,easing:si,anchor:s}))}beginInteraction(){this.resolveConstraints(0),this.setHint(rt.INTERACTING,1)}endInteraction(t,e,s){s=s&&Ht(s,this.getProjection()),this.endInteractionInternal(t,e,s)}endInteractionInternal(t,e,s){this.getInteracting()&&(this.setHint(rt.INTERACTING,-1),this.resolveConstraints(t,e,s))}getConstrainedCenter(t,e){const s=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),s)}getConstrainedZoom(t,e){const s=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(s,e))}getConstrainedResolution(t,e){e=e||0;const s=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,s)}}function ss(i,t){setTimeout(function(){i(t)},0)}function Qh(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return kr(i.extent,i.constrainOnlyCenter,e)}const t=Hn(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,kr(e,!1,!1)}return Pl}function tc(i){let t,e,s,n=i.minZoom!==void 0?i.minZoom:Hs,r=i.maxZoom!==void 0?i.maxZoom:28;const o=i.zoomFactor!==void 0?i.zoomFactor:2,a=i.multiWorld!==void 0?i.multiWorld:!1,l=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,h=i.showFullExtent!==void 0?i.showFullExtent:!1,c=Hn(i.projection,"EPSG:3857"),u=c.getExtent();let d=i.constrainOnlyCenter,g=i.extent;if(!a&&!g&&c.isGlobal()&&(d=!1,g=u),i.resolutions!==void 0){const f=i.resolutions;e=f[n],s=f[r]!==void 0?f[r]:f[f.length-1],i.constrainResolution?t=Uh(f,l,!d&&g,h):t=eo(e,s,l,!d&&g,h)}else{const f=(u?Math.max(Z(u),ot(u)):360*sa.degrees/c.getMetersPerUnit())/Jh/Math.pow(2,Hs),p=f/Math.pow(2,28-Hs);e=i.maxResolution,e!==void 0?n=0:e=f/Math.pow(o,n),s=i.minResolution,s===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?s=e/Math.pow(o,r):s=f/Math.pow(o,r):s=p),r=n+Math.floor(Math.log(e/s)/Math.log(o)),s=e/Math.pow(o,r-n),i.constrainResolution?t=Hh(o,e,s,l,!d&&g,h):t=eo(e,s,l,!d&&g,h)}return{constraint:t,maxResolution:e,minResolution:s,minZoom:n,zoomFactor:o}}function ec(i){if(i.enableRotation===void 0||i.enableRotation){const t=i.constrainRotation;return t===void 0||t===!0?$h():t===!1?io:typeof t=="number"?qh(t):io}return or}function ic(i){return!(i.sourceCenter&&i.targetCenter&&!ds(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function qs(i,t,e,s,n){const r=Math.cos(-n);let o=Math.sin(-n),a=i[0]*r-i[1]*o,l=i[1]*r+i[0]*o;a+=(t[0]/2-e[0])*s,l+=(e[1]-t[1]/2)*s,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const ns="ol-hidden",bs="ol-unselectable",ar="ol-control",so="ol-collapsed",sc=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),no=["style","variant","weight","size","lineHeight","family"],ma=function(i){const t=i.match(sc);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let s=0,n=no.length;s<n;++s){const r=t[s+1];r!==void 0&&(e[no[s]]=r)}return e.families=e.family.split(/,\s?/),e};function at(i,t,e,s){let n;return e&&e.length?n=e.shift():Ko?n=new OffscreenCanvas(i||300,t||300):n=document.createElement("canvas"),i&&(n.width=i),t&&(n.height=t),n.getContext("2d",s)}let $s;function ms(){return $s||($s=at(1,1)),$s}function lr(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function ro(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function nc(i){for(;i.lastChild;)i.lastChild.remove()}function rc(i,t){const e=i.childNodes;for(let s=0;;++s){const n=e[s],r=t[s];if(!n&&!r)break;if(n!==r){if(!n){i.appendChild(r);continue}if(!r){i.removeChild(n),--s;continue}i.insertBefore(r,n)}}}class hr extends zt{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let s=0,n=this.listenerKeys.length;s<n;++s)tt(this.listenerKeys[s]);if(this.listenerKeys.length=0,this.map_=t,t){const s=this.target_??t.getOverlayContainerStopEvent();this.element&&s.appendChild(this.element),this.render!==Ti&&this.listenerKeys.push(X(t,ce.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class oc extends hr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",s=t.tipLabel!==void 0?t.tipLabel:"Attributions",n=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=s,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(N.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+bs+" "+ar+(this.collapsed_&&this.collapsible_?" "+so:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),s=new Set(e.flatMap(n=>n.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(n=>s.add(n)):s.add(this.attributions_)),!this.overrideCollapsible_){const n=!e.some(r=>{var o;return((o=r.getSource())==null?void 0:o.getAttributionsCollapsible())===!1});this.setCollapsible(n)}return Array.from(s)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(n=>Xo(()=>n))),s=e.length>0;if(this.renderedVisible_!=s&&(this.element.style.display=s?"":"none",this.renderedVisible_=s),!me(e,this.renderedAttributions_)){nc(this.ulElement_);for(let n=0,r=e.length;n<r;++n){const o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(so),this.collapsed_?ro(this.collapseLabel_,this.label_):ro(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class ac extends hr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",s=t.label!==void 0?t.label:"⇧",n=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof s=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=s):(this.label_=s,this.label_.classList.add(n));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(N.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+bs+" "+ar,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ns)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();e!==void 0&&(this.duration_>0&&e%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:si}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const s=e.viewState.rotation;if(s!=this.rotation_){const n="rotate("+s+"rad)";if(this.autoHide_){const r=this.element.classList.contains(ns);!r&&s===0?this.element.classList.add(ns):r&&s!==0&&this.element.classList.remove(ns)}this.label_.style.transform=n}this.rotation_=s}}class lc extends hr{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",s=t.delta!==void 0?t.delta:1,n=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(N.CLICK,this.handleClick_.bind(this,s),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(N.CLICK,this.handleClick_.bind(this,-s),!1);const d=e+" "+bs+" "+ar,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const s=e.getZoom();if(s!==void 0){const n=e.getConstrainedZoom(s+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:si})):e.setZoom(n)}}}function hc(i){i=i||{};const t=new Wt;return(i.zoom===void 0||i.zoom)&&t.push(new lc(i.zoomOptions)),(i.rotate===void 0||i.rotate)&&t.push(new ac(i.rotateOptions)),(i.attribution===void 0||i.attribution)&&t.push(new oc(i.attributionOptions)),t}class cc{constructor(t,e,s){this.decay_=t,this.minVelocity_=e,this.delay_=s,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let s=e-3;for(;s>0&&this.points_[s+2]>t;)s-=3;const n=this.points_[e+2]-this.points_[s+2];if(n<1e3/60)return!1;const r=this.points_[e]-this.points_[s],o=this.points_[e+1]-this.points_[s+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const oo={ACTIVE:"active"};class Ki extends zt{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(oo.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(oo.ACTIVE,t)}setMap(t){this.map_=t}}function uc(i,t,e){const s=i.getCenterInternal();if(s){const n=[s[0]+t[0],s[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:jl,center:i.getConstrainedCenter(n)})}}function cr(i,t,e,s){const n=i.getZoom();if(n===void 0)return;const r=i.getConstrainedZoom(n+t),o=i.getResolutionForZoom(r);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:e,duration:s!==void 0?s:250,easing:si})}class ya extends Ki{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==J.DBLCLICK){const s=t.originalEvent,n=t.map,r=t.coordinate,o=s.shiftKey?-this.delta_:this.delta_,a=n.getView();cr(a,o,r,this.duration_),s.preventDefault(),e=!0}return!e}}function Mn(i){const t=arguments;return function(e){let s=!0;for(let n=0,r=t.length;n<r&&(s=s&&t[n](e),!!s);++n);return s}}const dc=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},gc=function(i){const t=i.map.getTargetElement(),e=t.getRootNode(),s=i.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(s):t.contains(s)},xa=function(i){const t=i.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?gc(i):!0},fc=Mi,va=function(i){const t=i.originalEvent;return t instanceof PointerEvent&&t.button==0&&!(Il&&Vo&&t.ctrlKey)},Ea=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},_c=function(i){const t=i.originalEvent;return Vo?t.metaKey:t.ctrlKey},pc=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Sa=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Js=function(i){const t=i.originalEvent;return t instanceof PointerEvent&&t.pointerType=="mouse"},mc=function(i){const t=i.originalEvent;return t instanceof PointerEvent&&t.isPrimary&&t.button===0};let Zi=class extends Ki{constructor(i){i=i||{},super(i),i.handleDownEvent&&(this.handleDownEvent=i.handleDownEvent),i.handleDragEvent&&(this.handleDragEvent=i.handleDragEvent),i.handleMoveEvent&&(this.handleMoveEvent=i.handleMoveEvent),i.handleUpEvent&&(this.handleUpEvent=i.handleUpEvent),i.stopDown&&(this.stopDown=i.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(i){return!1}handleDragEvent(i){}handleEvent(i){if(!i.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(i),this.handlingDownUpSequence){if(i.type==J.POINTERDRAG)this.handleDragEvent(i),i.originalEvent.preventDefault();else if(i.type==J.POINTERUP){const e=this.handleUpEvent(i);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(i.type==J.POINTERDOWN){const e=this.handleDownEvent(i);this.handlingDownUpSequence=e,t=this.stopDown(e)}else i.type==J.POINTERMOVE&&this.handleMoveEvent(i);return!t}handleMoveEvent(i){}handleUpEvent(i){return!1}stopDown(i){return i}updateTrackedPointers_(i){i.activePointers&&(this.targetPointers=i.activePointers)}};function ur(i){const t=i.length;let e=0,s=0;for(let n=0;n<t;n++)e+=i[n].clientX,s+=i[n].clientY;return{clientX:e/t,clientY:s/t}}class yc extends Zi{constructor(t){super({stopDown:ws}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Mn(Ea,mc);this.condition_=t.onFocusOnly?Mn(xa,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const s=this.targetPointers,n=e.getEventPixel(ur(s));if(s.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],o=t.map.getView();Yl(r,o.getResolution()),Kn(r,o.getRotation()),o.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=s.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,s=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=s.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-n*Math.cos(r),a[1]-n*Math.sin(r)]);s.animateInternal({center:s.getConstrainedCenter(l),duration:500,easing:si})}return this.panning_&&(this.panning_=!1,s.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class xc extends Zi{constructor(t){t=t||{},super({stopDown:ws}),this.condition_=t.condition?t.condition:dc,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Js(t))return;const e=t.map,s=e.getView();if(s.getConstraints().rotation===or)return;const n=e.getSize(),r=t.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;s.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return Js(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Js(t)&&va(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class vc extends kn{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,s="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+s,n.top=Math.min(t[1],e[1])+s,n.width=Math.abs(e[0]-t[0])+s,n.height=Math.abs(e[1]-t[1])+s}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Oe([s])}getGeometry(){return this.geometry_}}const Fe={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class gi extends ie{constructor(t,e,s){super(t),this.coordinate=e,this.mapBrowserEvent=s}}class Ec extends Zi{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new vc(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??va,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,s){const n=s[0]-e[0],r=s[1]-e[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new gi(Fe.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new gi(e?Fe.BOXEND:Fe.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new gi(Fe.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new gi(Fe.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new gi(Fe.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class Sc extends Ec{constructor(t){t=t||{};const e=t.condition?t.condition:pc;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const e=this.getMap().getView();let s=this.getGeometry();if(this.out_){const n=e.rotatedExtentForGeometry(s),r=e.getResolutionForExtentInternal(n),o=e.getResolution()/r;s=s.clone(),s.scale(o*o)}e.fitInternal(s,{duration:this.duration_,easing:si})}}const Ee={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Cc extends Ki{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Ea(e)&&Sa(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==N.KEYDOWN){const s=t.originalEvent,n=s.key;if(this.condition_(t)&&(n==Ee.DOWN||n==Ee.LEFT||n==Ee.RIGHT||n==Ee.UP)){const r=t.map.getView(),o=r.getResolution()*this.pixelDelta_;let a=0,l=0;n==Ee.DOWN?l=-o:n==Ee.LEFT?a=-o:n==Ee.RIGHT?a=o:l=o;const h=[a,l];Kn(h,r.getRotation()),uc(r,h,this.duration_),s.preventDefault(),e=!0}}return!e}}class wc extends Ki{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!_c(e)&&Sa(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==N.KEYDOWN||t.type==N.KEYPRESS){const s=t.originalEvent,n=s.key;if(this.condition_(t)&&(n==="+"||n==="-")){const r=t.map,o=n==="+"?this.delta_:-this.delta_,a=r.getView();cr(a,o,void 0,this.duration_),s.preventDefault(),e=!0}}return!e}}class Ca extends Ki{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:fc;this.condition_=t.onFocusOnly?Mn(xa,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==N.WHEEL)return!0;const e=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let n;if(t.type==N.WHEEL&&(n=s.deltaY,s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)),n===0)return!1;this.lastDelta_=n;const r=Date.now();this.startTime_===void 0&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?"trackpad":"wheel");const o=e.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-n/this.deltaPerZoom_,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=r,!1;this.totalDelta_+=n;const a=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),a),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let s=-it(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(s=s?s>0?1:-1:0),cr(e,s,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class Rc extends Zi{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ws),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const s=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-s.clientY,n.clientX-s.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=r;const o=t.map,a=o.getView();a.getConstraints().rotation!==or&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(ur(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class Ic extends Zi{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ws),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const s=this.targetPointers[0],n=this.targetPointers[1],r=s.clientX-n.clientX,o=s.clientY-n.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(ur(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function wa(i){i=i||{};const t=new Wt,e=new cc(-.005,.05,100);return(i.altShiftDragRotate===void 0||i.altShiftDragRotate)&&t.push(new xc),(i.doubleClickZoom===void 0||i.doubleClickZoom)&&t.push(new ya({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan===void 0||i.dragPan)&&t.push(new yc({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate===void 0||i.pinchRotate)&&t.push(new Rc),(i.pinchZoom===void 0||i.pinchZoom)&&t.push(new Ic({duration:i.zoomDuration})),(i.keyboard===void 0||i.keyboard)&&(t.push(new Cc),t.push(new wc({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom===void 0||i.mouseWheelZoom)&&t.push(new Ca({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom===void 0||i.shiftDragZoom)&&t.push(new Sc({duration:i.zoomDuration})),t}const U={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Ra extends zt{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[U.OPACITY]=t.opacity!==void 0?t.opacity:1,Q(typeof e[U.OPACITY]=="number","Layer opacity must be a number"),e[U.VISIBLE]=t.visible!==void 0?t.visible:!0,e[U.Z_INDEX]=t.zIndex,e[U.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[U.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[U.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[U.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},s=this.getZIndex();return e.opacity=it(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=s===void 0&&!e.managed?1/0:s,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return K()}getLayerStatesArray(t){return K()}getExtent(){return this.get(U.EXTENT)}getMaxResolution(){return this.get(U.MAX_RESOLUTION)}getMinResolution(){return this.get(U.MIN_RESOLUTION)}getMinZoom(){return this.get(U.MIN_ZOOM)}getMaxZoom(){return this.get(U.MAX_ZOOM)}getOpacity(){return this.get(U.OPACITY)}getSourceState(){return K()}getVisible(){return this.get(U.VISIBLE)}getZIndex(){return this.get(U.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(U.EXTENT,t)}setMaxResolution(t){this.set(U.MAX_RESOLUTION,t)}setMinResolution(t){this.set(U.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(U.MAX_ZOOM,t)}setMinZoom(t){this.set(U.MIN_ZOOM,t)}setOpacity(t){Q(typeof t=="number","Layer opacity must be a number"),this.set(U.OPACITY,t)}setVisible(t){this.set(U.VISIBLE,t)}setZIndex(t){this.set(U.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}let ue=class extends ie{constructor(i,t){super(i),this.layer=t}};const Qs={LAYERS:"layers"};class ni extends Ra{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let s=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Qs.LAYERS,this.handleLayersChanged_),s?Array.isArray(s)?s=new Wt(s.slice(),{unique:!0}):Q(typeof s.getArray=="function","Expected `layers` to be an array or a `Collection`"):s=new Wt(void 0,{unique:!0}),this.setLayers(s)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(tt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(X(t,_t.ADD,this.handleLayersAdd_,this),X(t,_t.REMOVE,this.handleLayersRemove_,this));for(const s in this.listenerKeys_)this.listenerKeys_[s].forEach(tt);zi(this.listenerKeys_);const e=t.getArray();for(let s=0,n=e.length;s<n;s++){const r=e[s];this.registerLayerListeners_(r),this.dispatchEvent(new ue("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[X(t,He.PROPERTYCHANGE,this.handleLayerChange_,this),X(t,N.CHANGE,this.handleLayerChange_,this)];t instanceof ni&&e.push(X(t,"addlayer",this.handleLayerGroupAdd_,this),X(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[et(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new ue("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new ue("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new ue("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,s=et(e);this.listenerKeys_[s].forEach(tt),delete this.listenerKeys_[s],this.dispatchEvent(new ue("removelayer",e)),this.changed()}getLayers(){return this.get(Qs.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const s=e.getArray();for(let n=0,r=s.length;n<r;++n)this.dispatchEvent(new ue("removelayer",s[n]))}this.set(Qs.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],s=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const n=this.getLayerState();let r=n.zIndex;!t&&n.zIndex===void 0&&(r=0);for(let o=s,a=e.length;o<a;o++){const l=e[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=Yn(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}const Rt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Os extends Ra{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(U.SOURCE,this.handleSourcePropertyChange_);const s=t.source?t.source:null;this.setSource(s)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(U.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(tt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=X(t,N.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const s=this.getMapInternal();!t&&s&&(t=s.getView()),t instanceof Nt?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&s&&(e.layerStatesArray=s.getLayerGroup().getLayerStatesArray());let n;if(e.layerStatesArray){if(n=e.layerStatesArray.find(o=>o.layer===this),!n)return!1}else n=this.getLayerState();const r=this.getExtent();return dr(n,e.viewState)&&(!r||ut(r,e.extent))}getAttributions(t){var e;if(!this.isVisible(t))return[];const s=(e=this.getSource())==null?void 0:e.getAttributions();if(!s)return[];const n=t instanceof Nt?t.getViewStateAndExtent():t;let r=s(n);return Array.isArray(r)||(r=[r]),r}render(t,e){const s=this.getRenderer();return s.prepareFrame(t)?(this.rendered=!0,s.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(U.MAP,t)}getMapInternal(){return this.get(U.MAP)}setMap(t){this.mapPrecomposeKey_&&(tt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(tt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=X(t,Rt.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=X(this,N.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,s=this.getLayerState(!1);Q(!e.some(n=>n.layer===s.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(s)}setSource(t){this.set(U.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function dr(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const s=t.zoom;return s>i.minZoom&&s<=i.maxZoom}function Ia(i,t,e=0,s=i.length-1,n=Mc){for(;s>e;){if(s-e>600){const l=s-e+1,h=t-e+1,c=Math.log(l),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),g=Math.max(e,Math.floor(t-h*u/l+d)),f=Math.min(s,Math.floor(t+(l-h)*u/l+d));Ia(i,t,g,f,n)}const r=i[t];let o=e,a=s;for(fi(i,e,t),n(i[s],r)>0&&fi(i,e,s);o<a;){for(fi(i,o,a),o++,a--;n(i[o],r)<0;)o++;for(;n(i[a],r)>0;)a--}n(i[e],r)===0?fi(i,e,a):(a++,fi(i,a,s)),a<=t&&(e=a+1),t<=a&&(s=a-1)}}function fi(i,t,e){const s=i[t];i[t]=i[e],i[e]=s}function Mc(i,t){return i<t?-1:i>t?1:0}let Ma=class{constructor(i=9){this._maxEntries=Math.max(4,i),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(i){let t=this.data;const e=[];if(!os(i,t))return e;const s=this.toBBox,n=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],a=t.leaf?s(o):o;os(i,a)&&(t.leaf?e.push(o):en(i,a)?this._all(o,e):n.push(o))}t=n.pop()}return e}collides(i){let t=this.data;if(!os(i,t))return!1;const e=[];for(;t;){for(let s=0;s<t.children.length;s++){const n=t.children[s],r=t.leaf?this.toBBox(n):n;if(os(i,r)){if(t.leaf||en(i,r))return!0;e.push(n)}}t=e.pop()}return!1}load(i){if(!(i&&i.length))return this;if(i.length<this._minEntries){for(let e=0;e<i.length;e++)this.insert(i[e]);return this}let t=this._build(i.slice(),0,i.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(i){return i&&this._insert(i,this.data.height-1),this}clear(){return this.data=ze([]),this}remove(i,t){if(!i)return this;let e=this.data;const s=this.toBBox(i),n=[],r=[];let o,a,l;for(;e||n.length;){if(e||(e=n.pop(),a=n[n.length-1],o=r.pop(),l=!0),e.leaf){const h=Tc(i,e.children,t);if(h!==-1)return e.children.splice(h,1),n.push(e),this._condense(n),this}!l&&!e.leaf&&en(e,s)?(n.push(e),r.push(o),o=0,a=e,e=e.children[0]):a?(o++,e=a.children[o],l=!1):e=null}return this}toBBox(i){return i}compareMinX(i,t){return i.minX-t.minX}compareMinY(i,t){return i.minY-t.minY}toJSON(){return this.data}fromJSON(i){return this.data=i,this}_all(i,t){const e=[];for(;i;)i.leaf?t.push(...i.children):e.push(...i.children),i=e.pop();return t}_build(i,t,e,s){const n=e-t+1;let r=this._maxEntries,o;if(n<=r)return o=ze(i.slice(t,e+1)),Ne(o,this.toBBox),o;s||(s=Math.ceil(Math.log(n)/Math.log(r)),r=Math.ceil(n/Math.pow(r,s-1))),o=ze([]),o.leaf=!1,o.height=s;const a=Math.ceil(n/r),l=a*Math.ceil(Math.sqrt(r));ao(i,t,e,l,this.compareMinX);for(let h=t;h<=e;h+=l){const c=Math.min(h+l-1,e);ao(i,h,c,a,this.compareMinY);for(let u=h;u<=c;u+=a){const d=Math.min(u+a-1,c);o.children.push(this._build(i,u,d,s-1))}}return Ne(o,this.toBBox),o}_chooseSubtree(i,t,e,s){for(;s.push(t),!(t.leaf||s.length-1===e);){let n=1/0,r=1/0,o;for(let a=0;a<t.children.length;a++){const l=t.children[a],h=tn(l),c=bc(i,l)-h;c<r?(r=c,n=h<n?h:n,o=l):c===r&&h<n&&(n=h,o=l)}t=o||t.children[0]}return t}_insert(i,t,e){const s=e?i:this.toBBox(i),n=[],r=this._chooseSubtree(s,this.data,t,n);for(r.children.push(i),yi(r,s);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(s,n,t)}_split(i,t){const e=i[t],s=e.children.length,n=this._minEntries;this._chooseSplitAxis(e,n,s);const r=this._chooseSplitIndex(e,n,s),o=ze(e.children.splice(r,e.children.length-r));o.height=e.height,o.leaf=e.leaf,Ne(e,this.toBBox),Ne(o,this.toBBox),t?i[t-1].children.push(o):this._splitRoot(e,o)}_splitRoot(i,t){this.data=ze([i,t]),this.data.height=i.height+1,this.data.leaf=!1,Ne(this.data,this.toBBox)}_chooseSplitIndex(i,t,e){let s,n=1/0,r=1/0;for(let o=t;o<=e-t;o++){const a=mi(i,0,o,this.toBBox),l=mi(i,o,e,this.toBBox),h=Oc(a,l),c=tn(a)+tn(l);h<n?(n=h,s=o,r=c<r?c:r):h===n&&c<r&&(r=c,s=o)}return s||e-t}_chooseSplitAxis(i,t,e){const s=i.leaf?this.compareMinX:Ac,n=i.leaf?this.compareMinY:Lc,r=this._allDistMargin(i,t,e,s),o=this._allDistMargin(i,t,e,n);r<o&&i.children.sort(s)}_allDistMargin(i,t,e,s){i.children.sort(s);const n=this.toBBox,r=mi(i,0,t,n),o=mi(i,e-t,e,n);let a=rs(r)+rs(o);for(let l=t;l<e-t;l++){const h=i.children[l];yi(r,i.leaf?n(h):h),a+=rs(r)}for(let l=e-t-1;l>=t;l--){const h=i.children[l];yi(o,i.leaf?n(h):h),a+=rs(o)}return a}_adjustParentBBoxes(i,t,e){for(let s=e;s>=0;s--)yi(t[s],i)}_condense(i){for(let t=i.length-1,e;t>=0;t--)i[t].children.length===0?t>0?(e=i[t-1].children,e.splice(e.indexOf(i[t]),1)):this.clear():Ne(i[t],this.toBBox)}};function Tc(i,t,e){if(!e)return t.indexOf(i);for(let s=0;s<t.length;s++)if(e(i,t[s]))return s;return-1}function Ne(i,t){mi(i,0,i.children.length,t,i)}function mi(i,t,e,s,n){n||(n=ze(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=t;r<e;r++){const o=i.children[r];yi(n,i.leaf?s(o):o)}return n}function yi(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function Ac(i,t){return i.minX-t.minX}function Lc(i,t){return i.minY-t.minY}function tn(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function rs(i){return i.maxX-i.minX+(i.maxY-i.minY)}function bc(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function Oc(i,t){const e=Math.max(i.minX,t.minX),s=Math.max(i.minY,t.minY),n=Math.min(i.maxX,t.maxX),r=Math.min(i.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,r-s)}function en(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function os(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function ze(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ao(i,t,e,s,n){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=s)continue;const o=t+Math.ceil((e-t)/s/2)*s;Ia(i,o,t,e,n),r.push(t,o,o,e)}}const gr=[NaN,NaN,NaN,0];let sn;function Dc(){return sn||(sn=at(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),sn}const Pc=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,kc=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Fc=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Nc=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function as(i,t){return i.endsWith("%")?Number(i.substring(0,i.length-1))/t:Number(i)}function Ri(i){throw new Error('failed to parse "'+i+'" as color')}function Ta(i){if(i.toLowerCase().startsWith("rgb")){const r=i.match(kc)||i.match(Pc)||i.match(Fc);if(r){const o=r[4],a=100/255;return[it(as(r[1],a)+.5|0,0,255),it(as(r[2],a)+.5|0,0,255),it(as(r[3],a)+.5|0,0,255),o!==void 0?it(as(o,100),0,1):1]}Ri(i)}if(i.startsWith("#")){if(Nc.test(i)){const r=i.substring(1),o=r.length<=4?1:2,a=[0,0,0,255];for(let l=0,h=r.length;l<h;l+=o){let c=parseInt(r.substring(l,l+o),16);o===1&&(c+=c<<4),a[l/o]=c}return a[3]=a[3]/255,a}Ri(i)}const t=Dc();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=i,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=i,t.fillStyle===e&&Ri(i));const s=t.fillStyle;if(s.startsWith("#")||s.startsWith("rgba"))return Ta(s);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const n=Array.from(t.getImageData(0,0,1,1).data);return n[3]=Nn(n[3]/255,3),n}function Gc(i){return typeof i=="string"?i:_r(i)}const Wc=1024,_i={};let nn=0;function Bc(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function rn(i){return i>.0031308?Math.pow(i,1/2.4)*269.025-14.025:i*3294.6}function on(i){return i>.2068965?Math.pow(i,3):(i-4/29)*(108/841)}function an(i){return i>10.314724?Math.pow((i+14.025)/269.025,2.4):i/3294.6}function ln(i){return i>.0088564?Math.pow(i,1/3):i/(108/841)+4/29}function lo(i){const t=an(i[0]),e=an(i[1]),s=an(i[2]),n=ln(t*.222488403+e*.716873169+s*.06060791),r=500*(ln(t*.452247074+e*.399439023+s*.148375274)-n),o=200*(n-ln(t*.016863605+e*.117638439+s*.865350722)),a=Math.atan2(o,r)*(180/Math.PI);return[116*n-16,Math.sqrt(r*r+o*o),a<0?a+360:a,i[3]]}function zc(i){const t=(i[0]+16)/116,e=i[1],s=i[2]*Math.PI/180,n=on(t),r=on(t+e/500*Math.cos(s)),o=on(t-e/200*Math.sin(s)),a=rn(r*3.021973625-n*1.617392459-o*.404875592),l=rn(r*-.943766287+n*1.916279586+o*.027607165),h=rn(r*.069407491-n*.22898585+o*1.159737864);return[it(a+.5|0,0,255),it(l+.5|0,0,255),it(h+.5|0,0,255),i[3]]}function fr(i){if(i==="none")return gr;if(_i.hasOwnProperty(i))return _i[i];if(nn>=Wc){let e=0;for(const s in _i)!(e++&3)&&(delete _i[s],--nn)}const t=Ta(i);t.length!==4&&Ri(i);for(const e of t)isNaN(e)&&Ri(i);return _i[i]=t,++nn,t}function Je(i){return Array.isArray(i)?i:fr(i)}function _r(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let s=i[2];s!=(s|0)&&(s=s+.5|0);const n=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+s+","+n+")"}function ho(i){return i[0]>0&&i[1]>0}function Qe(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}let Pe=0;const gt=1<<Pe++,W=1<<Pe++,pt=1<<Pe++,bt=1<<Pe++,De=1<<Pe++,xi=1<<Pe++,ls=Math.pow(2,Pe)-1,pr={[gt]:"boolean",[W]:"number",[pt]:"string",[bt]:"color",[De]:"number[]",[xi]:"size"},Xc=Object.keys(pr).map(Number).sort(Ae);function Yc(i){return i in pr}function vi(i){const t=[];for(const e of Xc)Ei(i,e)&&t.push(pr[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Ei(i,t){return(i&t)===t}function re(i,t){return i===t}class st{constructor(t,e){if(!Yc(t))throw new Error(`literal expressions must have a specific type, got ${vi(t)}`);this.type=t,this.value=e}}class Vc{constructor(t,e,...s){this.type=t,this.operator=e,this.args=s}}function Aa(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function ht(i,t,e){switch(typeof i){case"boolean":{if(re(t,pt))return new st(pt,i?"true":"false");if(!Ei(t,gt))throw new Error(`got a boolean, but expected ${vi(t)}`);return new st(gt,i)}case"number":{if(re(t,xi))return new st(xi,Qe(i));if(re(t,gt))return new st(gt,!!i);if(re(t,pt))return new st(pt,i.toString());if(!Ei(t,W))throw new Error(`got a number, but expected ${vi(t)}`);return new st(W,i)}case"string":{if(re(t,bt))return new st(bt,fr(i));if(re(t,gt))return new st(gt,!!i);if(!Ei(t,pt))throw new Error(`got a string, but expected ${vi(t)}`);return new st(pt,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return eu(i,t,e);for(const s of i)if(typeof s!="number")throw new Error("expected an array of numbers");if(re(t,xi)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new st(xi,i)}if(re(t,bt)){if(i.length===3)return new st(bt,[...i,1]);if(i.length===4)return new st(bt,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!Ei(t,De))throw new Error(`got an array of numbers, but expected ${vi(t)}`);return new st(De,i)}const E={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Kc={[E.Get]:O(F(1,1/0),co),[E.Var]:O(F(1,1),Zc),[E.Has]:O(F(1,1/0),co),[E.Id]:O(jc,Ge),[E.Concat]:O(F(2,1/0),Y(pt)),[E.GeometryType]:O(Uc,Ge),[E.LineMetric]:O(Ge),[E.Resolution]:O(hn,Ge),[E.Zoom]:O(hn,Ge),[E.Time]:O(hn,Ge),[E.Any]:O(F(2,1/0),Y(gt)),[E.All]:O(F(2,1/0),Y(gt)),[E.Not]:O(F(1,1),Y(gt)),[E.Equal]:O(F(2,2),Y(ls)),[E.NotEqual]:O(F(2,2),Y(ls)),[E.GreaterThan]:O(F(2,2),Y(W)),[E.GreaterThanOrEqualTo]:O(F(2,2),Y(W)),[E.LessThan]:O(F(2,2),Y(W)),[E.LessThanOrEqualTo]:O(F(2,2),Y(W)),[E.Multiply]:O(F(2,1/0),uo),[E.Coalesce]:O(F(2,1/0),uo),[E.Divide]:O(F(2,2),Y(W)),[E.Add]:O(F(2,1/0),Y(W)),[E.Subtract]:O(F(2,2),Y(W)),[E.Clamp]:O(F(3,3),Y(W)),[E.Mod]:O(F(2,2),Y(W)),[E.Pow]:O(F(2,2),Y(W)),[E.Abs]:O(F(1,1),Y(W)),[E.Floor]:O(F(1,1),Y(W)),[E.Ceil]:O(F(1,1),Y(W)),[E.Round]:O(F(1,1),Y(W)),[E.Sin]:O(F(1,1),Y(W)),[E.Cos]:O(F(1,1),Y(W)),[E.Atan]:O(F(1,2),Y(W)),[E.Sqrt]:O(F(1,1),Y(W)),[E.Match]:O(F(4,1/0),go,qc),[E.Between]:O(F(3,3),Y(W)),[E.Interpolate]:O(F(6,1/0),go,$c),[E.Case]:O(F(3,1/0),Hc,Jc),[E.In]:O(F(2,2),Qc),[E.Number]:O(F(1,1/0),Y(ls)),[E.String]:O(F(1,1/0),Y(ls)),[E.Array]:O(F(1,1/0),Y(W)),[E.Color]:O(F(1,4),Y(W)),[E.Band]:O(F(1,3),Y(W)),[E.Palette]:O(F(2,2),tu),[E.ToString]:O(F(1,1),Y(gt|W|pt|bt))};function co(i,t,e){const s=i.length-1,n=new Array(s);for(let r=0;r<s;++r){const o=i[r+1];switch(typeof o){case"number":{n[r]=new st(W,o);break}case"string":{n[r]=new st(pt,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&e.properties.add(String(o))}return n}function Zc(i,t,e){const s=i[1];if(typeof s!="string")throw new Error("expected a string argument for var operation");return e.variables.add(s),[new st(pt,s)]}function jc(i,t,e){e.featureId=!0}function Uc(i,t,e){e.geometryType=!0}function hn(i,t,e){e.mapState=!0}function Ge(i,t,e){const s=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${s} operation`);return[]}function F(i,t){return function(e,s,n){const r=e[0],o=e.length-1;if(i===t){if(o!==i){const a=i===1?"":"s";throw new Error(`expected ${i} argument${a} for ${r}, got ${o}`)}}else if(o<i||o>t){const a=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function uo(i,t,e){const s=i.length-1,n=new Array(s);for(let r=0;r<s;++r){const o=ht(i[r+1],t,e);n[r]=o}return n}function Y(i){return function(t,e,s){const n=t.length-1,r=new Array(n);for(let o=0;o<n;++o){const a=ht(t[o+1],i,s);r[o]=a}return r}}function Hc(i,t,e){const s=i[0],n=i.length-1;if(n%2===0)throw new Error(`expected an odd number of arguments for ${s}, got ${n} instead`)}function go(i,t,e){const s=i[0],n=i.length-1;if(n%2===1)throw new Error(`expected an even number of arguments for operation ${s}, got ${n} instead`)}function qc(i,t,e){const s=i.length-1,n=pt|W|gt,r=ht(i[1],n,e),o=ht(i[i.length-1],t,e),a=new Array(s-2);for(let l=0;l<s-2;l+=2){try{const h=ht(i[l+2],r.type,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=ht(i[l+3],o.type,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...a,o]}function $c(i,t,e){const s=i[1];let n;switch(s[0]){case"linear":n=1;break;case"exponential":const l=s[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);n=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(s)}`)}const r=new st(W,n);let o;try{o=ht(i[2],W,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){try{const h=ht(i[l+3],W,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=ht(i[l+4],t,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,o,...a]}function Jc(i,t,e){const s=ht(i[i.length-1],t,e),n=new Array(i.length-1);for(let r=0;r<n.length-1;r+=2){try{const o=ht(i[r+1],gt,e);n[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=ht(i[r+2],s.type,e);n[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return n[n.length-1]=s,n}function Qc(i,t,e){let s=i[2];if(!Array.isArray(s))throw new Error('the second argument for the "in" operator must be an array');let n;if(typeof s[0]=="string"){if(s[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(s[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');s=s[1],n=pt}else n=W;const r=new Array(s.length);for(let o=0;o<r.length;o++)try{const a=ht(s[o],n,e);r[o]=a}catch(a){throw new Error(`failed to parse haystack item ${o} for "in" expression: ${a.message}`)}return[ht(i[1],n,e),...r]}function tu(i,t,e){let s;try{s=ht(i[1],W,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const n=i[2];if(!Array.isArray(n))throw new Error("the second argument of palette must be an array");const r=new Array(n.length);for(let o=0;o<r.length;o++){let a;try{a=ht(n[o],bt,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof st))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[s,...r]}function O(...i){return function(t,e,s){const n=t[0];let r;for(let o=0;o<i.length;o++){const a=i[o](t,e,s);if(o==i.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new Vc(e,n,...r)}}function eu(i,t,e){const s=i[0],n=Kc[s];if(!n)throw new Error(`unknown operator: ${s}`);return n(i,t,e)}function La(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return La(i.getGeometries()[0]);default:return""}}function ba(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function se(i,t,e){const s=ht(i,t,e);return Pt(s)}function Pt(i,t){if(i instanceof st){if(i.type===bt&&typeof i.value=="string"){const s=fr(i.value);return function(){return s}}return function(){return i.value}}const e=i.operator;switch(e){case E.Number:case E.String:case E.Coalesce:return iu(i);case E.Get:case E.Var:case E.Has:return su(i);case E.Id:return s=>s.featureId;case E.GeometryType:return s=>s.geometryType;case E.Concat:{const s=i.args.map(n=>Pt(n));return n=>"".concat(...s.map(r=>r(n).toString()))}case E.Resolution:return s=>s.resolution;case E.Any:case E.All:case E.Between:case E.In:case E.Not:return ru(i);case E.Equal:case E.NotEqual:case E.LessThan:case E.LessThanOrEqualTo:case E.GreaterThan:case E.GreaterThanOrEqualTo:return nu(i);case E.Multiply:case E.Divide:case E.Add:case E.Subtract:case E.Clamp:case E.Mod:case E.Pow:case E.Abs:case E.Floor:case E.Ceil:case E.Round:case E.Sin:case E.Cos:case E.Atan:case E.Sqrt:return ou(i);case E.Case:return au(i);case E.Match:return lu(i);case E.Interpolate:return hu(i);case E.ToString:return cu(i);default:throw new Error(`Unsupported operator ${e}`)}}function iu(i,t){const e=i.operator,s=i.args.length,n=new Array(s);for(let r=0;r<s;++r)n[r]=Pt(i.args[r]);switch(e){case E.Coalesce:return r=>{for(let o=0;o<s;++o){const a=n[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case E.Number:case E.String:return r=>{for(let o=0;o<s;++o){const a=n[o](r);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function su(i,t){const e=i.args[0].value;switch(i.operator){case E.Get:return s=>{const n=i.args;let r=s.properties[e];for(let o=1,a=n.length;o<a;++o){const l=n[o].value;r=r[l]}return r};case E.Var:return s=>s.variables[e];case E.Has:return s=>{const n=i.args;if(!(e in s.properties))return!1;let r=s.properties[e];for(let o=1,a=n.length;o<a;++o){const l=n[o].value;if(!r||!Object.hasOwn(r,l))return!1;r=r[l]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function nu(i,t){const e=i.operator,s=Pt(i.args[0]),n=Pt(i.args[1]);switch(e){case E.Equal:return r=>s(r)===n(r);case E.NotEqual:return r=>s(r)!==n(r);case E.LessThan:return r=>s(r)<n(r);case E.LessThanOrEqualTo:return r=>s(r)<=n(r);case E.GreaterThan:return r=>s(r)>n(r);case E.GreaterThanOrEqualTo:return r=>s(r)>=n(r);default:throw new Error(`Unsupported comparison operator ${e}`)}}function ru(i,t){const e=i.operator,s=i.args.length,n=new Array(s);for(let r=0;r<s;++r)n[r]=Pt(i.args[r]);switch(e){case E.Any:return r=>{for(let o=0;o<s;++o)if(n[o](r))return!0;return!1};case E.All:return r=>{for(let o=0;o<s;++o)if(!n[o](r))return!1;return!0};case E.Between:return r=>{const o=n[0](r),a=n[1](r),l=n[2](r);return o>=a&&o<=l};case E.In:return r=>{const o=n[0](r);for(let a=1;a<s;++a)if(o===n[a](r))return!0;return!1};case E.Not:return r=>!n[0](r);default:throw new Error(`Unsupported logical operator ${e}`)}}function ou(i,t){const e=i.operator,s=i.args.length,n=new Array(s);for(let r=0;r<s;++r)n[r]=Pt(i.args[r]);switch(e){case E.Multiply:return r=>{let o=1;for(let a=0;a<s;++a)o*=n[a](r);return o};case E.Divide:return r=>n[0](r)/n[1](r);case E.Add:return r=>{let o=0;for(let a=0;a<s;++a)o+=n[a](r);return o};case E.Subtract:return r=>n[0](r)-n[1](r);case E.Clamp:return r=>{const o=n[0](r),a=n[1](r);if(o<a)return a;const l=n[2](r);return o>l?l:o};case E.Mod:return r=>n[0](r)%n[1](r);case E.Pow:return r=>Math.pow(n[0](r),n[1](r));case E.Abs:return r=>Math.abs(n[0](r));case E.Floor:return r=>Math.floor(n[0](r));case E.Ceil:return r=>Math.ceil(n[0](r));case E.Round:return r=>Math.round(n[0](r));case E.Sin:return r=>Math.sin(n[0](r));case E.Cos:return r=>Math.cos(n[0](r));case E.Atan:return s===2?r=>Math.atan2(n[0](r),n[1](r)):r=>Math.atan(n[0](r));case E.Sqrt:return r=>Math.sqrt(n[0](r));default:throw new Error(`Unsupported numeric operator ${e}`)}}function au(i,t){const e=i.args.length,s=new Array(e);for(let n=0;n<e;++n)s[n]=Pt(i.args[n]);return n=>{for(let r=0;r<e-1;r+=2)if(s[r](n))return s[r+1](n);return s[e-1](n)}}function lu(i,t){const e=i.args.length,s=new Array(e);for(let n=0;n<e;++n)s[n]=Pt(i.args[n]);return n=>{const r=s[0](n);for(let o=1;o<e-1;o+=2)if(r===s[o](n))return s[o+1](n);return s[e-1](n)}}function hu(i,t){const e=i.args.length,s=new Array(e);for(let n=0;n<e;++n)s[n]=Pt(i.args[n]);return n=>{const r=s[0](n),o=s[1](n);let a,l;for(let h=2;h<e;h+=2){const c=s[h](n);let u=s[h+1](n);const d=Array.isArray(u);if(d&&(u=Bc(u)),c>=o)return h===2?u:d?uu(r,o,a,l,c,u):Si(r,o,a,l,c,u);a=c,l=u}return l}}function cu(i,t){const e=i.operator,s=i.args.length,n=new Array(s);for(let r=0;r<s;++r)n[r]=Pt(i.args[r]);switch(e){case E.ToString:return r=>{const o=n[0](r);return i.args[0].type===bt?_r(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Si(i,t,e,s,n,r){const o=n-e;if(o===0)return s;const a=t-e,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return s+l*(r-s)}function uu(i,t,e,s,n,r){if(n-e===0)return s;const o=lo(s),a=lo(r);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[Si(i,t,e,o[0],n,a[0]),Si(i,t,e,o[1],n,a[1]),o[2]+Si(i,t,e,0,n,l),Si(i,t,e,s[3],n,r[3])];return zc(h)}const A={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class mr extends Rs{constructor(t,e,s,n){super(),this.extent=t,this.pixelRatio_=s,this.resolution=e,this.state=typeof n=="function"?A.IDLE:n,this.image_=null,this.loader=typeof n=="function"?n:null}changed(){this.dispatchEvent(N.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==A.IDLE&&this.loader){this.state=A.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;Xo(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(s=>{"image"in s&&(this.image_=s.image),"extent"in s&&(this.extent=s.extent),"resolution"in s&&(this.resolution=s.resolution),"pixelRatio"in s&&(this.pixelRatio_=s.pixelRatio),(s instanceof HTMLImageElement||jo&&s instanceof ImageBitmap||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(this.image_=s),this.state=A.LOADED}).catch(s=>{this.state=A.ERROR,console.error(s)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function du(i,t){return new Promise((e,s)=>{function n(){o(),e(i)}function r(){o(),s(new Error("Image load error"))}function o(){i.removeEventListener("load",n),i.removeEventListener("error",r)}i.addEventListener("load",n),i.addEventListener("error",r)})}function Oa(i,t){return t&&(i.src=t),i.src&&Zo?new Promise((e,s)=>i.decode().then(()=>e(i)).catch(n=>i.complete&&i.width?e(i):s(n))):du(i)}function Da(i,t){return t&&(i.src=t),i.src&&Zo&&jo?i.decode().then(()=>createImageBitmap(i)).catch(e=>{if(i.complete&&i.width)return i;throw e}):Oa(i)}class gu{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const s=this.cache_[e];!(t++&3)&&!s.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,s){const n=cn(t,e,s);return n in this.cache_?this.cache_[n]:null}getPattern(t,e,s){const n=cn(t,e,s);return n in this.patternCache_?this.patternCache_[n]:null}set(t,e,s,n,r){const o=cn(t,e,s),a=o in this.cache_;this.cache_[o]=n,r&&(n.getImageState()===A.IDLE&&n.load(),n.getImageState()===A.LOADING?n.ready().then(()=>{this.patternCache_[o]=ms().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=ms().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function cn(i,t,e){const s=e?Je(e):"null";return t+":"+i+":"+s}const It=new gu;let pi=null;class Pa extends Rs{constructor(t,e,s,n,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=s,this.canvas_={},this.color_=r,this.imageState_=n===void 0?A.IDLE:n,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===A.LOADED){pi||(pi=at(1,1,void 0,{willReadFrequently:!0})),pi.drawImage(this.image_,0,0);try{pi.getImageData(0,0,1,1),this.tainted_=!1}catch{pi=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(N.CHANGE)}handleImageError_(){this.imageState_=A.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=A.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],s=at(t,e);s.fillRect(0,0,t,e),this.hitDetectionImage_=s.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===A.IDLE){this.image_||this.initializeImage_(),this.imageState_=A.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Oa(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==A.LOADED)return;const e=this.image_,s=at(Math.ceil(e.width*t),Math.ceil(e.height*t)),n=s.canvas;s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=Gc(this.color_),s.fillRect(0,0,n.width/t,n.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===A.LOADED||this.imageState_===A.ERROR)t();else{const e=()=>{(this.imageState_===A.LOADED||this.imageState_===A.ERROR)&&(this.removeEventListener(N.CHANGE,e),t())};this.addEventListener(N.CHANGE,e)}})),this.ready_}}function yr(i,t,e,s,n,r){let o=t===void 0?void 0:It.get(t,e,n);return o||(o=new Pa(i,i&&"src"in i?i.src||void 0:t,e,s,n),It.set(t,e,n,o,r)),r&&o&&!It.getPattern(t,e,n)&&It.set(t,e,n,o,r),o}function Bt(i){return i?Array.isArray(i)?_r(i):typeof i=="object"&&"src"in i?fu(i):i:null}function fu(i){if(!i.offset||!i.size)return It.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=It.getPattern(t,void 0,i.color);if(e)return e;const s=It.get(i.src,"anonymous",null);if(s.getImageState()!==A.LOADED)return null;const n=at(i.size[0],i.size[1]);return n.drawImage(s.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),yr(n.canvas,t,void 0,A.LOADED,i.color,!0),It.getPattern(t,void 0,i.color)}const ka="10px sans-serif",mt="#000",ti="round",Jt=[],Qt=0,ei="round",Pi=10,ki="#000",Fi="center",ys="middle",Me=[0,0,0,0],Ni=1,qt=new zt;let Xe=null,Tn;const An={},_u=function(){const i="32px ",t=["monospace","serif"],e=t.length,s="wmytzilWMYTZIL@#/&?$%10";let n,r;function o(l,h,c){let u=!0;for(let d=0;d<e;++d){const g=t[d];if(r=xs(l+" "+h+" "+i+g,s),c!=g){const f=xs(l+" "+h+" "+i+c+","+g,s);u=u&&f!=r}}return!!u}function a(){let l=!0;const h=qt.getKeys();for(let c=0,u=h.length;c<u;++c){const d=h[c];if(qt.get(d)<100){const[g,f,p]=d.split(`
`);o(g,f,p)?(zi(An),Xe=null,Tn=void 0,qt.set(d,100)):(qt.set(d,qt.get(d)+1,!0),l=!1)}}l&&(clearInterval(n),n=void 0)}return function(l){const h=ma(l);if(!h)return;const c=h.families;for(let u=0,d=c.length;u<d;++u){const g=c[u],f=h.style+`
`+h.weight+`
`+g;qt.get(f)===void 0&&(qt.set(f,100,!0),o(h.style,h.weight,g)||(qt.set(f,0,!0),n===void 0&&(n=setInterval(a,32))))}}}(),pu=function(){let i;return function(t){let e=An[t];if(e==null){if(Ko){const s=ma(t),n=Fa(t,"Žg");e=(isNaN(Number(s.lineHeight))?1.2:Number(s.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);An[t]=e}return e}}();function Fa(i,t){return Xe||(Xe=at(1,1)),i!=Tn&&(Xe.font=i,Tn=Xe.font),Xe.measureText(t)}function xs(i,t){return Fa(i,t).width}function fo(i,t,e){if(t in e)return e[t];const s=t.split(`
`).reduce((n,r)=>Math.max(n,xs(i,r)),0);return e[t]=s,s}function mu(i,t){const e=[],s=[],n=[];let r=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){r=Math.max(r,o),n.push(o),o=0,a+=l,l=0;continue}const d=t[h+1]||i.font,g=xs(d,u);e.push(g),o+=g;const f=pu(d);s.push(f),l=Math.max(l,f)}return{width:r,height:a,widths:e,heights:s,lineWidths:n}}function yu(i,t,e,s,n,r,o,a,l,h,c){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),s.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),xu(s,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(s,n,r,o,a,0,0,o,a)):i.drawImage(s,n,r,o,a,l,h,o*c[0],a*c[1]),i.restore()}function xu(i,t){const e=i.contextInstructions;for(let s=0,n=e.length;s<n;s+=2)Array.isArray(e[s+1])?t[e[s]].apply(t,e[s+1]):t[e[s]]=e[s+1]}class Ds{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Qe(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ds({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return K()}getImage(t){return K()}getHitDetectionImage(){return K()}getPixelRatio(t){return 1}getImageState(){return K()}getImageSize(){return K()}getOrigin(){return K()}getSize(){return K()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Qe(t)}listenImageChange(t){K()}load(){K()}unlistenImageChange(t){K()}ready(){return Promise.resolve()}}class Ps extends Ds{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?A.LOADING:A.LOADED,this.imageState_===A.LOADING&&this.ready().then(()=>this.imageState_=A.LOADED),this.render()}clone(){const t=this.getScale(),e=new Ps({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),s=this.getScaleArray();return[t[0]/2-e[0]/s[0],t[1]/2+e[1]/s[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var e,s;const n=(e=this.fill_)==null?void 0:e.getKey(),r=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${n}`+Object.values(this.renderOptions_).join(",");let o=(s=It.get(r,null,null))==null?void 0:s.getImage(1);if(!o){const a=this.renderOptions_,l=Math.ceil(a.size*t),h=at(l,l);this.draw_(a,h,t),o=h.canvas,It.set(r,null,null,new Pa(o,void 0,null,A.LOADED,null))}return o}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,s){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius,r=this.radius2_===void 0?n:this.radius2_;if(n<r){const x=n;n=r,r=x}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=n-h,u=Math.sqrt(l*l+c*c),d=u/l;if(t==="miter"&&d<=s)return d*e;const g=e/2/d,f=e/2*(c/u),p=Math.sqrt((n+g)*(n+g)+f*f)-n;if(this.radius2_===void 0||t==="bevel")return p*2;const _=n*Math.sin(a),m=Math.sqrt(n*n-_*_),y=r-m,S=Math.sqrt(_*_+y*y)/_;if(S<=s){const x=S*e/2-r-n;return 2*Math.max(p,x)}return p*2}createRenderOptions(){let t=ti,e=ei,s=0,n=null,r=0,o,a=0;this.stroke_&&(o=Bt(this.stroke_.getColor()??ki),a=this.stroke_.getWidth()??Ni,n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??ei,t=this.stroke_.getLineCap()??ti,s=this.stroke_.getMiterLimit()??Pi);const l=this.calculateLineJoinSize_(e,a,s),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:n,lineDashOffset:r,lineJoin:e,miterLimit:s}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,s){if(e.scale(s,s),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=mt),e.fillStyle=Bt(n),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let s=this.fill_.getColor(),n=0;typeof s=="string"&&(s=Je(s)),s===null?n=1:Array.isArray(s)&&(n=s.length===4?s[3]:1),n===0&&(e=at(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const s=this.radius;if(e===1/0)t.arc(0,0,s,0,2*Math.PI);else{const n=this.radius2_===void 0?s:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=r+a*o,h=a%2===0?s:n;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=mt,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class ji extends Ps{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new ji({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}let ks=class Na{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Na({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=yr(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===A.IDLE&&e.load(),e.getImageState()===A.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?et(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:Je(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}};function _o(i,t,e,s){return e!==void 0&&s!==void 0?[e/i,s/t]:e!==void 0?e/i:s!==void 0?s/t:1}class Ui extends Ds{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,s=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:s,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;Q(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||et(o)),Q(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Q(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=A.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?A.LOADED:A.IDLE:l=A.LOADING:l=A.LOADED),this.color_=t.color!==void 0?Je(t.color):null,this.iconImage_=yr(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(_o(g[0],g[1],t.width,t.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(_o(h,c,t.width,t.height))}}clone(){let t,e,s;return this.initialOptions_?(e=this.initialOptions_.width,s=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Ui({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:s,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),s=this.getScaleArray();return[t[0]-e[0]/s[0],t[1]+e[1]/s[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),s=this.iconImage_.getSize();if(!e||!s)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=s[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=s[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==A.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==A.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(N.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(N.CHANGE,t)}ready(){return this.iconImage_.ready()}}let xr=class Ga{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Ga({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}};class pe{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=po,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new pe({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=po,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function vu(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(Q(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let un=null;function Wa(i,t){if(!un){const e=new ks({color:"rgba(255,255,255,0.4)"}),s=new xr({color:"#3399CC",width:1.25});un=[new pe({image:new ji({fill:e,stroke:s,radius:5}),fill:e,stroke:s})]}return un}function po(i){return i.getGeometry()}const Eu="#333";class vr{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Qe(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ks({color:Eu}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new vr({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Qe(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function Su(i){return!0}function Cu(i){const t=Aa(),e=wu(i,t),s=ba();return function(n,r){if(s.properties=n.getPropertiesInternal(),s.resolution=r,t.featureId){const o=n.getId();o!==void 0?s.featureId=o:s.featureId=null}return t.geometryType&&(s.geometryType=La(n.getGeometry())),e(s)}}function mo(i){const t=Aa(),e=i.length,s=new Array(e);for(let o=0;o<e;++o)s[o]=Ln(i[o],t);const n=ba(),r=new Array(e);return function(o,a){if(n.properties=o.getPropertiesInternal(),n.resolution=a,t.featureId){const h=o.getId();h!==void 0?n.featureId=h:n.featureId=null}let l=0;for(let h=0;h<e;++h){const c=s[h](n);c&&(r[l]=c,l+=1)}return r.length=l,r}}function wu(i,t){const e=i.length,s=new Array(e);for(let n=0;n<e;++n){const r=i[n],o="filter"in r?se(r.filter,gt,t):Su;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Ln(r.style[h],t)}else a=[Ln(r.style,t)];s[n]={filter:o,styles:a}}return function(n){const r=[];let o=!1;for(let a=0;a<e;++a){const l=s[a].filter;if(l(n)&&!(i[a].else&&o)){o=!0;for(const h of s[a].styles){const c=h(n);c&&r.push(c)}}}return r}}function Ln(i,t){const e=Gi(i,"",t),s=Wi(i,"",t),n=Ru(i,t),r=Iu(i,t),o=yt(i,"z-index",t);if(!e&&!s&&!n&&!r&&!qe(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new pe;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(s){const c=s(l);c&&(h=!1),a.setStroke(c)}if(n){const c=n(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Gi(i,t,e){let s;if(t+"fill-pattern-src"in i)s=Lu(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return r=>null;s=Er(i,t+"fill-color",e)}if(!s)return null;const n=new ks;return function(r){const o=s(r);return o===gr?null:(n.setColor(o),n)}}function Wi(i,t,e){const s=yt(i,t+"stroke-width",e),n=Er(i,t+"stroke-color",e);if(!s&&!n)return null;const r=$t(i,t+"stroke-line-cap",e),o=$t(i,t+"stroke-line-join",e),a=Ba(i,t+"stroke-line-dash",e),l=yt(i,t+"stroke-line-dash-offset",e),h=yt(i,t+"stroke-miter-limit",e),c=new xr;return function(u){if(n){const d=n(u);if(d===gr)return null;c.setColor(d)}if(s&&c.setWidth(s(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function Ru(i,t){const e="text-",s=$t(i,e+"value",t);if(!s)return null;const n=Gi(i,e,t),r=Gi(i,e+"background-",t),o=Wi(i,e,t),a=Wi(i,e+"background-",t),l=$t(i,e+"font",t),h=yt(i,e+"max-angle",t),c=yt(i,e+"offset-x",t),u=yt(i,e+"offset-y",t),d=Ue(i,e+"overflow",t),g=$t(i,e+"placement",t),f=yt(i,e+"repeat",t),p=Fs(i,e+"scale",t),_=Ue(i,e+"rotate-with-view",t),m=yt(i,e+"rotation",t),y=$t(i,e+"align",t),S=$t(i,e+"justify",t),x=$t(i,e+"baseline",t),v=Ue(i,e+"keep-upright",t),w=Ba(i,e+"padding",t),M=Ns(i,e+"declutter-mode"),R=new vr({declutterMode:M});return function(C){if(R.setText(s(C)),n&&R.setFill(n(C)),r&&R.setBackgroundFill(r(C)),o&&R.setStroke(o(C)),a&&R.setBackgroundStroke(a(C)),l&&R.setFont(l(C)),h&&R.setMaxAngle(h(C)),c&&R.setOffsetX(c(C)),u&&R.setOffsetY(u(C)),d&&R.setOverflow(d(C)),g){const T=g(C);if(T!=="point"&&T!=="line")throw new Error("Expected point or line for text-placement");R.setPlacement(T)}if(f&&R.setRepeat(f(C)),p&&R.setScale(p(C)),_&&R.setRotateWithView(_(C)),m&&R.setRotation(m(C)),y){const T=y(C);if(T!=="left"&&T!=="center"&&T!=="right"&&T!=="end"&&T!=="start")throw new Error("Expected left, right, center, start, or end for text-align");R.setTextAlign(T)}if(S){const T=S(C);if(T!=="left"&&T!=="right"&&T!=="center")throw new Error("Expected left, right, or center for text-justify");R.setJustify(T)}if(x){const T=x(C);if(T!=="bottom"&&T!=="top"&&T!=="middle"&&T!=="alphabetic"&&T!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");R.setTextBaseline(T)}return w&&R.setPadding(w(C)),v&&R.setKeepUpright(v(C)),R}}function Iu(i,t){return"icon-src"in i?Mu(i,t):"shape-points"in i?Tu(i,t):"circle-radius"in i?Au(i,t):null}function Mu(i,t){const e="icon-",s=e+"src",n=za(i[s],s),r=vs(i,e+"anchor",t),o=Fs(i,e+"scale",t),a=yt(i,e+"opacity",t),l=vs(i,e+"displacement",t),h=yt(i,e+"rotation",t),c=Ue(i,e+"rotate-with-view",t),u=xo(i,e+"anchor-origin"),d=vo(i,e+"anchor-x-units"),g=vo(i,e+"anchor-y-units"),f=Pu(i,e+"color"),p=Ou(i,e+"cross-origin"),_=Du(i,e+"offset"),m=xo(i,e+"offset-origin"),y=Es(i,e+"width"),S=Es(i,e+"height"),x=bu(i,e+"size"),v=Ns(i,e+"declutter-mode"),w=new Ui({src:n,anchorOrigin:u,anchorXUnits:d,anchorYUnits:g,color:f,crossOrigin:p,offset:_,offsetOrigin:m,height:S,width:y,size:x,declutterMode:v});return function(M){return a&&w.setOpacity(a(M)),l&&w.setDisplacement(l(M)),h&&w.setRotation(h(M)),c&&w.setRotateWithView(c(M)),o&&w.setScale(o(M)),r&&w.setAnchor(r(M)),w}}function Tu(i,t){const e="shape-",s=e+"points",n=e+"radius",r=bn(i[s],s),o=bn(i[n],n),a=Gi(i,e,t),l=Wi(i,e,t),h=Fs(i,e+"scale",t),c=vs(i,e+"displacement",t),u=yt(i,e+"rotation",t),d=Ue(i,e+"rotate-with-view",t),g=Es(i,e+"radius2"),f=Es(i,e+"angle"),p=Ns(i,e+"declutter-mode"),_=new Ps({points:r,radius:o,radius2:g,angle:f,declutterMode:p});return function(m){return a&&_.setFill(a(m)),l&&_.setStroke(l(m)),c&&_.setDisplacement(c(m)),u&&_.setRotation(u(m)),d&&_.setRotateWithView(d(m)),h&&_.setScale(h(m)),_}}function Au(i,t){const e="circle-",s=Gi(i,e,t),n=Wi(i,e,t),r=yt(i,e+"radius",t),o=Fs(i,e+"scale",t),a=vs(i,e+"displacement",t),l=yt(i,e+"rotation",t),h=Ue(i,e+"rotate-with-view",t),c=Ns(i,e+"declutter-mode"),u=new ji({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),s&&u.setFill(s(d)),n&&u.setStroke(n(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function yt(i,t,e){if(!(t in i))return;const s=se(i[t],W,e);return function(n){return bn(s(n),t)}}function $t(i,t,e){if(!(t in i))return null;const s=se(i[t],pt,e);return function(n){return za(s(n),t)}}function Lu(i,t,e){const s=$t(i,t+"pattern-src",e),n=yo(i,t+"pattern-offset",e),r=yo(i,t+"pattern-size",e),o=Er(i,t+"color",e);return function(a){return{src:s(a),offset:n&&n(a),size:r&&r(a),color:o&&o(a)}}}function Ue(i,t,e){if(!(t in i))return null;const s=se(i[t],gt,e);return function(n){const r=s(n);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function Er(i,t,e){if(!(t in i))return null;const s=se(i[t],bt,e);return function(n){return Xa(s(n),t)}}function Ba(i,t,e){if(!(t in i))return null;const s=se(i[t],De,e);return function(n){return Hi(s(n),t)}}function vs(i,t,e){if(!(t in i))return null;const s=se(i[t],De,e);return function(n){const r=Hi(s(n),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function yo(i,t,e){if(!(t in i))return null;const s=se(i[t],De,e);return function(n){return Ya(s(n),t)}}function Fs(i,t,e){if(!(t in i))return null;const s=se(i[t],De|W,e);return function(n){return ku(s(n),t)}}function Es(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function bu(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return Qe(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Ou(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function xo(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function vo(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Du(i,t){const e=i[t];if(e!==void 0)return Hi(e,t)}function Ns(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Pu(i,t){const e=i[t];if(e!==void 0)return Xa(e,t)}function Hi(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let s=0;s<e;++s)if(typeof i[s]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function za(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function bn(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function Xa(i,t){if(typeof i=="string")return i;const e=Hi(i,t),s=e.length;if(s<3||s>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function Ya(i,t){const e=Hi(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function ku(i,t){return typeof i=="number"?i:Ya(i,t)}const Eo={RENDER_ORDER:"renderOrder"};class Va extends Os{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Eo.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const s=this.getDeclutter();s in t.declutter||(t.declutter[s]=new Ma(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(Eo.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Wa:t;const e=Fu(t);this.styleFunction_=t===null?void 0:vu(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function Fu(i){if(i===void 0)return Wa;if(!i)return null;if(typeof i=="function"||i instanceof pe)return i;if(!Array.isArray(i))return mo([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof pe){const s=new Array(t);for(let n=0;n<t;++n){const r=i[n];if(!(r instanceof pe))throw new Error("Expected a list of style instances");s[n]=r}return s}if("style"in e){const s=new Array(t);for(let n=0;n<t;++n){const r=i[n];if(!("style"in r))throw new Error("Expected a list of rules with a style property");s[n]=r}return Cu(s)}return mo(i)}class Ka extends ie{constructor(t,e,s,n){super(t),this.inversePixelTransform=e,this.frameState=s,this.context=n}}class Nu extends kn{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){K()}calculateMatrices2D(t){const e=t.viewState,s=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;ee(s,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ua(n,s)}forEachFeatureAtCoordinate(t,e,s,n,r,o,a,l){let h;const c=e.viewState;function u(x,v,w,M){return r.call(o,v,x?w:null,M)}const d=c.projection,g=ea(t.slice(),d),f=[[0,0]];if(d.canWrapX()&&n){const x=d.getExtent(),v=Z(x);f.push([-v,0],[v,0])}const p=e.layerStatesArray,_=p.length,m=[],y=[];for(let x=0;x<f.length;x++)for(let v=_-1;v>=0;--v){const w=p[v],M=w.layer;if(M.hasRenderer()&&dr(w,c)&&a.call(l,M)){const R=M.getRenderer(),C=M.getSource();if(R&&C){const T=C.getWrapX()?g:t,k=u.bind(null,w.managed);y[0]=T[0]+f[x][0],y[1]=T[1]+f[x][1],h=R.forEachFeatureAtCoordinate(y,e,s,k,m)}if(h)return h}}if(m.length===0)return;const S=1/m.length;return m.forEach((x,v)=>x.distanceSq+=v*S),m.sort((x,v)=>x.distanceSq-v.distanceSq),m.some(x=>h=x.callback(x.feature,x.layer,x.geometry)),h}hasFeatureAtCoordinate(t,e,s,n,r,o){return this.forEachFeatureAtCoordinate(t,e,s,n,Mi,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(t){K()}scheduleExpireIconCache(t){It.canExpireCache()&&t.postRenderFunctions.push(Gu)}}function Gu(i,t){It.expire()}class Wu extends Nu{constructor(t){super(t),this.fontChangeListenerKey_=X(qt,He.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=bs+" ol-layers";const s=t.getViewport();s.insertBefore(this.element_,s.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const s=this.getMap();if(s.hasListener(t)){const n=new Ka(t,void 0,e);s.dispatchEvent(n)}}disposeInternal(){tt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Rt.PRECOMPOSE,t);const e=t.layerStatesArray.sort((o,a)=>o.zIndex-a.zIndex);e.some(o=>o.layer instanceof Va&&o.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const n=[];let r=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!dr(l,s)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(t,r);u&&(u!==r&&(this.children_.push(u),r=u),n.push(l))}this.declutter(t,n),rc(this.element_,this.children_),this.dispatchRenderEvent(Rt.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let s=e.length-1;s>=0;--s){const n=e[s],r=n.layer;r.getDeclutter()&&r.renderDeclutter(t,n)}e.forEach(s=>s.layer.renderDeferred(t))}}}function Za(i){if(i instanceof Os){i.setMapInternal(null);return}i instanceof ni&&i.getLayers().forEach(Za)}function ja(i,t){if(i instanceof Os){i.setMapInternal(t);return}if(i instanceof ni){const e=i.getLayers().getArray();for(let s=0,n=e.length;s<n;++s)ja(e[s],t)}}let Bu=class extends zt{constructor(i){super(),i=i||{},this.on,this.once,this.un;const t=zu(i);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=i.maxTilesLoading!==void 0?i.maxTilesLoading:16,this.pixelRatio_=i.pixelRatio!==void 0?i.pixelRatio:Ml,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ot(),this.pixelToCoordinateTransform_=Ot(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=i.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||hc(),this.interactions=t.interactions||wa({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Ll(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ct.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ct.VIEW,this.handleViewChanged_),this.addChangeListener(ct.SIZE,this.handleSizeChanged_),this.addChangeListener(ct.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const e=this;i.view&&!(i.view instanceof Nt)&&i.view.then(function(s){e.setView(new Nt(s))}),this.controls.addEventListener(_t.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(_t.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(_t.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(_t.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(_t.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(_t.REMOVE,s=>{const n=s.element.getId();n!==void 0&&delete this.overlayIdIndex_[n.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(i){this.getControls().push(i)}addInteraction(i){this.getInteractions().push(i)}addLayer(i){this.getLayerGroup().getLayers().push(i)}handleLayerAdd_(i){ja(i.layer,this)}addOverlay(i){this.getOverlays().push(i)}addOverlayInternal_(i){const t=i.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=i),i.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(i,t,e){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(i);e=e!==void 0?e:{};const n=e.hitTolerance!==void 0?e.hitTolerance:0,r=e.layerFilter!==void 0?e.layerFilter:Mi,o=e.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,n,o,t,null,r,null)}getFeaturesAtPixel(i,t){const e=[];return this.forEachFeatureAtPixel(i,function(s){e.push(s)},t),e}getAllLayers(){const i=[];function t(e){e.forEach(function(s){s instanceof ni?t(s.getLayers()):i.push(s)})}return t(this.getLayers()),i}hasFeatureAtPixel(i,t){if(!this.frameState_||!this.renderer_)return!1;const e=this.getCoordinateFromPixelInternal(i);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:Mi,n=t.hitTolerance!==void 0?t.hitTolerance:0,r=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(e,this.frameState_,n,r,s,null)}getEventCoordinate(i){return this.getCoordinateFromPixel(this.getEventPixel(i))}getEventCoordinateInternal(i){return this.getCoordinateFromPixelInternal(this.getEventPixel(i))}getEventPixel(i){const t=this.viewport_.getBoundingClientRect(),e=this.getSize(),s=t.width/e[0],n=t.height/e[1],r="changedTouches"in i?i.changedTouches[0]:i;return[(r.clientX-t.left)/s,(r.clientY-t.top)/n]}getTarget(){return this.get(ct.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(i){return In(this.getCoordinateFromPixelInternal(i),this.getView().getProjection())}getCoordinateFromPixelInternal(i){const t=this.frameState_;return t?lt(t.pixelToCoordinateTransform,i.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(i){const t=this.overlayIdIndex_[i.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ct.LAYERGROUP)}setLayers(i){const t=this.getLayerGroup();if(i instanceof Wt){t.setLayers(i);return}const e=t.getLayers();e.clear(),e.extend(i)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){const s=i[t];if(!s.visible)continue;const n=s.layer.getRenderer();if(n&&!n.ready)return!0;const r=s.layer.getSource();if(r&&r.loading)return!0}return!1}getPixelFromCoordinate(i){const t=Ht(i,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(i){const t=this.frameState_;return t?lt(t.coordinateToPixelTransform,i.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ct.SIZE)}getView(){return this.get(ct.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const i=this.getTargetElement();return i?i.ownerDocument:document}getTilePriority(i,t,e,s){return bl(this.frameState_,i,t,e,s)}handleBrowserEvent(i,t){t=t||i.type;const e=new he(t,this,i);this.handleMapBrowserEvent(e)}handleMapBrowserEvent(i){if(!this.frameState_)return;const t=i.originalEvent,e=t.type;if(e===xn.POINTERDOWN||e===N.WHEEL||e===N.KEYDOWN){const s=this.getOwnerDocument(),n=this.viewport_.getRootNode?this.viewport_.getRootNode():s,r=t.target,o=n instanceof ShadowRoot?n.host===r?n.host.ownerDocument:n:n===s?s.documentElement:n;if(this.overlayContainerStopEvent_.contains(r)||!o.contains(r))return}if(i.frameState=this.frameState_,this.dispatchEvent(i)!==!1){const s=this.getInteractions().getArray().slice();for(let n=s.length-1;n>=0;n--){const r=s[n];if(!(r.getMap()!==this||!r.getActive()||!this.getTargetElement())&&(!r.handleEvent(i)||i.propagationStopped))break}}}handlePostRender(){const i=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,n=s;if(i){const r=i.viewHints;if(r[rt.ANIMATING]||r[rt.INTERACTING]){const o=Date.now()-i.time>8;s=o?0:8,n=o?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,n))}i&&this.renderer_&&!i.animate&&(this.renderComplete_?(this.hasListener(Rt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Rt.RENDERCOMPLETE,i),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Be(ce.LOADEND,this,i)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Be(ce.LOADSTART,this,i))));const e=this.postRenderFunctions_;if(i)for(let s=0,n=e.length;s<n;++s)e[s](this,i);e.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,s=this.targetChangeHandlerKeys_.length;e<s;++e)tt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(N.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(N.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const i=this.getTarget(),t=typeof i=="string"?document.getElementById(i):i;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Wu(this)),this.mapBrowserEventHandler_=new Tl(this,this.moveTolerance_);for(const n in J)this.mapBrowserEventHandler_.addEventListener(J[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(N.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(N.WHEEL,this.boundHandleBrowserEvent_,Uo?{passive:!1}:!1);let e;if(this.keyboardEventTarget_)e=this.keyboardEventTarget_;else{const n=t.getRootNode();e=n instanceof ShadowRoot?n.host:t}this.targetChangeHandlerKeys_=[X(e,N.KEYDOWN,this.handleBrowserEvent,this),X(e,N.KEYPRESS,this.handleBrowserEvent,this)];const s=t.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(tt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(tt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const i=this.getView();i&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=X(i,He.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=X(i,N.CHANGE,this.handleViewPropertyChanged_,this),i.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(tt),this.layerGroupPropertyListenerKeys_=null);const i=this.getLayerGroup();i&&(this.handleLayerAdd_(new ue("addlayer",i)),this.layerGroupPropertyListenerKeys_=[X(i,He.PROPERTYCHANGE,this.render,this),X(i,N.CHANGE,this.render,this),X(i,"addlayer",this.handleLayerAdd_,this),X(i,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){const s=i[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(i){return this.getControls().remove(i)}removeInteraction(i){return this.getInteractions().remove(i)}removeLayer(i){return this.getLayerGroup().getLayers().remove(i)}handleLayerRemove_(i){Za(i.layer)}removeOverlay(i){return this.getOverlays().remove(i)}renderFrame_(i){const t=this.getSize(),e=this.getView(),s=this.frameState_;let n=null;if(t!==void 0&&ho(t)&&e&&e.isDef()){const r=e.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=e.getState();if(n={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:us(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:i,usedTiles:{},viewState:o,viewHints:r,wantedTiles:{},mapId:et(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;n.nextExtent=us(o.nextCenter,o.nextResolution,a,t)}}this.frameState_=n,this.renderer_.renderFrame(n),n&&(n.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,n.postRenderFunctions),s&&(!this.previousExtent_||!ii(this.previousExtent_)&&!Li(n.extent,this.previousExtent_))&&(this.dispatchEvent(new Be(ce.MOVESTART,this,s)),this.previousExtent_=Is(this.previousExtent_)),this.previousExtent_&&!n.viewHints[rt.ANIMATING]&&!n.viewHints[rt.INTERACTING]&&!Li(n.extent,this.previousExtent_)&&(this.dispatchEvent(new Be(ce.MOVEEND,this,n)),Ho(n.extent,this.previousExtent_))),this.dispatchEvent(new Be(ce.POSTRENDER,this,n)),this.renderComplete_=(this.hasListener(ce.LOADSTART)||this.hasListener(ce.LOADEND)||this.hasListener(Rt.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(i){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new ue("removelayer",t)),this.set(ct.LAYERGROUP,i)}setSize(i){this.set(ct.SIZE,i)}setTarget(i){this.set(ct.TARGET,i)}setView(i){if(!i||i instanceof Nt){this.set(ct.VIEW,i);return}this.set(ct.VIEW,new Nt);const t=this;i.then(function(e){t.setView(new Nt(e))})}updateSize(){const i=this.getTargetElement();let t;if(i){const s=getComputedStyle(i),n=i.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),r=i.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(n)&&!isNaN(r)&&(t=[Math.max(0,n),Math.max(0,r)],!ho(t)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&ia("No map visible because the map container's width or height are 0."))}const e=this.getSize();t&&(!e||!me(t,e))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(i){const t=this.getView();t&&t.setViewportSize(i)}};function zu(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},s=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new ni({layers:i.layers});e[ct.LAYERGROUP]=s,e[ct.TARGET]=i.target,e[ct.VIEW]=i.view instanceof Nt?i.view:new Nt;let n;i.controls!==void 0&&(Array.isArray(i.controls)?n=new Wt(i.controls.slice()):(Q(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=i.controls));let r;i.interactions!==void 0&&(Array.isArray(i.interactions)?r=new Wt(i.interactions.slice()):(Q(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new Wt(i.overlays.slice()):(Q(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new Wt,{controls:n,interactions:r,keyboardEventTarget:t,overlays:o,values:e}}function Xu(i,t,e){const s=[],n={add(r){!r||s.findIndex(o=>o.id===r.id)!==-1||s.push(r)},remove(r){if(!r)return;const o=s.findIndex(a=>a.id===r.id);o!==-1&&(r.destroy(),s.splice(o,1))},clean(){for(const r of s)n.remove(r)},getInteractiveByType(r){return s.find(o=>o.type===r)},getInteractives(){return s},getOlMap(){return i},getContainer(){return t},getEmitter(){return e}};return n}let Yu=!1;function Vu(i,t,e,s,n,r,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(e,s,n):i,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Yu,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?r(t.readFeatures(c,{extent:e,featureProjection:n}),t.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function So(i,t){return function(e,s,n,r,o){Vu(i,t,e,s,n,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function Ku(i,t){return[[-1/0,-1/0,1/0,1/0]]}class ri extends zt{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new ri(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const s=this.getStyle();return s&&t.setStyle(s),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(tt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=X(t,N.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Zu(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Zu(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Q(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}function ju(i,t,e,s){const n=[];let r=Dt();for(let o=0,a=e.length;o<a;++o){const l=e[o];r=Bn(i,t,l[0],s),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return n}function On(i,t,e,s,n,r,o){let a,l;const h=(e-t)/s;if(h===1)a=t;else if(h===2)a=t,l=n;else if(h!==0){let c=i[t],u=i[t+1],d=0;const g=[0];for(let _=t+s;_<e;_+=s){const m=i[_],y=i[_+1];d+=Math.sqrt((m-c)*(m-c)+(y-u)*(y-u)),g.push(d),c=m,u=y}const f=n*d,p=vl(g,f);p<0?(l=(f-g[-p-2])/(g[-p-1]-g[-p-2]),a=t+(-p-2)*s):a=t+p*s}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?i[a+c]:xt(i[a+c],i[a+s+c],l);return r}function Uu(i,t,e,s,n,r){if(e==t)return null;let o;if(n<i[t+s-1])return r?(o=i.slice(t,t+s),o[s-1]=n,o):null;if(i[e-1]<n)return r?(o=i.slice(e-s,e),o[s-1]=n,o):null;if(n==i[t+s-1])return i.slice(t,t+s);let a=t/s,l=e/s;for(;a<l;){const d=a+l>>1;n<i[(d+1)*s-1]?l=d:a=d+1}const h=i[a*s-1];if(n==h)return i.slice((a-1)*s,(a-1)*s+s);const c=i[(a+1)*s-1],u=(n-h)/(c-h);o=[];for(let d=0;d<s-1;++d)o.push(xt(i[(a-1)*s+d],i[a*s+d],u));return o.push(n),o}class Gs extends Yi{constructor(t,e,s){super(),s!==void 0&&e===void 0?this.setFlatCoordinates(s,t):(e=e||0,this.setCenterAndRadius(t,e,s))}clone(){const t=new Gs(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,n){const r=this.flatCoordinates,o=t-r[0],a=e-r[1],l=o*o+a*a;if(l<n){if(l===0)for(let h=0;h<this.stride;++h)s[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);s[0]=r[0]+h*o,s[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)s[c]=r[c]}return s.length=this.stride,l}return n}containsXY(t,e){const s=this.flatCoordinates,n=t-s[0],r=e-s[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,s=e[this.stride]-e[0];return be(e[0]-s,e[1]-s,e[0]+s,e[1]+s,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if(ut(t,e)){const s=this.getCenter();return t[0]<=s[0]&&t[2]>=s[0]||t[1]<=s[1]&&t[3]>=s[1]?!0:Qo(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,s=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+s;for(let r=1;r<e;++r)n[e+r]=t[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(t,e,s){this.setLayout(s,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=ga(n,0,t,this.stride);n[r++]=n[0]+e;for(let o=1,a=this.stride;o<a;++o)n[r++]=n[o];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const s=this.getCenter(),n=this.getStride();this.setCenter($n(s,0,s.length,n,t,e,s)),this.changed()}}function Ua(i,t,e,s){let n=i[t],r=i[t+1],o=0;for(let a=t+s;a<e;a+=s){const l=i[a],h=i[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-r)*(h-r)),n=l,r=h}return o}class Bi extends Yi{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Cs(this.flatCoordinates,t),this.changed()}clone(){const t=new Bi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,n){return n<Wn(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,s,n))}forEachSegment(t){return pa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Uu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Re(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return On(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Ua(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ls(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Bi(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tr(this.flatCoordinates,0,t,this.stride),this.changed()}}const Co=Ot();class Lt{constructor(t,e,s,n,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s||null,this.properties_=r,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?$o(this.flatCoordinates_):Bn(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=te(this.getExtent());this.flatInteriorPoints_=er(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=jh(this.flatCoordinates_,this.ends_),e=ju(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Xh(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=On(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const s=this.ends_;for(let n=0,r=s.length;n<r;++n){const o=s[n],a=On(t,e,o,2,.5);Cs(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Tt(t);const e=t.getExtent(),s=t.getWorldExtent();if(e&&s){const n=ot(s)/ot(e);ee(Co,s[0],s[3],n,-n,0,0,0),_e(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Co,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Lt(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=zo((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const s=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":s.length=Ls(s,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,s,0),n=[s.length];break;case"MultiLineString":n=[],s.length=Wh(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,s,0,n);break;case"Polygon":n=[],s.length=fa(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),s,0,n);break}return n&&(this.simplifiedGeometry_=new Lt(this.type_,s,n,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Lt.prototype.getFlatCoordinates=Lt.prototype.getOrientedFlatCoordinates;class wo{constructor(t){this.rbush_=new Ma(t),this.items_={}}insert(t,e){const s={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(s),this.items_[et(e)]=s}load(t,e){const s=new Array(e.length);for(let n=0,r=e.length;n<r;n++){const o=t[n],a=e[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};s[n]=l,this.items_[et(a)]=l}this.rbush_.load(s)}remove(t){const e=et(t),s=this.items_[e];return delete this.items_[e],this.rbush_.remove(s)!==null}update(t,e){const s=this.items_[et(e)],n=[s.minX,s.minY,s.maxX,s.maxY];Li(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let s;for(let n=0,r=t.length;n<r;n++)if(s=e(t[n]),s)return s;return s}isEmpty(){return qe(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return be(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class Ha extends zt{constructor(t){super(),this.projection=Tt(t.projection),this.attributions_=Ro(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(s,n){e.viewResolver=s,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ro(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Ro(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}const wt={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};let oe=class extends ie{constructor(i,t,e){super(i),this.feature=t,this.features=e}};class Hu extends Ha{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ti,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Q(this.format_,"`format` must be set when `url` is set"),this.loader_=So(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:Ku;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new wo:null,this.loadedExtentsRtree_=new wo,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let s,n;Array.isArray(t.features)?n=t.features:t.features&&(s=t.features,n=s.getArray()),!e&&s===void 0&&(s=new Wt(n)),n!==void 0&&this.addFeaturesInternal(n),s!==void 0&&this.bindFeaturesCollection_(s)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=et(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const s=t.getGeometry();if(s){const n=s.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new oe(wt.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Lt||(this.featureChangeKeys_[t]=[X(e,N.CHANGE,this.handleFeatureChange_,this),X(e,He.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let s=!0;if(e.getId()!==void 0){const n=String(e.getId());if(!(n in this.idIndex_))this.idIndex_[n]=e;else if(e instanceof Lt){const r=this.idIndex_[n];r instanceof Lt?Array.isArray(r)?r.push(e):this.idIndex_[n]=[r,e]:s=!1}else s=!1}return s&&(Q(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),s}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],s=[],n=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=et(a);this.addToIndex_(l,a)&&s.push(a)}for(let r=0,o=s.length;r<o;r++){const a=s[r],l=et(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(wt.ADDFEATURE))for(let r=0,o=s.length;r<o;r++)this.dispatchEvent(new oe(wt.ADDFEATURE,s[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(wt.ADDFEATURE,function(s){e||(e=!0,t.push(s.feature),e=!1)}),this.addEventListener(wt.REMOVEFEATURE,function(s){e||(e=!0,t.remove(s.feature),e=!1)}),t.addEventListener(_t.ADD,s=>{e||(e=!0,this.addFeature(s.element),e=!1)}),t.addEventListener(_t.REMOVE,s=>{e||(e=!0,this.removeFeature(s.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const s in this.featureChangeKeys_)this.featureChangeKeys_[s].forEach(tt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(s=>{this.removeFeatureInternal(s)});for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new oe(wt.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const s=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(s,function(n){const r=n.getGeometry();if(r instanceof Lt||r.intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(s){const n=s.getGeometry();if(n instanceof Lt||n.intersectsExtent(t)){const r=e(s);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),qe(this.nullGeometryFeatures_)||Cs(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(s){e.push(s)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=zl(t,e);return[].concat(...s.map(n=>this.featuresRtree_.getInExtent(n)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const s=t[0],n=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Mi,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Lt?0:c.closestPointXY(s,n,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=s-d,l[1]=n-d,l[2]=s+d,l[3]=n+d}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,s=et(e),n=e.getGeometry();if(!n)s in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[s]=e);else{const o=n.getExtent();s in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[s],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const r=e.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[s]=e;this.changed(),this.dispatchEvent(new oe(wt.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:et(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&qe(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,s){const n=this.loadedExtentsRtree_,r=this.strategy_(t,e,s);for(let o=0,a=r.length;o<a;++o){const l=r[o];n.forEachInExtent(l,function(h){return de(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new oe(wt.FEATURESLOADSTART)),this.loader_.call(this,l,e,s,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new oe(wt.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new oe(wt.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,s=e.forEachInExtent(t,function(n){if(Li(n.extent,t))return n});s&&e.remove(s)}removeFeatures(t){let e=!1;for(let s=0,n=t.length;s<n;++s)e=this.removeFeatureInternal(t[s])||e;e&&this.changed()}removeFeature(t){t&&this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=et(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const s=this.featureChangeKeys_[e];s==null||s.forEach(tt),delete this.featureChangeKeys_[e];const n=t.getId();if(n!==void 0){const r=n.toString(),o=this.idIndex_[r];o===t?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(t),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[e],this.hasListener(wt.REMOVEFEATURE)&&this.dispatchEvent(new oe(wt.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Q(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(So(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}class qa{drawCustom(t,e,s,n,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,s){}drawFeature(t,e,s){}drawGeometryCollection(t,e,s){}drawLineString(t,e,s){}drawMultiLineString(t,e,s){}drawMultiPoint(t,e,s){}drawMultiPolygon(t,e,s){}drawPoint(t,e,s){}drawPolygon(t,e,s){}drawText(t,e,s){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class qu extends qa{constructor(t,e,s,n,r,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=s,this.transform_=n,this.transformRotation_=n?Nn(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ot()}drawImages_(t,e,s,n){if(!this.image_)return;const r=_e(t,e,s,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,g=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const f=d+this.imageAnchorX_,p=g+this.imageAnchorY_;ee(a,f,p,1,1,h,-f,-p),o.save(),o.transform.apply(o,a),o.translate(f,p),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,s,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=_e(t,e,s,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<s;e+=n){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,s,n,r){const o=this.context_,a=_e(t,e,s,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),s}drawRings_(t,e,s,n){for(let r=0,o=s.length;r<o;++r)e=this.moveToLineTo_(t,e,s[r],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ut(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Ph(t,this.transform_,this.pixelCoordinates_),s=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(s*s+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const s=e.getGeometryFunction()(t);s&&(this.setStyle(e),this.drawGeometry(s))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let s=0,n=e.length;s<n;++s)this.drawGeometry(e[s])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),s=t.getStride();this.image_&&this.drawImages_(e,0,e.length,s),this.text_!==""&&this.drawText_(e,0,e.length,s)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),s=t.getStride();this.image_&&this.drawImages_(e,0,e.length,s),this.text_!==""&&this.drawText_(e,0,e.length,s)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ut(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,s=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(s,0,s.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ut(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const s=this.context_,n=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();s.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(n,r,o[l],a,!1);s.stroke()}if(this.text_!==""){const s=t.getFlatMidpoints();this.drawText_(s,0,s.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ut(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ut(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,s=t.getOrientedFlatCoordinates();let n=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];n=this.drawRings_(s,n,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,s=this.contextFillState_;s?s.fillStyle!=t.fillStyle&&(s.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,s=this.contextStrokeState_;s?(s.lineCap!=t.lineCap&&(s.lineCap=t.lineCap,e.lineCap=t.lineCap),me(s.lineDash,t.lineDash)||e.setLineDash(s.lineDash=t.lineDash),s.lineDashOffset!=t.lineDashOffset&&(s.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),s.lineJoin!=t.lineJoin&&(s.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),s.lineWidth!=t.lineWidth&&(s.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),s.miterLimit!=t.miterLimit&&(s.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),s.strokeStyle!=t.strokeStyle&&(s.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,s=this.contextTextState_,n=t.textAlign?t.textAlign:Fi;s?(s.font!=t.font&&(s.font=t.font,e.font=t.font),s.textAlign!=n&&(s.textAlign=n,e.textAlign=n),s.textBaseline!=t.textBaseline&&(s.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const s=t.getColor();this.fillState_={fillStyle:Bt(s||mt)}}if(!e)this.strokeState_=null;else{const s=e.getColor(),n=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||Jt;this.strokeState_={lineCap:n!==void 0?n:ti,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Qt)*this.pixelRatio_,lineJoin:a!==void 0?a:ei,lineWidth:(l!==void 0?l:Ni)*this.pixelRatio_,miterLimit:h!==void 0?h:Pi,strokeStyle:Bt(s||ki)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const s=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*s,this.imageAnchorY_=n[1]*s,this.imageHeight_=e[1]*s,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/s,o[1]*this.pixelRatio_/s],this.imageWidth_=e[0]*s}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:Bt(g||mt)}}const s=t.getStroke();if(!s)this.textStrokeState_=null;else{const g=s.getColor(),f=s.getLineCap(),p=s.getLineDash(),_=s.getLineDashOffset(),m=s.getLineJoin(),y=s.getWidth(),S=s.getMiterLimit();this.textStrokeState_={lineCap:f!==void 0?f:ti,lineDash:p||Jt,lineDashOffset:_||Qt,lineJoin:m!==void 0?m:ei,lineWidth:y!==void 0?y:Ni,miterLimit:S!==void 0?S:Pi,strokeStyle:Bt(g||ki)}}const n=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:n!==void 0?n:ka,textAlign:u!==void 0?u:Fi,textBaseline:d!==void 0?d:ys},this.text_=c!==void 0?Array.isArray(c)?c.reduce((g,f,p)=>g+=p%2?" ":f,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const $u=.5,$a={Point:rd,LineString:id,Polygon:ad,MultiPoint:od,MultiLineString:sd,MultiPolygon:nd,GeometryCollection:ed,Circle:Qu};function Ju(i,t){return parseInt(et(i),10)-parseInt(et(t),10)}function Io(i,t){const e=Ja(i,t);return e*e}function Ja(i,t){return $u*i/t}function Qu(i,t,e,s,n){const r=e.getFill(),o=e.getStroke();if(r||o){const l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(t,s,n)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,s)}}function Mo(i,t,e,s,n,r,o,a){const l=[],h=e.getImage();if(h){let d=!0;const g=h.getImageState();g==A.LOADED||g==A.ERROR?d=!1:g==A.IDLE&&h.load(),d&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),td(i,t,e,s,r,o,a),u}function td(i,t,e,s,n,r,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(s,n);if(e.getRenderer())Qa(i,l,e,t,o);else{const h=$a[l.getType()];h(i,l,e,t,o,r)}}function Qa(i,t,e,s,n){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,a=r.length;o<a;++o)Qa(i,r[o],e,s,n);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,s,e.getRenderer(),e.getHitDetectionRenderer(),n)}function ed(i,t,e,s,n,r){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=$a[o[a].getType()];h(i,o[a],e,s,n,r)}}function id(i,t,e,s,n){const r=e.getStroke();if(r){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,s,n)}const o=e.getText();if(o&&o.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,s,n)}}function sd(i,t,e,s,n){const r=e.getStroke();if(r){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,s,n)}const o=e.getText();if(o&&o.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,s,n)}}function nd(i,t,e,s,n){const r=e.getFill(),o=e.getStroke();if(o||r){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(t,s,n)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,s,n)}}function rd(i,t,e,s,n,r){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=A.LOADED)return;const c=i.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,s,n)}if(l){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,s,n)}}function od(i,t,e,s,n,r){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=A.LOADED)return;const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(t,s,n)}if(h){const u=i.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,s,n)}}function ad(i,t,e,s,n){const r=e.getFill(),o=e.getStroke();if(r||o){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(t,s,n)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,s,n)}}const L={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},hs=[L.FILL],ge=[L.STROKE],Te=[L.BEGIN_PATH],To=[L.CLOSE_PATH];class qi extends qa{constructor(t,e,s,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=s,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(s){return s*e})}appendFlatPointCoordinates(t,e){const s=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=t.length;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],Ai(s,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,s,n,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=n);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let g=!0,f,p,_;for(f=e+n;f<s;f+=n)d[0]=t[f],d[1]=t[f+1],_=Sn(h,d),_!==p?(g&&(a[l++]=c,a[l++]=u,g=!1),a[l++]=d[0],a[l++]=d[1]):_===nt.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],g=!1):g=!0,c=d[0],u=d[1],p=_;return(r&&g||f===e+n)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,s,n,r){for(let o=0,a=s.length;o<a;++o){const l=s[o],h=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,s,n,r){this.beginGeometry(t,e,r);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,d,g;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const f=t.getEndss();g=0;for(let p=0,_=f.length;p<_;++p){const m=[];g=this.drawCustomCoordinates_(h,g,f[p],a,m),d.push(m)}this.instructions.push([L.CUSTOM,l,d,t,s,Jr,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,d,t,n||s,Jr,r]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([L.CUSTOM,l,u,t,s,ps,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,u,t,n||s,ps,r]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([L.CUSTOM,l,c,t,s,Re,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,c,t,n||s,Re,r]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([L.CUSTOM,l,c,t,s,Re,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,c,t,n||s,Re,r]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([L.CUSTOM,l,c,t,s,void 0,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,c,t,n||s,void 0,r]);break}this.endGeometry(e)}beginGeometry(t,e,s){this.beginGeometryInstruction1_=[L.BEGIN_GEOMETRY,e,0,t,s],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[L.BEGIN_GEOMETRY,e,0,t,s],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const s=t.length;let n,r,o=-1;for(e=0;e<s;++e)n=t[e],r=n[0],r==L.END_GEOMETRY?o=e:r==L.BEGIN_GEOMETRY&&(n[2]=e,Sl(this.hitDetectionInstructions,o,e),o=-1)}fillStyleToState(t,e={}){if(t){const s=t.getColor();e.fillPatternScale=s&&typeof s=="object"&&"src"in s?this.pixelRatio:1,e.fillStyle=Bt(s||mt)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const s=t.getColor();e.strokeStyle=Bt(s||ki);const n=t.getLineCap();e.lineCap=n!==void 0?n:ti;const r=t.getLineDash();e.lineDash=r?r.slice():Jt;const o=t.getLineDashOffset();e.lineDashOffset=o||Qt;const a=t.getLineJoin();e.lineJoin=a!==void 0?a:ei;const l=t.getWidth();e.lineWidth=l!==void 0?l:Ni;const h=t.getMiterLimit();e.miterLimit=h!==void 0?h:Pi,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const s=this.state;this.fillStyleToState(t,s),this.strokeStyleToState(e,s)}createFill(t){const e=t.fillStyle,s=[L.SET_FILL_STYLE,e];return typeof e!="string"&&s.push(t.fillPatternScale),s}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[L.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const s=t.fillStyle;(typeof s!="string"||t.currentFillStyle!=s)&&(s!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=s)}updateStrokeStyle(t,e){const s=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=s||t.currentLineCap!=n||r!=t.currentLineDash&&!me(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(s!==void 0&&e.call(this,t),t.currentStrokeStyle=s,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[L.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ho(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Gn(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class ld extends qi{constructor(t,e,s,n){super(t,e,s,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,s){if(!this.image_||this.maxExtent&&!Ai(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,s);const n=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,r);this.instructions.push([L.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([L.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,s){if(!this.image_)return;this.beginGeometry(t,e,s);const n=t.getFlatCoordinates(),r=[];for(let l=0,h=n.length;l<h;l+=t.getStride())(!this.maxExtent||Ai(this.maxExtent,n.slice(l,l+2)))&&r.push(n[l],n[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([L.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([L.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const s=t.getAnchor(),n=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=s[0],this.anchorY_=s[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class hd extends qi{constructor(t,e,s,n){super(t,e,s,n)}drawFlatCoordinates_(t,e,s,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,s,n,!1,!1),a=[L.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),s}drawLineString(t,e,s){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,s),this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Jt,Qt],Te);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(ge),this.endGeometry(e)}drawMultiLineString(t,e,s){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,s),this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Jt,Qt],Te);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(ge),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ge),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ge),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Te)}}class Ao extends qi{constructor(t,e,s,n){super(t,e,s,n)}drawFlatCoordinatess_(t,e,s,n){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=s.length;this.instructions.push(Te),this.hitDetectionInstructions.push(Te);for(let h=0;h<l;++h){const c=s[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,n,!0,!a),g=[L.MOVE_TO_LINE_TO,u,d];this.instructions.push(g),this.hitDetectionInstructions.push(g),a&&(this.instructions.push(To),this.hitDetectionInstructions.push(To)),e=c}return o&&(this.instructions.push(hs),this.hitDetectionInstructions.push(hs)),a&&(this.instructions.push(ge),this.hitDetectionInstructions.push(ge)),e}drawCircle(t,e,s){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,s),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_FILL_STYLE,mt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Jt,Qt]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[L.CIRCLE,h];this.instructions.push(Te,c),this.hitDetectionInstructions.push(Te,c),n.fillStyle!==void 0&&(this.instructions.push(hs),this.hitDetectionInstructions.push(hs)),n.strokeStyle!==void 0&&(this.instructions.push(ge),this.hitDetectionInstructions.push(ge)),this.endGeometry(e)}drawPolygon(t,e,s){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,s),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_FILL_STYLE,mt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Jt,Qt]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,s){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,s),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_FILL_STYLE,mt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Jt,Qt]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let s=0,n=e.length;s<n;++s)e[s]=Se(e[s],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function cd(i,t,e,s,n){const r=[];let o=e,a=0,l=t.slice(e,2);for(;a<i&&o+n<s;){const[h,c]=l.slice(-2),u=t[o+n],d=t[o+n+1],g=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=g,a>=i){const f=(i-a+g)/g,p=xt(h,u,f),_=xt(c,d,f);l.push(p,_),r.push(l),l=[p,_],a==i&&(o+=n),a=0}else if(a<i)l.push(t[o+n],t[o+n+1]),o+=n;else{const f=g-a,p=xt(h,u,f/g),_=xt(c,d,f/g);l.push(p,_),r.push(l),l=[p,_],a=0,o+=n}}return a>0&&r.push(l),r}function ud(i,t,e,s,n){let r=e,o=e,a=0,l=0,h=e,c,u,d,g,f,p,_,m,y,S;for(u=e;u<s;u+=n){const x=t[u],v=t[u+1];f!==void 0&&(y=x-f,S=v-p,g=Math.sqrt(y*y+S*S),_!==void 0&&(l+=d,c=Math.acos((_*y+m*S)/(d*g)),c>i&&(l>a&&(a=l,r=h,o=u),l=0,h=u-n)),d=g,_=y,m=S),f=x,p=v}return l+=g,l>a?[h,u]:[r,o]}const Ss={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class dd extends qi{constructor(t,e,s,n){super(t,e,s,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[mt]={fillStyle:mt},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,s){const n=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!r)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!ut(this.maxExtent,t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const _=t.getEndss();d=[];for(let m=0,y=_.length;m<y;++m)d.push(_[m][0])}this.beginGeometry(t,e,s);const g=o.repeat,f=g?void 0:o.textAlign;let p=0;for(let _=0,m=d.length;_<m;++_){let y;g?y=cd(g*this.resolution,c,p,d[_],u):y=[c.slice(p,d[_])];for(let S=0,x=y.length;S<x;++S){const v=y[S];let w=0,M=v.length;if(f==null){const C=ud(o.maxAngle,v,0,v.length,2);w=C[0],M=C[1]}for(let C=w;C<M;C+=u)a.push(v[C],v[C+1]);const R=a.length;p=d[_],this.drawChars_(l,R),l=R}}this.endGeometry(e)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const x=t.getFlatInteriorPoints();c=[];for(let v=0,w=x.length;v<w;v+=3)o.overflow||d.push(x[v+2]/this.resolution),c.push(x[v],x[v+1]);if(c.length===0)return;u=2;break}const g=this.appendFlatPointCoordinates(c,u);if(g===l)return;if(d&&(g-l)/2!==c.length/u){let x=l/2;d=d.filter((v,w)=>{const M=a[(x+w)*2]===c[w*u]&&a[(x+w)*2+1]===c[w*u+1];return M||--x,M})}this.saveTextStates_();const f=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,p=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(t,e,s);let _=o.padding;if(_!=Me&&(o.scale[0]<0||o.scale[1]<0)){let x=o.padding[0],v=o.padding[1],w=o.padding[2],M=o.padding[3];o.scale[0]<0&&(v=-v,M=-M),o.scale[1]<0&&(x=-x,w=-w),_=[x,v,w,M]}const m=this.pixelRatio;this.instructions.push([L.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,_==Me?Me:_.map(function(x){return x*m}),f,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const y=1/m,S=f?f.slice(0):null;S&&(S[1]=mt),this.hitDetectionInstructions.push([L.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,_,S,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?mt:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,s=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||Fi,justify:e.justify,textBaseline:e.textBaseline||ys,scale:e.scale});const o=this.fillKey_;s&&(o in this.fillStates||(this.fillStates[o]={fillStyle:s.fillStyle}))}drawChars_(t,e){const s=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=Ss[n.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=s?s.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([L.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,l,c,r,d*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([L.DRAW_CHARS,t,e,h,n.overflow,a&&mt,n.maxAngle,l,c,r,d*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let s,n,r;if(!t)this.text_="";else{const o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Bt(o.getColor()||mt)):(n=null,this.textFillState_=n);const a=t.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const p=a.getLineDash(),_=a.getLineDashOffset(),m=a.getWidth(),y=a.getMiterLimit();r.lineCap=a.getLineCap()||ti,r.lineDash=p?p.slice():Jt,r.lineDashOffset=_===void 0?Qt:_,r.lineJoin=a.getLineJoin()||ei,r.lineWidth=m===void 0?Ni:m,r.miterLimit=y===void 0?Pi:y,r.strokeStyle=Bt(a.getColor()||ki)}s=this.textState_;const l=t.getFont()||ka;_u(l);const h=t.getScaleArray();s.overflow=t.getOverflow(),s.font=l,s.maxAngle=t.getMaxAngle(),s.placement=t.getPlacement(),s.textAlign=t.getTextAlign(),s.repeat=t.getRepeat(),s.justify=t.getJustify(),s.textBaseline=t.getTextBaseline()||ys,s.backgroundFill=t.getBackgroundFill(),s.backgroundStroke=t.getBackgroundStroke(),s.padding=t.getPadding()||Me,s.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),g=t.getKeepUpright(),f=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=g===void 0?!0:g,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:et(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=s.font+s.scale+(s.textAlign||"?")+(s.repeat||"?")+(s.justify||"?")+(s.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+et(n.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const gd={Circle:Ao,Default:qi,Image:ld,LineString:hd,Polygon:Ao,Text:dd};class fd{constructor(t,e,s,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=s,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const s=this.buildersByZIndex_[e];for(const n in s){const r=s[n].finish();t[e][n]=r}}return t}getBuilder(t,e){const s=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[s];n===void 0&&(n={},this.buildersByZIndex_[s]=n);let r=n[e];if(r===void 0){const o=gd[e];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r}return r}}function _d(i,t,e,s,n,r,o,a,l,h,c,u,d=!0){let g=i[t],f=i[t+1],p=0,_=0,m=0,y=0;function S(){p=g,_=f,t+=s,g=i[t],f=i[t+1],y+=m,m=Math.sqrt((g-p)*(g-p)+(f-_)*(f-_))}do S();while(t<e-s&&y+m<r);let x=m===0?0:(r-y)/m;const v=xt(p,g,x),w=xt(_,f,x),M=t-s,R=y,C=r+a*l(h,n,c);for(;t<e-s&&y+m<C;)S();x=m===0?0:(C-y)/m;const T=xt(p,g,x),k=xt(_,f,x);let P=!1;if(d)if(u){const D=[v,w,T,k];$n(D,0,4,2,u,D,D),P=D[0]>D[2]}else P=v>T;const z=Math.PI,b=[],B=M+s===t;t=M,m=0,y=R,g=i[t],f=i[t+1];let G;if(B){S(),G=Math.atan2(f-_,g-p),P&&(G+=G>0?-z:z);const D=(T+v)/2,V=(k+w)/2;return b[0]=[D,V,(C-r)/2,G,n],b}n=n.replace(/\n/g," ");for(let D=0,V=n.length;D<V;){S();let j=Math.atan2(f-_,g-p);if(P&&(j+=j>0?-z:z),G!==void 0){let ft=j-G;if(ft+=ft>z?-2*z:ft<-z?2*z:0,Math.abs(ft)>o)return null}G=j;const H=D;let q=0;for(;D<V;++D){const ft=P?V-D-1:D,kt=a*l(h,n[ft],c);if(t+s<e&&y+m<r+q+kt/2)break;q+=kt}if(D===H)continue;const I=P?n.substring(V-H,V-D):n.substring(H,D);x=m===0?0:(r+q/2-y)/m;const Xt=xt(p,g,x),ye=xt(_,f,x);b.push([Xt,ye,q/2,j,I]),r+=q}return b}class tl{constructor(){xl(this,"pushMethodArgs_",(...t)=>(this.push_(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(ms(),{get:(t,e)=>{if(typeof ms()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,s)=>(this.push_(e,s),!0)})}push_(...t){const e=this.instructions_,s=this.zIndex+this.offset_;e[s]||(e[s]=[]),e[s].push(...t)}pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let s=0,n=e.length;s<n;++s){const r=e[s];if(typeof r=="function"){r(t);continue}const o=e[++s];if(typeof t[r]=="function")t[r](...o);else{if(typeof o=="function"){t[r]=o(t);continue}t[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const We=Dt(),ae=[],jt=[],Ut=[],le=[];function Lo(i){return i[3].declutterBox}const bo=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function dn(i,t){return t==="start"?t=bo.test(i)?"right":"left":t==="end"&&(t=bo.test(i)?"left":"right"),Ss[t]}function pd(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}function md(i,t,e){return e%2===0&&(i+=t),i}class yd{constructor(t,e,s,n,r){this.overlaps=s,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Ot(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new tl:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,s,n){const r=t+e+s+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,a=s?this.fillStates[s]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?Ss[l.justify]:dn(Array.isArray(t)?t[0]:t,l.textAlign||Fi),d=n&&o.lineWidth?o.lineWidth:0,g=Array.isArray(t)?t:String(t).split(`
`).reduce(pd,[]),{width:f,height:p,widths:_,heights:m,lineWidths:y}=mu(l,g),S=f+d,x=[],v=(S+2)*c[0],w=(p+d)*c[1],M={width:v<0?Math.floor(v):Math.ceil(v),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:x};(c[0]!=1||c[1]!=1)&&x.push("scale",c),n&&(x.push("strokeStyle",o.strokeStyle),x.push("lineWidth",d),x.push("lineCap",o.lineCap),x.push("lineJoin",o.lineJoin),x.push("miterLimit",o.miterLimit),x.push("setLineDash",[o.lineDash]),x.push("lineDashOffset",o.lineDashOffset)),s&&x.push("fillStyle",a.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");const R=.5-u;let C=u*S+R*d;const T=[],k=[];let P=0,z=0,b=0,B=0,G;for(let D=0,V=g.length;D<V;D+=2){const j=g[D];if(j===`
`){z+=P,P=0,C=u*S+R*d,++B;continue}const H=g[D+1]||l.font;H!==G&&(n&&T.push("font",H),s&&k.push("font",H),G=H),P=Math.max(P,m[b]);const q=[j,C+R*_[b]+u*(_[b]-y[B]),.5*(d+P)+z];C+=_[b],n&&T.push("strokeText",q),s&&k.push("fillText",q),++b}return Array.prototype.push.apply(x,T),Array.prototype.push.apply(x,k),this.labels_[r]=M,M}replayTextBackground_(t,e,s,n,r,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],t.fillStyle=o[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,s,n,r,o,a,l,h,c,u,d,g,f,p,_){a*=d[0],l*=d[1];let m=s-a,y=n-l;const S=r+h>t?t-h:r,x=o+c>e?e-c:o,v=f[3]+S*d[0]+f[1],w=f[0]+x*d[1]+f[2],M=m-f[3],R=y-f[0];(p||u!==0)&&(ae[0]=M,le[0]=M,ae[1]=R,jt[1]=R,jt[0]=M+v,Ut[0]=jt[0],Ut[1]=R+w,le[1]=Ut[1]);let C;return u!==0?(C=ee(Ot(),s,n,1,1,u,-s,-n),lt(C,ae),lt(C,jt),lt(C,Ut),lt(C,le),be(Math.min(ae[0],jt[0],Ut[0],le[0]),Math.min(ae[1],jt[1],Ut[1],le[1]),Math.max(ae[0],jt[0],Ut[0],le[0]),Math.max(ae[1],jt[1],Ut[1],le[1]),We)):be(Math.min(M,M+v),Math.min(R,R+w),Math.max(M,M+v),Math.max(R,R+w),We),g&&(m=Math.round(m),y=Math.round(y)),{drawImageX:m,drawImageY:y,drawImageW:S,drawImageH:x,originX:h,originY:c,declutterBox:{minX:We[0],minY:We[1],maxX:We[2],maxY:We[3],value:_},canvasTransform:C,scale:d}}replayImageOrLabel_(t,e,s,n,r,o,a){const l=!!(o||a),h=n.declutterBox,c=a?a[2]*n.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,ae,jt,Ut,le,o,a),yu(t,n.canvasTransform,r,s,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const s=lt(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(s[0]%n,s[1]%n),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,s,n){const r=this.textStates[e],o=this.createLabel(t,e,n,s),a=this.strokeStates[s],l=this.pixelRatio,h=dn(Array.isArray(t)?t[0]:t,r.textAlign||Fi),c=Ss[r.textBaseline||ys],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],g=h*d+2*(.5-h)*u,f=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:g,anchorY:f}}execute_(t,e,s,n,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&me(s,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=_e(this.coordinates,0,this.coordinates.length,2,s,this.pixelCoordinates_),wh(this.renderedTransform_,s));let u=0;const d=n.length;let g=0,f,p,_,m,y,S,x,v,w,M,R,C,T,k=0,P=0;const z=this.coordinateCache_,b=this.viewRotation_,B=Math.round(Math.atan2(-s[1],s[0])*1e12)/1e12,G={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:b},D=this.instructions!=n||this.overlaps?0:200;let V,j,H,q;for(;u<d;){const I=n[u];switch(I[0]){case L.BEGIN_GEOMETRY:V=I[1],q=I[3],V.getGeometry()?a!==void 0&&!ut(a,q.getExtent())?u=I[2]+1:++u:u=I[2],h&&(h.zIndex=I[4]);break;case L.BEGIN_PATH:k>D&&(this.fill_(t),k=0),P>D&&(t.stroke(),P=0),!k&&!P&&(t.beginPath(),y=NaN,S=NaN),++u;break;case L.CIRCLE:g=I[1];const Xt=c[g],ye=c[g+1],ft=c[g+2],kt=c[g+3],vt=ft-Xt,ne=kt-ye,oi=Math.sqrt(vt*vt+ne*ne);t.moveTo(Xt+oi,ye),t.arc(Xt,ye,oi,0,2*Math.PI,!0),++u;break;case L.CLOSE_PATH:t.closePath(),++u;break;case L.CUSTOM:g=I[1],f=I[2];const Yt=I[3],al=I[4],Sr=I[5];G.geometry=Yt,G.feature=V,u in z||(z[u]=[]);const ai=z[u];Sr?Sr(c,g,f,2,ai):(ai[0]=c[g],ai[1]=c[g+1],ai.length=2),h&&(h.zIndex=I[6]),al(ai,G),++u;break;case L.DRAW_IMAGE:g=I[1],f=I[2],w=I[3],p=I[4],_=I[5];let Bs=I[6];const ll=I[7],hl=I[8],cl=I[9],Cr=I[10];let zs=I[11];const ul=I[12];let $i=I[13];m=I[14]||"declutter";const li=I[15];if(!w&&I.length>=20){M=I[19],R=I[20],C=I[21],T=I[22];const Et=this.drawLabelWithPointPlacement_(M,R,C,T);w=Et.label,I[3]=w;const xe=I[23];p=(Et.anchorX-xe)*this.pixelRatio,I[4]=p;const St=I[24];_=(Et.anchorY-St)*this.pixelRatio,I[5]=_,Bs=w.height,I[6]=Bs,$i=w.width,I[13]=$i}let Xs;I.length>25&&(Xs=I[25]);let Ys,Ji,Qi;I.length>17?(Ys=I[16],Ji=I[17],Qi=I[18]):(Ys=Me,Ji=null,Qi=null),Cr&&B?zs+=b:!Cr&&!B&&(zs-=b);let dl=0;for(;g<f;g+=2){if(Xs&&Xs[dl++]<$i/this.pixelRatio)continue;const Et=this.calculateImageOrLabelDimensions_(w.width,w.height,c[g],c[g+1],$i,Bs,p,_,hl,cl,zs,ul,r,Ys,!!Ji||!!Qi,V),xe=[t,e,w,Et,ll,Ji,Qi];if(l){let St,Ft,Ct;if(li){const $=f-g;if(!li[$]){li[$]={args:xe,declutterMode:m};continue}const dt=li[$];St=dt.args,Ft=dt.declutterMode,delete li[$],Ct=Lo(St)}let Vt,Kt;if(St&&(Ft!=="declutter"||!l.collides(Ct))&&(Vt=!0),(m!=="declutter"||!l.collides(Et.declutterBox))&&(Kt=!0),Ft==="declutter"&&m==="declutter"){const $=Vt&&Kt;Vt=$,Kt=$}Vt&&(Ft!=="none"&&l.insert(Ct),this.replayImageOrLabel_.apply(this,St)),Kt&&(m!=="none"&&l.insert(Et.declutterBox),this.replayImageOrLabel_.apply(this,xe))}else this.replayImageOrLabel_.apply(this,xe)}++u;break;case L.DRAW_CHARS:const wr=I[1],Rr=I[2],Vs=I[3],gl=I[4];T=I[5];const fl=I[6],Ir=I[7],Mr=I[8];C=I[9];const Ks=I[10];M=I[11],Array.isArray(M)&&(M=M.reduce(md,"")),R=I[12];const Tr=[I[13],I[13]];m=I[14]||"declutter";const _l=I[15],Zs=this.textStates[R],hi=Zs.font,ci=[Zs.scale[0]*Ir,Zs.scale[1]*Ir];let ui;hi in this.widths_?ui=this.widths_[hi]:(ui={},this.widths_[hi]=ui);const Ar=Ua(c,wr,Rr,2),Lr=Math.abs(ci[0])*fo(hi,M,ui);if(gl||Lr<=Ar){const Et=this.textStates[R].textAlign,xe=(Ar-Lr)*dn(M,Et),St=_d(c,wr,Rr,2,M,xe,fl,Math.abs(ci[0]),fo,hi,ui,B?0:this.viewRotation_,_l);t:if(St){const Ft=[];let Ct,Vt,Kt,$,dt;if(C)for(Ct=0,Vt=St.length;Ct<Vt;++Ct){dt=St[Ct],Kt=dt[4],$=this.createLabel(Kt,R,"",C),p=dt[2]+(ci[0]<0?-Ks:Ks),_=Vs*$.height+(.5-Vs)*2*Ks*ci[1]/ci[0]-Mr;const Zt=this.calculateImageOrLabelDimensions_($.width,$.height,dt[0],dt[1],$.width,$.height,p,_,0,0,dt[3],Tr,!1,Me,!1,V);if(l&&m==="declutter"&&l.collides(Zt.declutterBox))break t;Ft.push([t,e,$,Zt,1,null,null])}if(T)for(Ct=0,Vt=St.length;Ct<Vt;++Ct){dt=St[Ct],Kt=dt[4],$=this.createLabel(Kt,R,T,""),p=dt[2],_=Vs*$.height-Mr;const Zt=this.calculateImageOrLabelDimensions_($.width,$.height,dt[0],dt[1],$.width,$.height,p,_,0,0,dt[3],Tr,!1,Me,!1,V);if(l&&m==="declutter"&&l.collides(Zt.declutterBox))break t;Ft.push([t,e,$,Zt,1,null,null])}l&&m!=="none"&&l.load(Ft.map(Lo));for(let Zt=0,pl=Ft.length;Zt<pl;++Zt)this.replayImageOrLabel_.apply(this,Ft[Zt])}}++u;break;case L.END_GEOMETRY:if(o!==void 0){V=I[1];const Et=o(V,q,m);if(Et)return Et}++u;break;case L.FILL:D?k++:this.fill_(t),++u;break;case L.MOVE_TO_LINE_TO:for(g=I[1],f=I[2],j=c[g],H=c[g+1],t.moveTo(j,H),y=j+.5|0,S=H+.5|0,g+=2;g<f;g+=2)j=c[g],H=c[g+1],x=j+.5|0,v=H+.5|0,(g==f-2||x!==y||v!==S)&&(t.lineTo(j,H),y=x,S=v);++u;break;case L.SET_FILL_STYLE:this.alignAndScaleFill_=I[2],k&&(this.fill_(t),k=0,P&&(t.stroke(),P=0)),t.fillStyle=I[1],++u;break;case L.SET_STROKE_STYLE:P&&(t.stroke(),P=0),this.setStrokeStyle_(t,I),++u;break;case L.STROKE:D?P++:t.stroke(),++u;break;default:++u;break}}k&&this.fill_(t),P&&t.stroke()}execute(t,e,s,n,r,o){this.viewRotation_=n,this.execute_(t,e,s,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,s,n,r){return this.viewRotation_=s,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,r)}}const Ke=["Polygon","Circle","LineString","Image","Text","Default"],el=["Image","Text"],xd=Ke.filter(i=>!el.includes(i));class vd{constructor(t,e,s,n,r,o,a){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=s,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ot(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(t,e){const s=this.getClipCoords(e);t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(s[2],s[3]),t.lineTo(s[4],s[5]),t.lineTo(s[6],s[7]),t.clip()}createExecutors_(t,e){for(const s in t){let n=this.executorsByZIndex_[s];n===void 0&&(n={},this.executorsByZIndex_[s]=n);const r=t[s];for(const o in r){const a=r[o];n[o]=new yd(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const s=this.executorsByZIndex_[e];for(let n=0,r=t.length;n<r;++n)if(t[n]in s)return!0}return!1}forEachFeatureAtCoordinate(t,e,s,n,r,o){n=Math.round(n);const a=n*2+1,l=ee(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-s,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=at(a,a));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Dt(),wi(u,t),Gn(u,e*(this.renderBuffer_+n),u));const d=Ed(n);let g;function f(v,w,M){const R=c.getImageData(0,0,a,a).data;for(let C=0,T=d.length;C<T;C++)if(R[d[C]]>0){if(!o||M==="none"||g!=="Image"&&g!=="Text"||o.includes(v)){const k=(d[C]-3)/4,P=n-k%a,z=n-(k/a|0),b=r(v,w,P*P+z*z);if(b)return b}c.clearRect(0,0,a,a);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(Ae);let _,m,y,S,x;for(_=p.length-1;_>=0;--_){const v=p[_].toString();for(y=this.executorsByZIndex_[v],m=Ke.length-1;m>=0;--m)if(g=Ke[m],S=y[g],S!==void 0&&(x=S.executeHitDetection(c,l,s,f,u),x))return x}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const s=e[0],n=e[1],r=e[2],o=e[3],a=[s,n,s,o,r,o,r,n];return _e(a,0,8,2,t,a),a}isEmpty(){return qe(this.executorsByZIndex_)}execute(t,e,s,n,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?El:Ae),o=o||Ke;const h=Ke.length;for(let c=0,u=l.length;c<u;++c){const d=l[c].toString(),g=this.executorsByZIndex_[d];for(let f=0,p=o.length;f<p;++f){const _=o[f],m=g[_];if(m!==void 0){const y=a===null?void 0:m.getZIndexContext(),S=y?y.getContext():t,x=this.maxExtent_&&_!=="Image"&&_!=="Text";if(x&&(S.save(),this.clip(S,s)),!y||_==="Text"||_==="Image"?m.execute(S,e,s,n,r,a):y.pushFunction(v=>m.execute(v,e,s,n,r,a)),x&&S.restore(),y){y.offset();const v=l[c]*h+f;this.deferredZIndexContexts_[v]||(this.deferredZIndexContexts_[v]=[]),this.deferredZIndexContexts_[v].push(y)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Ae);for(let s=0,n=e.length;s<n;++s)t[e[s]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),t[e[s]].length=0}}const gn={};function Ed(i){if(gn[i]!==void 0)return gn[i];const t=i*2+1,e=i*i,s=new Array(e+1);for(let r=0;r<=i;++r)for(let o=0;o<=i;++o){const a=r*r+o*o;if(a>e)break;let l=s[a];l||(l=[],s[a]=l),l.push(((i+r)*t+(i+o))*4+3),r>0&&l.push(((i-r)*t+(i+o))*4+3),o>0&&(l.push(((i+r)*t+(i-o))*4+3),r>0&&l.push(((i-r)*t+(i-o))*4+3))}const n=[];for(let r=0,o=s.length;r<o;++r)s[r]&&n.push(...s[r]);return gn[i]=n,n}const Gt=.5;function Sd(i,t,e,s,n,r,o,a,l){const h=n,c=i[0]*Gt,u=i[1]*Gt,d=at(c,u);d.imageSmoothingEnabled=!1;const g=d.canvas,f=new qu(d,Gt,n,null,o,a,null),p=e.length,_=Math.floor((256*256*256-1)/p),m={};for(let S=1;S<=p;++S){const x=e[S-1],v=x.getStyleFunction()||s;if(!v)continue;let w=v(x,r);if(!w)continue;Array.isArray(w)||(w=[w]);const M=(S*_).toString(16).padStart(7,"#00000");for(let R=0,C=w.length;R<C;++R){const T=w[R],k=T.getGeometryFunction()(x);if(!k||!ut(h,k.getExtent()))continue;const P=T.clone(),z=P.getFill();z&&z.setColor(M);const b=P.getStroke();b&&(b.setColor(M),b.setLineDash(null)),P.setText(void 0);const B=T.getImage();if(B){const j=B.getImageSize();if(!j)continue;const H=at(j[0],j[1],void 0,{alpha:!1}),q=H.canvas;H.fillStyle=M,H.fillRect(0,0,q.width,q.height),P.setImage(new Ui({img:q,anchor:B.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:B.getOrigin(),opacity:1,size:B.getSize(),scale:B.getScale(),rotation:B.getRotation(),rotateWithView:B.getRotateWithView()}))}const G=P.getZIndex()||0;let D=m[G];D||(D={},m[G]=D,D.Polygon=[],D.Circle=[],D.LineString=[],D.Point=[]);const V=k.getType();if(V==="GeometryCollection"){const j=k.getGeometriesArrayRecursive();for(let H=0,q=j.length;H<q;++H){const I=j[H];D[I.getType().replace("Multi","")].push(I,P)}}else D[V.replace("Multi","")].push(k,P)}}const y=Object.keys(m).map(Number).sort(Ae);for(let S=0,x=y.length;S<x;++S){const v=m[y[S]];for(const w in v){const M=v[w];for(let R=0,C=M.length;R<C;R+=2){f.setStyle(M[R+1]);for(let T=0,k=t.length;T<k;++T)f.setTransform(t[T]),f.drawGeometry(M[R])}}}return d.getImageData(0,0,g.width,g.height)}function Cd(i,t,e){const s=[];if(e){const n=Math.floor(Math.round(i[0])*Gt),r=Math.floor(Math.round(i[1])*Gt),o=(it(n,0,e.width-1)+it(r,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);h&&h%c===0&&s.push(t[h/c-1])}return s}const wd=5;class Rd extends Yo{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=wd}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return K()}getData(t){return null}prepareFrame(t){return K()}renderFrame(t,e){return K()}forEachFeatureAtCoordinate(t,e,s,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===A.LOADED||e.getState()===A.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=A.LOADED&&e!=A.ERROR&&t.addEventListener(N.CHANGE,this.boundHandleImageChange_),e==A.IDLE&&(t.load(),e=t.getState()),e==A.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Oo=[];let Ye=null;function Id(){Ye=at(1,1,void 0,{willReadFrequently:!0})}class il extends Rd{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Ot(),this.pixelTransform=Ot(),this.inversePixelTransform=Ot(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,s){Ye||Id(),Ye.clearRect(0,0,1,1);let n;try{Ye.drawImage(t,e,s,1,1,0,0,1,1),n=Ye.getImageData(0,0,1,1).data}catch{return Ye=null,null}return n}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,s){const n=this.getLayer().getClassName();let r,o;if(t&&t.className===n&&(!s||t&&t.style.backgroundColor&&me(Je(t.style.backgroundColor),Je(s)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&Th(o.canvas.style.transform,e)?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=n;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=at();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&s&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=s)}clipUnrotated(t,e,s){const n=Ms(s),r=Vn(s),o=Xn(s),a=zn(s);lt(e.coordinateToPixelTransform,n),lt(e.coordinateToPixelTransform,r),lt(e.coordinateToPixelTransform,o),lt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;lt(l,n),lt(l,r),lt(l,o),lt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,e){const s=t.extent,n=t.viewState.resolution,r=t.viewState.rotation,o=t.pixelRatio,a=Math.round(Z(s)/n*o),l=Math.round(ot(s)/n*o);ee(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/o,1/o,r,-a/2,-l/2),ua(this.inversePixelTransform,this.pixelTransform);const h=Mh(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,s){const n=this.getLayer();if(n.hasListener(t)){const r=new Ka(t,this.inversePixelTransform,s,e);n.dispatchEvent(r)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Rt.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Rt.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new tl),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Rt.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Rt.POSTRENDER,this.context,t))}getRenderTransform(t,e,s,n,r,o,a){const l=r/2,h=o/2,c=n/e,u=-c,d=-t[0]+a,g=-t[1];return ee(this.tempTransform,l,h,c,u,-s,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Md extends il{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Dt(),this.wrappedRenderedExtent_=Dt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,s){const n=e.extent,r=e.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),g=e.pixelRatio,f=e.viewHints,p=!(f[rt.ANIMATING]||f[rt.INTERACTING]),_=this.context,m=Math.round(Z(n)/a*g),y=Math.round(ot(n)/a*g),S=u.getWrapX()&&l.canWrapX(),x=S?Z(c):null,v=S?Math.ceil((n[2]-c[2])/x)+1:1;let w=S?Math.floor((n[0]-c[0])/x):0;do{let M=this.getRenderTransform(o,a,0,g,m,y,w*x);e.declutter&&(M=M.slice(0)),t.execute(_,[_.canvas.width,_.canvas.height],M,h,p,s===void 0?Ke:s?el:xd,s?d&&e.declutter[d]:void 0)}while(++w<v)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=at(this.context.canvas.width,this.context.canvas.height,Oo))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,lr(this.context),Oo.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const s=t.layerStatesArray[t.layerIndex];this.opacity_=s.opacity;const n=t.viewState;this.prepareContainer(t,e);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Rt.PRERENDER)||this.getLayer().hasListener(Rt.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,t),n.projection,this.clipped_=!1,a&&s.extent&&this.clipping){const l=we(s.extent);a=ut(l,t.extent),this.clipped_=a&&!de(l,t.extent),this.clipped_&&this.clipUnrotated(r,t,l)}return a&&this.renderWorlds(o,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&r.restore(),this.postRender(r,t),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const s=this.frameState.size.slice(),n=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=s[0]*Gt,d=s[1]*Gt;c.push(this.getRenderTransform(n,r,o,Gt,u,d,0).slice());const g=h.getSource(),f=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!de(f,l)){let p=l[0];const _=Z(f);let m=0,y;for(;p<f[0];)--m,y=_*m,c.push(this.getRenderTransform(n,r,o,Gt,u,d,y).slice()),p+=_;for(m=0,p=l[2];p>f[2];)++m,y=_*m,c.push(this.getRenderTransform(n,r,o,Gt,u,d,y).slice()),p-=_}this.hitDetectionImageData_=Sd(s,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,Io(r,this.renderedPixelRatio_))}e(Cd(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,s,n,r){var o,a;if(!this.replayGroup_)return;const l=e.viewState.resolution,h=e.viewState.rotation,c=this.getLayer(),u={},d=function(f,p,_){const m=et(f),y=u[m];if(y){if(y!==!0&&_<y.distanceSq){if(_===0)return u[m]=!0,r.splice(r.lastIndexOf(y),1),n(f,c,p);y.geometry=p,y.distanceSq=_}}else{if(_===0)return u[m]=!0,n(f,c,p);r.push(u[m]={feature:f,layer:c,geometry:p,distanceSq:_,callback:n})}},g=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,l,h,s,d,g?(a=(o=e.declutter)==null?void 0:o[g])==null?void 0:a.all().map(f=>f.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),s=e.getSource();if(!s)return!1;const n=t.viewHints[rt.ANIMATING],r=t.viewHints[rt.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,g=e.getRevision(),f=e.getRenderBuffer();let p=e.getRenderOrder();p===void 0&&(p=Ju);const _=h.center.slice(),m=Gn(l,f*u),y=m.slice(),S=[m.slice()],x=c.getExtent();if(s.getWrapX()&&c.canWrapX()&&!de(x,t.extent)){const b=Z(x),B=Math.max(Z(m)/2,b);m[0]=x[0]-B,m[2]=x[2]+B,ea(_,c);const G=ta(S[0],c);G[0]<x[0]&&G[2]<x[2]?S.push([G[0]+b,G[1],G[2]+b,G[3]]):G[0]>x[0]&&G[2]>x[2]&&S.push([G[0]-b,G[1],G[2]-b,G[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==p&&this.renderedFrameDeclutter_===!!t.declutter&&de(this.wrappedRenderedExtent_,m))return me(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=_,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const v=new fd(Ja(u,d),m,u,d);let w;for(let b=0,B=S.length;b<B;++b)s.loadFeatures(S[b],u,c);const M=Io(u,d);let R=!0;const C=(b,B)=>{let G;const D=b.getStyleFunction()||e.getStyleFunction();if(D&&(G=D(b,u)),G){const V=this.renderFeature(b,M,G,v,w,this.getLayer().getDeclutter(),B);R=R&&!V}},T=ca(m),k=s.getFeaturesInExtent(T);p&&k.sort(p);for(let b=0,B=k.length;b<B;++b)C(k[b],b);this.renderedFeatures_=k,this.ready=R;const P=v.finish(),z=new vd(m,u,d,s.getOverlaps(),P,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=p,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=m,this.renderedCenter_=_,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=z,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,s,n,r,o,a){if(!s)return!1;let l=!1;if(Array.isArray(s))for(let h=0,c=s.length;h<c;++h)l=Mo(n,t,s[h],e,this.boundHandleStyleImageChange_,r,o,a)||l;else l=Mo(n,t,s,e,this.boundHandleStyleImageChange_,r,o,a);return l}}class Td extends Va{constructor(t){super(t)}createRenderer(){return new Md(this)}}let fn;const Ii=[];function Do(i,t,e,s,n){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(s,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,s)+1,Math.max(e,n)),i.restore()}function _n(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function Ad(){if(fn===void 0){const i=at(6,6,Ii);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Do(i,4,5,4,0),Do(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;fn=_n(t,0)||_n(t,4)||_n(t,8),lr(i),Ii.push(i.canvas)}return fn}function Ld(i,t,e,s){const n=ha(e,t,i);let r=Kr(t,s,e);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const a=i.getMetersPerUnit();a!==void 0&&(r/=a);const l=i.getExtent();if(!l||Ai(l,n)){const h=Kr(i,r,n)/r;isFinite(h)&&h>0&&(r/=h)}return r}function bd(i,t,e,s,n,r,o,a,l,h,c,u,d,g){const f=at(Math.round(e*i),Math.round(e*t),Ii);if(u||(f.imageSmoothingEnabled=!1),l.length===0)return f.canvas;f.scale(e,e);function p(v){return Math.round(v*e)/e}f.globalCompositeOperation="lighter";const _=Dt();l.forEach(function(v,w,M){kl(_,v.extent)});let m;const y=e/s,S=(u?1:1+Math.pow(2,-24))/y;(l.length!==1||h!==0)&&(m=at(Math.round(Z(_)*y),Math.round(ot(_)*y),Ii),u||(m.imageSmoothingEnabled=!1),l.forEach(function(v,w,M){if(v.image.width>0&&v.image.height>0){if(v.clipExtent){m.save();const P=(v.clipExtent[0]-_[0])*y,z=-(v.clipExtent[3]-_[3])*y,b=Z(v.clipExtent)*y,B=ot(v.clipExtent)*y;m.rect(u?P:Math.round(P),u?z:Math.round(z),u?b:Math.round(P+b)-Math.round(P),u?B:Math.round(z+B)-Math.round(z)),m.clip()}const R=(v.extent[0]-_[0])*y,C=-(v.extent[3]-_[3])*y,T=Z(v.extent)*y,k=ot(v.extent)*y;m.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,u?R:Math.round(R),u?C:Math.round(C),u?T:Math.round(R+T)-Math.round(R),u?k:Math.round(C+k)-Math.round(C)),v.clipExtent&&m.restore()}}));const x=Ms(o);return a.getTriangles().forEach(function(v,w,M){const R=v.source,C=v.target;let T=R[0][0],k=R[0][1],P=R[1][0],z=R[1][1],b=R[2][0],B=R[2][1];const G=p((C[0][0]-x[0])/r),D=p(-(C[0][1]-x[1])/r),V=p((C[1][0]-x[0])/r),j=p(-(C[1][1]-x[1])/r),H=p((C[2][0]-x[0])/r),q=p(-(C[2][1]-x[1])/r),I=T,Xt=k;T=0,k=0,P-=I,z-=Xt,b-=I,B-=Xt;const ye=[[P,z,0,0,V-G],[b,B,0,0,H-G],[0,0,P,z,j-D],[0,0,b,B,q-D]],ft=Dl(ye);if(!ft)return;if(f.save(),f.beginPath(),Ad()||!u){f.moveTo(V,j);const vt=4,ne=G-V,oi=D-j;for(let Yt=0;Yt<vt;Yt++)f.lineTo(V+p((Yt+1)*ne/vt),j+p(Yt*oi/(vt-1))),Yt!=vt-1&&f.lineTo(V+p((Yt+1)*ne/vt),j+p((Yt+1)*oi/(vt-1)));f.lineTo(H,q)}else f.moveTo(V,j),f.lineTo(G,D),f.lineTo(H,q);f.clip(),f.transform(ft[0],ft[2],ft[1],ft[3],G,D),f.translate(_[0]-I,_[3]-Xt);let kt;if(m)kt=m.canvas,f.scale(S,-S);else{const vt=l[0],ne=vt.extent;kt=vt.image,f.scale(Z(ne)/kt.width,-ot(ne)/kt.height)}f.drawImage(kt,0,0),f.restore()}),m&&(lr(m),Ii.push(m.canvas)),f.canvas}const Od=10,Po=.25;class Dd{constructor(t,e,s,n,r,o,a){this.sourceProj_=t,this.targetProj_=e;let l={};const h=a?Sh(S=>lt(a,ha(S,this.targetProj_,this.sourceProj_))):_s(this.targetProj_,this.sourceProj_);this.transformInv_=function(S){const x=S[0]+"/"+S[1];return l[x]||(l[x]=h(S)),l[x]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Z(n)>=Z(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Z(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Z(this.targetProj_.getExtent()):null;const c=Ms(s),u=Vn(s),d=Xn(s),g=zn(s),f=this.transformInv_(c),p=this.transformInv_(u),_=this.transformInv_(d),m=this.transformInv_(g),y=Od+(o?Math.max(0,Math.ceil(Math.log2(Nl(s)/(o*o*256*256)))):0);if(this.addQuad_(c,u,d,g,f,p,_,m,y),this.wrapsXInSource_){let S=1/0;this.triangles_.forEach(function(x,v,w){S=Math.min(S,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-S>this.sourceWorldWidth_/2){const v=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];v[0][0]-S>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-S>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-S>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);const w=Math.min(v[0][0],v[1][0],v[2][0]);Math.max(v[0][0],v[1][0],v[2][0])-w<this.sourceWorldWidth_/2&&(x.source=v)}})}l={}}addTriangle_(t,e,s,n,r,o){this.triangles_.push({source:[n,r,o],target:[t,e,s]})}addQuad_(t,e,s,n,r,o,a,l,h){const c=Fr([r,o,a,l]),u=this.sourceWorldWidth_?Z(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const _=Fr([t,e,s,n]);f=Z(_)/this.targetWorldWidth_>Po||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>Po||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!ut(c,this.maxSourceExtent_))return;let p=0;if(!f&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(p=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),p!=1&&p!=2&&p!=4&&p!=8)return}if(h>0){if(!f){const _=[(t[0]+s[0])/2,(t[1]+s[1])/2],m=this.transformInv_(_);let y;g?y=(Ci(r[0],d)+Ci(a[0],d))/2-Ci(m[0],d):y=(r[0]+a[0])/2-m[0];const S=(r[1]+a[1])/2-m[1];f=y*y+S*S>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-s[0])<=Math.abs(t[1]-s[1])){const _=[(e[0]+s[0])/2,(e[1]+s[1])/2],m=this.transformInv_(_),y=[(n[0]+t[0])/2,(n[1]+t[1])/2],S=this.transformInv_(y);this.addQuad_(t,e,_,y,r,o,m,S,h-1),this.addQuad_(y,_,s,n,S,m,a,l,h-1)}else{const _=[(t[0]+e[0])/2,(t[1]+e[1])/2],m=this.transformInv_(_),y=[(s[0]+n[0])/2,(s[1]+n[1])/2],S=this.transformInv_(y);this.addQuad_(t,_,y,n,r,m,S,l,h-1),this.addQuad_(_,e,s,y,m,o,a,S,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}!(p&11)&&this.addTriangle_(t,s,n,r,a,l),!(p&14)&&this.addTriangle_(t,s,e,r,a,o),p&&(!(p&13)&&this.addTriangle_(e,n,t,o,l,r),!(p&7)&&this.addTriangle_(e,n,s,o,l,a))}calculateSourceExtent(){const t=Dt();return this.triangles_.forEach(function(e,s,n){const r=e.source;wi(t,r[0]),wi(t,r[1]),wi(t,r[2])}),t}getTriangles(){return this.triangles_}}const Pd=.5;class kd extends il{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],s=t.pixelRatio,n=t.viewState,r=n.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=Yn(l,we(e.extent,n.projection))),!a[rt.ANIMATING]&&!a[rt.INTERACTING]&&!ii(l))if(o){const h=n.projection,c=o.getImage(l,r,s,h);c&&(this.loadImage(c)?this.image=c:c.getState()===A.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const s=this.getLayer(),n=lt(e.pixelToCoordinateTransform,t.slice()),r=s.getExtent();if(r&&!Ai(r,n))return null;const o=this.image.getExtent(),a=this.image.getImage(),l=Z(o),h=Math.floor(a.width*((n[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=ot(o),u=Math.floor(a.height*((o[3]-n[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const s=this.image,n=s.getExtent(),r=s.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],l=s.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,d=u.center,g=u.resolution,f=c*o/(g*l),p=c*a/(g*l);this.prepareContainer(t,e);const _=this.context.canvas.width,m=this.context.canvas.height,y=this.getRenderContext(t);let S=!1,x=!0;if(h.extent){const C=we(h.extent,u.projection);x=ut(C,t.extent),S=x&&!de(C,t.extent),S&&this.clipUnrotated(y,t,C)}const v=s.getImage(),w=ee(this.tempTransform,_/2,m/2,f,p,0,l*(n[0]-d[0])/o,l*(d[1]-n[3])/a);this.renderedResolution=a*c/l;const M=v.width*w[0],R=v.height*w[3];if(this.getLayer().getSource().getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,t),x&&M>=.5&&R>=.5){const C=w[4],T=w[5],k=h.opacity;k!==1&&(y.save(),y.globalAlpha=k),y.drawImage(v,0,0,+v.width,+v.height,C,T,M,R),k!==1&&y.restore()}return this.postRender(this.context,t),S&&y.restore(),y.imageSmoothingEnabled=!0,this.container}}class Fd extends Os{constructor(t){t=t||{},super(t)}}class Nd extends Fd{constructor(t){super(t)}createRenderer(){return new kd(this)}getData(t){return super.getData(t)}}function Dn(i){return Array.isArray(i)?Math.min(...i):i}const Gd="#44D7B6",Wd=1,Bd="#44D7B61A",zd=40,Xd=40;function Yd(i,t){const e=Pn(t);i.setStyle(e)}function sl(i){const t={color:Gd,width:Wd};return new xr({...t,...i})}function Vd(i){if(!i)return;const t={radius:(i==null?void 0:i.radius)??1,stroke:sl(i==null?void 0:i.stroke),fill:nl(i==null?void 0:i.fill)};return new ji(t)}function Kd(i){if(!i)return;const t={width:zd,height:Xd};return new Ui({...t,...i,crossOrigin:"anonymous"})}function nl(i){const t={color:Bd};return new ks({...t,...i})}function Pn(i){const t=nl(i==null?void 0:i.fill),e=sl(i==null?void 0:i.stroke),s=i!=null&&i.circle?Vd(i==null?void 0:i.circle):Kd(i==null?void 0:i.image);return new pe({fill:t,stroke:e,image:s})}function Zd(i){return i.center!==void 0||i.radius!==void 0}function jd(i){return Array.isArray(i)&&Array.isArray(i.at(0))}function Ud(i){return Array.isArray(i)&&i.length===2}function Hd(i,t){const e=t.getGeometry();if(e){if(Zd(i)&&e instanceof Gs){e.setCenter(i.center),e.setRadius(i.radius);return}if(jd(i)){if(e instanceof Bi){e.setCoordinates(i);return}if(e instanceof Oe){e.setCoordinates(i?[i]:[[]]);return}}if(Ud(i)&&e instanceof Vi){e.setCoordinates(i);return}}}function qd(i){const t=Pn(i.style);if(i.type==="image"){const e={...i.image,rotation:(i.rotate??0)*(Math.PI/180)};return[Pn({image:e}),t]}else return[t]}function Ws(i,t,e){const s={id:e.id,layerId:e.layerId,type:e.type,name:e.name,image:e.image,data:e.data,rotate:e.rotate??0,style:e.style,get props(){return t.getProperties()},setName(n){s.name=n},setRotate(n){s.rotate=n;const r=te(i.getExtent());i.rotate((360-n)*(Math.PI/180),r)},setProps(n){t.setProperties(n)},getOlFeature(){return t},setStyle(n){const r=s.getOlFeature();s.style=n,Yd(r,n)},setData(n){s.data=n;const r=s.getOlFeature();Hd(n,r)}};return s}function $d(i){var t,e;const s=((t=i.data)==null?void 0:t.center)??[],n=((e=i.data)==null?void 0:e.radius)??0,r=new Gs(s,n),o=new ri({geometry:r}),a=Ws(r,o,i);return a.setStyle(i.style),a.setRotate(a.rotate),a}function ko(i){const t=i.data?[i.data]:[[]],e=new Oe(t),s=new ri({geometry:e}),n=Ws(e,s,i);return n.setStyle(i.style),n.setRotate(n.rotate),n}function Jd(i){const t=i.data??[],e=new Bi(t),s=new ri({geometry:e}),n=Ws(e,s,i);return n.setStyle(i.style),n.setRotate(n.rotate),n}function Qd(i){const t=i.data??[],e=new Vi(t),s=new ri({geometry:e}),n={...Ws(e,s,i),setRotate(r){n.rotate=r,n.setStyle(i.style)},setStyle(r){n.style=r;const o=qd(n);s.setStyle(o)}};return n.setStyle(i.style),n}let pn=0;const tg={line:i=>Jd(i),circle:i=>$d(i),polygon:i=>ko(i),rect:i=>ko(i),image:i=>Qd(i)};function eg(i,t){pn++;const e=tg[i.type]({...i,id:pn,layerId:t});return e.setProps({elementId:pn,layerId:t}),e}class ig extends mr{constructor(t,e,s,n,r,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Yn(s,h):s,u=te(c),d=Ld(t,e,u,n),g=Pd,f=new Dd(t,e,c,l,d*g,n),p=f.calculateSourceExtent(),_=ii(p)?null:o(p,d,r),m=_?A.IDLE:A.EMPTY,y=_?_.getPixelRatio():1;super(s,n,y,m),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=n,this.targetExtent_=s,this.sourceImage_=_,this.sourcePixelRatio_=y,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==A.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==A.LOADED){const e=Z(this.targetExtent_)/this.targetResolution_,s=ot(this.targetExtent_)/this.targetResolution_;this.canvas_=bd(e,s,this.sourcePixelRatio_,Dn(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()}load(){if(this.state==A.IDLE){this.state=A.LOADING,this.changed();const t=this.sourceImage_.getState();t==A.LOADED||t==A.ERROR?this.reproject_():(this.sourceListenerKey_=X(this.sourceImage_,N.CHANGE,e=>{const s=this.sourceImage_.getState();(s==A.LOADED||s==A.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){tt(this.sourceListenerKey_),this.sourceListenerKey_=null}}const cs=4,mn={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class sg extends ie{constructor(t,e){super(t),this.image=e}}class ng extends Ha{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const s=Fn(e,t,0);t=e[s]}return t}getImage(t,e,s,n){const r=this.getProjection();if(!r||!n||jr(r,n))return r&&(n=r),this.getImageInternal(t,e,s,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&jr(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&Li(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ig(r,n,t,e,s,(o,a,l)=>this.getImageInternal(o,a,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,s,n){if(this.loader){const r=og(t,e,s,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&de(this.wantedExtent_,r)||de(this.image.getExtent(),r))&&(this.wantedResolution_&&Dn(this.wantedResolution_)===o||Dn(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new mr(r,o,s,this.loader),this.image.addEventListener(N.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let s;switch(e.getState()){case A.LOADING:this.loading=!0,s=mn.IMAGELOADSTART;break;case A.LOADED:this.loading=!1,s=mn.IMAGELOADEND;break;case A.ERROR:this.loading=!1,s=mn.IMAGELOADERROR;break;default:return}this.hasListener(s)&&this.dispatchEvent(new sg(s,e))}}function rg(i,t){i.getImage().src=t}function og(i,t,e,s){const n=t/e,r=te(i),o=es(Z(i)/n,cs),a=es(ot(i)/n,cs),l=es((s-1)*o/2,cs),h=o+2*l,c=es((s-1)*a/2,cs),u=a+2*c;return us(r,n,0,[h,u])}function ag(i){const t=i.load||Da,e=i.imageExtent,s=i.crossOrigin??null;return()=>{const n=new Image;return n.crossOrigin=s,t(n,i.url).then(r=>{const o=Z(e)/r.width,a=ot(e)/r.height;return{image:r,extent:e,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class rl extends ng{constructor(t){const e=t.crossOrigin!==void 0?t.crossOrigin:null,s=t.imageLoadFunction!==void 0?t.imageLoadFunction:rg;super({attributions:t.attributions,interpolate:t.interpolate,projection:Tt(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new mr(this.imageExtent_,void 0,1,ag({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(n,r)=>(this.image.setImage(n),s(this.image,r),Da(n))})),this.image.addEventListener(N.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,s,n){return ut(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const Fo=[0,0,1e4,1e4],No=[-2002637639e-2,-200489661e-1,2002637639e-2,200489661e-1],lg="#fff",hg="#eee";function Go(i){const t=document.createElement("canvas");t.width=500,t.height=500;const e=t.getContext("2d");return e.fillStyle=i,e.fillRect(0,0,500,500),t.toDataURL()}function Wo(i,t,e){const s=new rl({url:e,projection:t,imageExtent:i});return new Nd({source:s})}function cg(i,t){let e=(t==null?void 0:t.extent)??Fo,s=(t==null?void 0:t.url)??"";s||(s=Go(lg));const n=new bi({code:"EPSG:3857",extent:Fo}),r=Wo(e,n,s),o=new bi({code:"EPSG:3857",extent:No}),a=Go(hg),l=Wo(No,o,a);i.addLayer(l),i.addLayer(r);const h={getExtent(){return e},setExtent(c){n.setExtent(c),e=c,h.setImage()},setImage(c){const u=c??s,d=new rl({url:u,projection:n,imageExtent:e});r.setSource(d),s=c??s},getOlLayer(){return r},clean(){r.dispose(),l.dispose(),i.removeLayer(r),i.removeLayer(l)}};return h}let Bo=0;function ug(i,t){const e=new Hu,s=new Td({source:e});let n=[];Bo++;const r={id:Bo,type:t==null?void 0:t.type,name:t==null?void 0:t.name,create(o,a=!0){const l=eg(o,r.id);return a&&r.add(l),i.emit("element:created",l),l},add(o){if(!o||n.findIndex(l=>l.id===o.id)!==-1)return;const a=o.getOlFeature();e.addFeature(a),n.push(o),i.emit("element:added",o)},remove(o){if(!o)return;const a=n.findIndex(h=>h.id===o.id);if(a===-1)return;const l=o.getOlFeature();e.removeFeature(l),n.splice(a,1),i.emit("element:removed",o)},clean(){e.clear(),n=[],i.emit("element:clean",n)},destroy(){r.clean(),s.dispose()},getOlLayer(){return s},getElementById(o){return n.find(a=>o===a.id)},getElements(){return n}};return r}function dg(i,t){const e=[],s={create(n){const r=ug(t,n);return s.add(r),t.emit("layer:create",r),r},add(n){if(!n||e.findIndex(o=>o.id===n.id)!==-1)return;const r=n.getOlLayer();i.addLayer(r),e.push(n),t.emit("layer:add",n)},remove(n){if(!n)return;const r=e.findIndex(a=>a===n);if(r===-1)return;const o=n.getOlLayer();i.removeLayer(o),e.splice(r,1),t.emit("layer:remove",n)},clean(){if(s){for(const n of e)s.remove(n),n.destroy();t.emit("layer:clean",e)}},destroy(){s.clean()},getLayerById(n){return e.find(r=>n===r.id)},getLayers(){return e}};return s}function gg(i,t,e){const s=cg(i,e),n=dg(i,t);return{baseMap:s,layerManager:n}}function fg(i,t){return{refresh(){t.emit("updateHook")},destroy(){i.dispose(),t.emit("unMountedHook")}}}const _g=26,pg=10;function mg(i,t){i.setRotation(t)}function yg(i){return i.getZoom()}function xg(i,t){i.setZoom(t)}function vg(i,t){i.setMinZoom(t)}function Eg(i,t){i.setMaxZoom(t)}function Sg(i,t){i.fit(t)}function Cg(i,t,e){const s=t.baseMap.getExtent(),n=s[2]-s[0],r=s[3]-s[1],o=new Nt({center:[n/2,r/2],maxZoom:(e==null?void 0:e.maxZoom)??_g,minZoom:(e==null?void 0:e.minZoom)??pg}),a=i.getInteractions().getArray().find(u=>u instanceof Ca),l=(e==null?void 0:e.useMouseZoom)===void 0?!0:e==null?void 0:e.useMouseZoom;!l&&a&&a.setActive(!1);const h=i.getInteractions().getArray().find(u=>u instanceof ya);!l&&h&&h.setActive(!1),i.setView(o);const c={setCenter(u){o.setCenter(u)},setRotation(u){mg(o,u)},getZoom(){return yg(o)},setZoom(u){xg(o,u)},setMinZoom(u){vg(o,u)},setMaxZoom(u){Eg(o,u)},fit(u){Sg(o,u)}};return c.fit(s),c}function wg(i){return i!=null}function Rg(i){return i==null}function ol(){const i=new Map;return{on(t,e){const s=i.get(t);if(Rg(s)){i.set(t,[e]);return}s.includes(e)||s==null||s.push(e)},emit(t,...e){const s=i.get(t);if(wg(s))for(const n of s)n(...e)},remove(t,e,s=!1){if(s){i.delete(t);return}const n=i.get(t);if(!n)return;const r=n.findIndex(o=>e===o);r!==-1&&n.splice(r,1)}}}function yn(i){return()=>Promise.resolve(i())}function Ig(i,t){function e(n){i.emit("click",n)}function s(n){i.emit("move",n)}return t.on("click",e),t.on("pointermove",s),function(){t.un("click",e),t.un("pointermove",s)}}function Mg(i){const t=ol();if(i!=null&&i.mounted){const e=yn(i.mounted);t.on("mountedHook",e)}if(i!=null&&i.updated){const e=yn(i.updated);t.on("updatedHook",e)}if(i!=null&&i.unMounted){const e=yn(i.unMounted);t.on("unMountedHook",e)}return t}function Tg(i){return{}}function Ag(i){const t=Mg(i),e=ol(),s=new Bu({target:i.el,interactions:wa({shiftDragZoom:!1,keyboard:!1,altShiftDragRotate:!1}),controls:[]}),n=gg(s,e,i.baseMap),r=Xu(s,n,e),o=Cg(s,n,i.view),a=fg(s,t),l=Tg(),h=Ig(e,s),c={container:n,renderer:a,view:o,interactiveManager:r,emitter:e,tools:l,destroy(){n.baseMap.clean(),n.layerManager.clean(),r.clean(),h(),a.destroy()}};return t.emit("mountedHook"),c}export{Ag as i};
